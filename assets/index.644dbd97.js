var n=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;import{_ as c,s as i,j as _,c as s,r as f,h as l,g as v,t as T,m as d,a as G,b as A,d as m,e as p,f as h,i as g,k as E,l as w,n as b,o as y,u as S,v as I,p as k,q as x,w as D,x as N,y as C,z as R,A as F,B as X,C as O,D as L,E as U,F as M,G as z,H as P,I as j,J as V,K as B,L as q,M as Z,N as $,O as W,P as H,Q as K,R as Y,S as J,T as Q,U as nn,V as en,W as tn,X as rn,Y as un,Z as an,$ as on,a0 as cn,a1 as _n,a2 as sn,a3 as fn,a4 as ln,a5 as vn,a6 as Tn,a7 as dn,a8 as Gn,a9 as An,aa as mn,ab as pn,ac as hn,ad as gn,ae as En,af as wn,ag as bn,ah as yn,ai as Sn,aj as In,ak as kn,al as xn,am as Dn,an as Nn,ao as Cn,ap as Rn,aq as Fn,ar as Xn,as as On,at as Ln,au as Un,av as Mn,aw as zn,ax as Pn,ay as jn,az as Vn}from"./vendor.58539481.js";function Bn(n){return[[],n]}var qn={empty:void 0,add:i,addMono:function(n,e,t){return i(n,e,[[],t])},remove:f,has:l,get:v,show:function(n,e){return"{\n"+_(T(d(n,e)),"\n",(function(n){return"  "+n[0]+": "+n[1]}))+"\n}"}},Zn={TAG:1,_0:"u32",_1:[]},$n={TAG:1,_0:"bool",_1:[]},Wn={TAG:1,_0:"()",_1:[]};function Hn(n,e){return{TAG:1,_0:"Fun",_1:s(n,[e])}}function Kn(n){switch(0|n.TAG){case 0:case 1:return!1;case 2:return!0}}var Yn=E("Types.Size.UnkownTypeSize");function Jn(n){for(;;){var e=n;switch(0|e.TAG){case 0:throw{RE_EXN_ID:Yn,_1:e,Error:new Error};case 1:switch(e._0){case"()":if(0===e._1.length)return 0;throw{RE_EXN_ID:Yn,_1:e,Error:new Error};case"Mut":var t=e._1;if(1!==t.length)throw{RE_EXN_ID:Yn,_1:e,Error:new Error};n=t[0];continue;case"Fun":case"Ptr":return 4;case"Tuple":return h(w(e._1,Jn),0,(function(n,e){return n+e|0}));case"bool":case"u32":break;case"u64":if(0===e._1.length)return 8;throw{RE_EXN_ID:Yn,_1:e,Error:new Error};default:throw{RE_EXN_ID:Yn,_1:e,Error:new Error}}if(0===e._1.length)return 4;throw{RE_EXN_ID:Yn,_1:e,Error:new Error};case 2:return 4}}}var Qn={UnkownTypeSize:Yn,size:Jn,sizeLog2:function(n){return 0|Math.ceil(Math.log2(Jn(n)))},isZeroSizedType:function(n){return 0===Jn(n)}};function ne(n,e,t){if(0===n.TAG)return{TAG:1,_0:[e,t],_1:{TAG:0,_0:n._0}};var r=n._1,u=n._0,a=u[1],o=u[0];return e<o?{TAG:1,_0:[e,t],_1:{TAG:1,_0:[o,a],_1:r}}:{TAG:1,_0:[o,a],_1:ne(r,e,t)}}function ee(n){return A(function(n,e){for(;;){var t=e,r=n;if(0===r.TAG){var u=r._0;switch(0|u.TAG){case 0:case 1:return t;case 2:var a=u._0;if(0===a.TAG)return t;var o=a._0;if(0===o.TAG)return t;e={hd:o._0,tl:t},n=o._1;continue}}else e={hd:r._0,tl:t},n=r._1}}(n,0))}function te(n,e){return"{ "+_(function(n,t){for(;;){var r=t,u=n;if(0===u.TAG)return G(A({hd:"..."+c(e,u._0),tl:r}));var a=u._0;t={hd:a[0]+": "+c(e,a[1]),tl:r},n=u._1}}(n,0),", ",(function(n){return n}))+" }"}var re={make:function(n){return{TAG:0,_0:n}},insert:ne,tail:function(n){for(;;){var e=n;if(0===e.TAG)return e._0;n=e._1}},fromArray:function(n,e){return h(n,{TAG:0,_0:{TAG:0,_0:e}},(function(n,e){return ne(n,e[0],e[1])}))},toArray:ee,toMap:function(n){return g(ee(n))},map:function n(e,t){if(0!==e.TAG){var r=e._0;return{TAG:1,_0:[r[0],c(t,r[1])],_1:n(e._1,t)}}var u=c(t,e._0);switch(0|u.TAG){case 0:case 1:return{TAG:0,_0:u};case 2:var a=u._0;return 0===a.TAG?{TAG:0,_0:u}:a._0}},show:te};function ue(n){switch(0|n.TAG){case 0:return k(void 0,n._0);case 1:return h(w(n._1,ue),void 0,S);case 2:var e=n._0;return 0===e.TAG?void 0:h(w(ee(e._0),(function(n){return c(ue,c((function(n){return n[1]}),n))})),void 0,S)}}function ae(n){return y(ue(n[1]),x(n[0]))}function oe(n,e){return[b(y(ue(e),function(n){return h(w(I(n),ae),void 0,S)}(n))),e]}function ce(n){switch(0|n.TAG){case 0:return function(n){var e=String.fromCharCode(97+n%26|0),t=n/26|0;return 0===t?e:e+String(t)}(n._0);case 1:var e=n._1,t=n._0;if(0===e.length)return t;switch(t){case"Fun":var r=m(e,0,e.length-1|0),u=p(e,e.length-1|0);return 1!==r.length?"("+_(r,", ",ce)+") -> "+ce(u):ce(r[0])+" -> "+ce(u);case"Tuple":return"("+_(e,", ",ce)+")";default:return t+"<"+_(e,", ",ce)+">"}case 2:var a=n._0;return 0===a.TAG?a._0:te(a._0,ce)}}function ie(n){switch(n){case 0:return"+";case 1:return"-";case 2:return"*";case 3:return"/";case 4:return"%";case 5:return"<";case 6:return"<=";case 7:return">";case 8:return">=";case 9:return"==";case 10:return"!="}}var _e={show:ie};function se(n){switch(n){case 0:return"-";case 1:return"!";case 2:return"*"}}var fe={show:se};function le(n){return"number"==typeof n?"()":0===n.TAG?String(n._0):n._0?"true":"false"}var ve={show:le};function Te(n){switch(0|n.TAG){case 0:return le(n._0);case 1:return se(n._0)+Te(n._1);case 2:return"("+Te(n._0)+" "+ie(n._1)+" "+Te(n._2)+")";case 3:return n._0;case 4:return Te(n._0)+" = "+Te(n._1);case 5:var e=n._1,t=n._0,r=t.length;return 1!==r?0!==r?"("+_(t,", ",(function(n){return n}))+") -> "+Te(e):"() -> "+Te(e):t[0]+" -> "+Te(e);case 6:return"let "+n._0+" = "+Te(n._1)+" in "+Te(n._2);case 7:return"("+Te(n._0)+")("+_(n._1,", ",Te)+")";case 8:return(1===n._2?"unsafe ":"")+"{\n"+_(s(w(n._0,de),D(n._1,[],(function(n){return[Te(n)]}))),";\n",(function(n){return"  "+n}))+"}\n}";case 9:var u=n._2,a="if "+Te(n._0)+" "+Te(n._1);return void 0!==u?a+" else "+Te(u):a;case 10:return"while "+Te(n._0)+" "+Te(n._1);case 11:return"return "+D(n._0,"",Te);case 12:return Te(n._0)+" as "+ce(n._1);case 13:return"("+_(n._0,", ",Te)+")";case 14:return n._0+" {\n"+_(n._1,", ",(function(n){return n[0]+": "+Te(n[1])}))+"\n}";case 15:return Te(n._0)+"."+n._1}}function de(n){if(0!==n.TAG)return Te(n._0)+";";var e=n._2,t=n._0;return n._1?"let mut "+t+" = "+Te(e):"let "+t+" = "+Te(e)}var Ge={showExpr:Te,showDecl:function n(e){switch(0|e.TAG){case 0:return"fn "+e._0+"("+_(e._1,", ",(function(n){return(n[1]?"mut ":"")+n[0]}))+") "+Te(e._2);case 1:return(e._1?"mut":"let")+" "+e._0+" = "+Te(e._2);case 2:return"struct "+e._0+" {\n"+_(e._1,",\n",(function(n){return(n[2]?"mut ":"")+n[0]+": "+ce(n[1])}))+"\n}";case 3:return e._0+" {\n"+_(e._1,"\n\n",n)+"\n}"}},showStmt:de};function Ae(n,e){for(;;){var t=e;switch(0|t.TAG){case 0:var r=t._0,u=X(n,r);if(void 0===u)return{TAG:0,_0:r};e=u;continue;case 1:return{TAG:1,_0:t._0,_1:w(t._1,(function(e){return Ae(n,e)}))};case 2:var a=t._0;return{TAG:2,_0:0===a.TAG?{TAG:0,_0:a._0}:{TAG:1,_0:re.map(a._0,(function(e){return Ae(n,e)}))}}}}}function me(n,e){return N(C(e,(function(e){return Ae(n,e)})),n,(function(n,e,t){return R(t,e)}))}function pe(n,e){return d(e,(function(e){return function(n,e){var t=e[0];return[t,Ae(F(n,t),e[1])]}(n,e)}))}function he(n,e){for(var t,r=0;O(t)&&r<n.length;){var u=c(e,p(n,r));void 0!==u&&(t=L(U(u))),r=r+1|0}return t}function ge(n,e){for(var t,r=n.length-1|0;O(t)&&r>=0;)c(e,p(n,r))?t=r:r=r-1|0;return t}function Ee(n,e){for(var t,r=[],u=0;O(t)&&u<n.length;){var a=p(n,u);0===a.TAG?r.push(c(e,a._0)):t=L(a._0),u=u+1|0}return void 0!==t?{TAG:1,_0:U(t)}:{TAG:0,_0:r}}var we={show:function(n){return"struct "+n.name+"{\n"+_(n.attributes,",\n",(function(n){return"  "+n.name+": "+ce(n.ty)}))+"\n}"},toPartialStructType:function(n,e){return{TAG:2,_0:{TAG:1,_0:re.fromArray(w(n.attributes,(function(n){return[n.name,n.ty]})),e)}}},make:function(n,e){var t={contents:0},r=[];return V(e,(function(n){var e=n[1],u=Qn.size(e);r.push({name:n[0],mut:n[2],offset:t.contents,ty:e,size:u,impl:void 0}),t.contents=t.contents+u|0})),{name:n,attributes:r,size:t.contents}},addImpl:function(n,e,t){n.attributes.push({name:e.contents.name,mut:!1,offset:0,ty:e.contents.ty,size:0,impl:[e,t]})}},be={tyVarIndex:0,identifiers:[],renaming:P(10),structs:j(5)};function ye(n){var e=be.tyVarIndex;return be.tyVarIndex=be.tyVarIndex+1|0,e}function Se(n){return{TAG:0,_0:ye()}}function Ie(n){var e=n[0],t=w(e,(function(n){return{TAG:0,_0:ye()}}));return Ae(W(H(e,t)),n[1])}function ke(n,e){var t=void 0!==n?U(n):void 0,r=be.identifiers.length;be.identifiers.push(e);var u={contents:{name:e,newName:e,index:r,ty:void 0!==t?t:{TAG:0,_0:ye()}}};return $(be.renaming,r,u),u}function xe(n,e){e.contents.ty=Ae(n,e.contents.ty)}function De(n){return q(be.structs,n)}function Ne(n){switch(0|n.TAG){case 0:var e=n._0;return"number"==typeof e?Wn:0===e.TAG?Zn:$n;case 3:return n._0.contents.ty;case 4:case 10:return Wn;case 11:return D(n._0,Wn,Ne);case 12:return n._2;case 13:return{TAG:1,_0:"Tuple",_1:w(n._0,Ne)};case 14:return{TAG:2,_0:{TAG:0,_0:n._0}};default:return n._0}}function Ce(n,e){var t=void 0!==n?U(n):void 0,r=function(n,e){return void 0!==t?"("+e+": "+ce(Ae(U(t),n))+")":e};switch(0|e.TAG){case 0:return r(Ne(e),ve.show(e._0));case 1:return r(e._0,"("+Ce(L(t),e._1)+" "+_e.show(e._2)+" "+Ce(L(t),e._3)+")");case 2:return r(e._0,"("+fe.show(e._1)+Ce(L(t),e._2)+")");case 3:var u=e._0;return r(u.contents.ty,u.contents.name);case 4:var a=e._1;return r(Ne(a),Ce(L(t),e._0)+" = "+Ce(L(t),a));case 5:return r(e._0,"("+_(e._2,", ",(function(n){return n.contents.name}))+") -> "+Ce(L(t),e._3));case 6:return r(e._0,"let "+e._1.contents.name+" = "+Ce(L(t),e._2)+" in\n"+Ce(L(t),e._3));case 7:return r(e._0,"("+Ce(L(t),e._1)+")("+_(e._2,", ",(function(n){return Ce(L(t),n)}))+")");case 8:var o=e._2,c=L(t);return r(e._0,(1===e._3?"unsafe ":"")+"{\n"+_(s(w(e._1,(function(n){return Re(c,n)})),D(o,[],(function(n){return[Ce(void 0,n)]}))),";\n",(function(n){return"  "+n}))+(O(o)?"; ":"")+"\n}");case 9:return r(e._0,"if "+Ce(L(t),e._1)+" "+Ce(L(t),e._2)+" else "+Ce(L(t),e._3));case 10:return r(Wn,"while "+Ce(void 0,e._0)+" "+Ce(void 0,e._1));case 11:var i=L(t);return"return "+r(Ne(e),D(e._0,"",(function(n){return Ce(i,n)})));case 12:var f=e._0;return r(Ne(f),Ce(void 0,f))+" as "+ce(e._2);case 13:var l=L(t);return"("+_(e._0,", ",(function(n){return Ce(l,n)}))+")";case 14:return e._0+" {\n"+_(e._1,",\n",(function(n){return n[0]+": "+Ce(void 0,n[1])}))+"\n}";case 15:return r(e._0,Ce(void 0,e._1)+"."+e._2)}}function Re(n,e){var t=void 0!==n?U(n):void 0;return 0===e.TAG?(e._1?"mut":"let")+" "+e._0.contents.name+" = "+Ce(L(t),e._2):Ce(L(t),e._0)}function Fe(n,e){var t=void 0!==n?U(n):void 0,r=function(n,e){return void 0!==t?"("+e+": "+ce(Ae(U(t),n))+")":e};switch(0|e.TAG){case 0:var u,a=e._1,o=e._0;if(void 0!==t){var c=U(t);u=_(a,", ",(function(n){var e=n[0];return(n[1]?"mut ":"")+e.contents.name+": "+ce(Ae(c,e.contents.ty))}))}else u=_(a,", ",(function(n){return(n[1]?"mut ":"")+n[0].contents.name}));return r(o.contents.ty,"fn "+o.contents.name+"("+u+") "+Ce(L(t),e._2));case 1:var i=e._0;return r(i.contents.ty,(e._1?"mut":"let")+" "+i.contents.name+" = "+Ce(L(t),e._2));case 2:return Ge.showDecl({TAG:2,_0:e._0,_1:e._1});case 3:return"impl "+e._0+" {\n"+_(e._1,"\n\n",(function(n){return Fe(void 0,{TAG:0,_0:n[0],_1:n[1],_2:n[2]})}))+"\n}"}}var Xe=E("Core.CoreAst.UnexpectedDeclarationInImplBlock");function Oe(n){var e,t,r={LAZY_DONE:!1,VAL:function(){return Se()}};switch(0|n.TAG){case 0:return{TAG:0,_0:n._0};case 1:return{TAG:2,_0:Q(r),_1:n._0,_2:Oe(n._1)};case 2:return{TAG:1,_0:Q(r),_1:Oe(n._0),_2:n._1,_3:Oe(n._2)};case 3:return{TAG:3,_0:(e=n._0,t=K(ge(be.identifiers,(function(n){return n===e})),(function(n){return Y(be.renaming,n)})),void 0!==t?t:J('unbound identifier "'+e+'"'))};case 4:return{TAG:4,_0:Oe(n._0),_1:Oe(n._1)};case 5:var u=n._1,a=n._0;if(0===a.length)return{TAG:5,_0:Q(r),_1:void 0,_2:[ke(void 0,"__x")],_3:Oe(u)};var o=L(void 0);return{TAG:5,_0:Q(r),_1:void 0,_2:w(a,(function(n){return ke(o,n)})),_3:Oe(u)};case 6:var c=n._2,i=n._1,_=n._0;if(5!==i.TAG)return{TAG:6,_0:Q(r),_1:ke(void 0,_),_2:Oe(i),_3:Oe(c)};var s=ke(void 0,_),f=L(void 0),l={TAG:5,_0:Se(),_1:s,_2:w(i._0,(function(n){return ke(f,n)})),_3:Oe(i._1)};return{TAG:6,_0:Q(r),_1:s,_2:l,_3:Oe(c)};case 7:return{TAG:7,_0:Q(r),_1:Oe(n._0),_2:w(n._1,Oe)};case 8:return{TAG:8,_0:Q(r),_1:w(n._0,Le),_2:M(n._1,Oe),_3:n._2};case 9:return{TAG:9,_0:Q(r),_1:Oe(n._0),_2:Oe(n._1),_3:D(n._2,{TAG:0,_0:0},Oe)};case 10:return{TAG:10,_0:Oe(n._0),_1:Oe(n._1)};case 11:return{TAG:11,_0:M(n._0,Oe)};case 12:return{TAG:12,_0:Oe(n._0),_1:Q(r),_2:n._1};case 13:return{TAG:13,_0:w(n._0,Oe)};case 14:return{TAG:14,_0:n._0,_1:w(n._1,(function(n){return[n[0],Oe(n[1])]}))};case 15:return{TAG:15,_0:Se(),_1:Oe(n._0),_2:n._1}}}function Le(n){if(0!==n.TAG)return{TAG:1,_0:Oe(n._0)};var e=n._3,t=n._2,r=n._1,u=n._0;if(5!==t.TAG)return{TAG:0,_0:ke(L(e),u),_1:r,_2:Oe(t)};var a=ke(L(e),u),o=L(void 0);return{TAG:0,_0:a,_1:r,_2:{TAG:5,_0:Se(),_1:a,_2:w(t._0,(function(n){return ke(o,n)})),_3:Oe(t._1)}}}function Ue(n){switch(0|n.TAG){case 0:var e=w(n._1,(function(n){return[ke(L(void 0),n[0]),n[1]]}));return{TAG:0,_0:ke(void 0,n._0),_1:e,_2:Oe(n._2)};case 1:return{TAG:1,_0:ke(void 0,n._0),_1:n._1,_2:Oe(n._2)};case 2:return{TAG:2,_0:n._0,_1:n._1};case 3:var t=w(w(n._1,Ue),(function(n){if(0===n.TAG)return[n._0,n._1,n._2];throw{RE_EXN_ID:Xe,_1:n,Error:new Error}}));return{TAG:3,_0:n._0,_1:t}}}function Me(n,e){var t=function(e){return Me(n,e)};switch(0|e.TAG){case 0:return{TAG:0,_0:e._0};case 1:return{TAG:1,_0:Ae(n,e._0),_1:Me(n,e._1),_2:e._2,_3:Me(n,e._3)};case 2:return{TAG:2,_0:Ae(n,e._0),_1:e._1,_2:Me(n,e._2)};case 3:return{TAG:3,_0:e._0};case 4:return{TAG:4,_0:Me(n,e._0),_1:Me(n,e._1)};case 5:return{TAG:5,_0:Ae(n,e._0),_1:e._1,_2:e._2,_3:Me(n,e._3)};case 6:return{TAG:6,_0:Ae(n,e._0),_1:e._1,_2:Me(n,e._2),_3:Me(n,e._3)};case 7:return{TAG:7,_0:Ae(n,e._0),_1:Me(n,e._1),_2:w(e._2,t)};case 8:return{TAG:8,_0:Ae(n,e._0),_1:w(e._1,(function(e){return ze(n,e)})),_2:M(e._2,t),_3:e._3};case 9:return{TAG:9,_0:Ae(n,e._0),_1:Me(n,e._1),_2:Me(n,e._2),_3:Me(n,e._3)};case 10:return{TAG:10,_0:Me(n,e._0),_1:Me(n,e._1)};case 11:return{TAG:11,_0:M(e._0,t)};case 12:return{TAG:12,_0:Me(n,e._0),_1:Ae(n,e._1),_2:Ae(n,e._2)};case 13:return{TAG:13,_0:w(e._0,t)};case 14:var r=e._1,u=e._0,a=De(u);if(void 0===a)return J('unreachable: undeclared struct "'+u+"'");var o=function(n,e){for(var t=[],r=!1,u=0;!1===r&&u<n.length;){var a=p(n,u);void 0!==a?t.push(c(e,U(a))):r=!0,u=u+1|0}return r?void 0:t}(w(en(a.attributes,(function(n){return O(n.impl)})),(function(n){var e=n.name;return nn(r,(function(n){return n[0]===e}))})),(function(e){return[e[0],Me(n,e[1])]}));return void 0!==o?{TAG:14,_0:u,_1:o}:J('unreachable: missing attribute for struct "'+u+'"');case 15:return{TAG:15,_0:Ae(n,e._0),_1:Me(n,e._1),_2:e._2}}}function ze(n,e){return 0===e.TAG?{TAG:0,_0:e._0,_1:e._1,_2:Me(n,e._2)}:{TAG:1,_0:Me(n,e._0)}}function Pe(n,e){switch(0|e.TAG){case 0:return{TAG:0,_0:e._0,_1:e._1,_2:Me(n,e._2)};case 1:return{TAG:1,_0:e._0,_1:e._1,_2:Me(n,e._2)};case 2:return e;case 3:return{TAG:3,_0:e._0,_1:w(e._1,(function(e){return[e[0],e[1],Me(n,e[2])]}))}}}var je={typeOfExpr:Ne,typeOfStmt:function(n){return 0===n.TAG?Wn:Ne(n._0)},showExpr:Ce,showStmt:Re,showDecl:Fe,UnexpectedDeclarationInImplBlock:Xe,fromExpr:Oe,fromStmt:Le,fromDecl:Ue,substExpr:Me,substStmt:ze,substDecl:Pe},Ve={show:Ce,from:Oe,subst:Me,typeOf:Ne},Be={show:Fe,from:Ue,subst:Pe};function qe(n){var e=[];return function(n){for(;;){var t=127&n,r=n>>>7;if(0===r)return void e.push(t);e.push(128|t),n=r}}(n),e}function Ze(n){var e=[];return function(n){for(;;){var t=127&n,r=n>>7;if(0===r&&0==(64&t)||-1===r&&0!=(64&t))return void e.push(t);e.push(128|t),n=r}}(0|n),e}function $e(n){return s(qe(n.length),n)}function We(n){return s(qe(n.length),tn(n))}var He={encode:$e,encodeMany:We};function Ke(n){var e=new DataView(new ArrayBuffer(4));return e.setFloat32(0,n,1),[e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3)]}var Ye={encode:Ke};function Je(n){var e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,1),[e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3),e.getUint8(4),e.getUint8(5),e.getUint8(6),e.getUint8(7)]}var Qe={encode:Je};function nt(n,e){return s([n],$e(e))}function et(n){var e;switch(n){case 0:e="custom";break;case 1:e="type";break;case 2:e="import";break;case 3:e="function";break;case 4:e="table";break;case 5:e="memory";break;case 6:e="global";break;case 7:e="export";break;case 8:e="start";break;case 9:e="element";break;case 10:e="code";break;case 11:e="data"}return"["+e+"]"}var tt={id:function(n){return n},encode:nt,show:et};function rt(n){switch(n){case 0:return 127;case 1:return 126;case 2:return 125;case 3:return 124}}function ut(n){switch(n){case 0:return"i32";case 1:return"i64";case 2:return"f32";case 3:return"f64"}}var at={encode:rt,show:ut};function ot(n){return"number"==typeof n?[64]:0===n.TAG?[rt(n._0)]:qe(n._0)}var ct={encode:ot,show:function(n){return"number"==typeof n?"void":0===n.TAG?ut(n._0):"type "+String(n._0)}};function it(n){if("number"==typeof n)switch(n){case 0:return[5,"else"];case 1:return[11,"end"];case 2:return[15,"return"];case 3:return[26,"drop"];case 4:return[106,"i32.add"];case 5:return[107,"i32.sub"];case 6:return[108,"i32.mul"];case 7:return[110,"i32.div_s"];case 8:return[109,"i32.div_u"];case 9:return[69,"i32.eqz"];case 10:return[70,"i32.eq"];case 11:return[81,"i64.eq"];case 12:return[91,"f32.eq"];case 13:return[97,"f64.eq"];case 14:return[71,"i32.ne"];case 15:return[82,"i64.ne"];case 16:return[92,"f32.ne"];case 17:return[98,"f64.ne"];case 18:return[76,"i32.le_s"];case 19:return[77,"i32.le_u"];case 20:return[87,"i64.le_s"];case 21:return[88,"i64.le_u"];case 22:return[95,"f32.le"];case 23:return[101,"f64.le"];case 24:return[78,"i32.ge_s"];case 25:return[79,"i32.ge_u"];case 26:return[89,"i64.ge_s"];case 27:return[90,"i64.ge_u"];case 28:return[96,"f32.ge"];case 29:return[102,"f64.ge"];case 30:return[72,"i32.lt_s"];case 31:return[73,"i32.lt_u"];case 32:return[83,"i64.lt_s"];case 33:return[84,"i64.lt_u"];case 34:return[93,"f32.lt"];case 35:return[99,"f64.lt"];case 36:return[74,"i32.gt_s"];case 37:return[75,"i32.gt_u"];case 38:return[85,"i64.gt_s"];case 39:return[86,"i64.gt_u"];case 40:return[94,"f32.gt"];case 41:return[100,"f64.gt"];case 42:return[111,"i32.rem_s"];case 43:return[112,"i32.rem_u"];case 44:return[113,"i32.and"]}else switch(0|n.TAG){case 0:return[65,"i32.const "+String(n._0)];case 1:return[66,"i64.const "+String(n._0)];case 2:return[67,"i64.const "+String(n._0)];case 3:return[68,"i64.const "+String(n._0)];case 4:return[4,"if"];case 5:return[13,"br_if "+String(n._0)];case 6:return[12,"br "+String(n._0)];case 7:return[2,"block"];case 8:return[3,"loop"];case 9:return[35,"global.get "+String(n._0)];case 10:return[36,"global.set "+String(n._0)];case 11:return[32,"local.get "+String(n._0)];case 12:return[33,"local.set "+String(n._0)];case 13:return[34,"local.tee "+String(n._0)];case 14:return[16,"call "+String(n._0)];case 15:return[17,"call_indirect [typeIndex="+String(n._0)+", tableIndex="+String(n._1)+"]"];case 16:return[40,"i32.load (alignment="+String(n._0)+", offset="+String(n._1)+")"];case 17:return[54,"i32.store (alignment="+String(n._0)+", offset="+String(n._1)+")"]}}function _t(n){return it(n)[0]}function st(n){if("number"==typeof n)switch(n){case 0:case 1:return-1;default:return 0}else switch(0|n.TAG){case 4:case 7:case 8:return 1;default:return 0}}function ft(n,e,t,r){var u,a=void 0!==n?n:{contents:0},o=it(e),c=st(e),i=_(rn(0,a.contents+(c<0?c:0)|0),"  ",(function(n){return""}));a.contents=a.contents+c|0,0===e&&(a.contents=a.contents+1|0);var s=0;if("number"==typeof e)u="";else switch(0|e.TAG){case 11:case 12:case 13:s=1;break;case 14:u="<"+D(un(t,e._0),"??",(function(n){return n}))+">";break;default:u=""}return 1===s&&(u="<"+D(un(r,e._0),"??",(function(n){return n}))+">"),i+o[1]+" "+u}function lt(n){var e=0;if("number"==typeof n)return[_t(n)];switch(0|n.TAG){case 0:case 1:e=1;break;case 2:return s([_t(n)],Ke(n._0));case 3:return s([_t(n)],Je(n._0));case 5:case 6:e=3;break;case 4:case 7:case 8:e=2;break;case 9:case 10:case 11:case 12:case 13:e=4;break;case 14:return s([_t(n)],qe(n._0));case 15:return tn([[_t(n)],qe(n._0),qe(n._1)]);case 16:case 17:e=5}switch(e){case 1:return s([_t(n)],Ze(n._0));case 2:return s([_t(n)],ot(n._0));case 3:case 4:return s([_t(n)],qe(n._0));case 5:return tn([[_t(n)],qe(n._0),qe(n._1)])}}var vt={info:it,opcode:_t,identationDelta:st,show:ft,encode:lt};function Tt(n){return tn([[96],$e(w(n._0,rt)),$e(w(n._1,rt))])}function dt(n){var e=n._1,t=n._0,r=_(t,", ",ut),u=_(e,", ",ut);if(1===t.length){var a=e.length;if(1===a)return r+" -> "+u;if(0===a)return r+" -> ()"}return 0!==e.length?"("+r+") -> ("+u+")":"("+r+") -> ()"}function Gt(n){return s(qe(n[0].length),[rt(n[1])])}function At(n){return"local ["+_(n[0],", ",(function(n){return n}))+"] "+ut(n[1])}function mt(n){var e=We(w(n[0],Gt)),t=tn(w(n[1],lt));return tn([[e.length+t.length|0],e,t])}function pt(n,e,t){var r=n[0],u={contents:1},a=_n(t._0,(function(n,e){return"param["+String(n)+"]"})),o=s(a,tn(w(r,(function(n){return n[0]})))),c=_(r,"\n",At),i=_(n[1],"\n",(function(n){return ft(u,n,e,o)}));return 0===r.length?i:c+"\n"+i}var ht={Signature:{funcTypeCode:96,make:function(n,e){return{_0:n,_1:e}},empty:{_0:[],_1:[]},encode:Tt,show:dt},Local:{fromTypes:function(n){var e=an(function(n,e){for(;;){var t=e,r=n;if(!r)return t;var u=r.tl,a=r.hd,o=a[1],c=a[0];if(t){var i=t.tl,_=t.hd,s=_[1],f=_[0];if(sn(o,s)){e={hd:[{hd:c,tl:f},s],tl:i},n=u;continue}e={hd:[{hd:c,tl:0},o],tl:{hd:[f,s],tl:i}},n=u}else e={hd:[{hd:c,tl:0},o],tl:0},n=u}}(on(n),0));return A(cn(e,(function(n){return[G(A(n[0])),n[1]]})))},encode:Gt,show:At},Body:{make:function(n,e){return[n,e]},encode:mt,show:pt},make:function(n,e,t){return[n,e,t]}};function gt(n,e){var t=z(n,(function(n){return sn(n,e)}));return void 0!==t?t:(n.push(e),n.length-1|0)}function Et(n){return nt(1,We(w(n,Tt)))}function wt(n){return et(1)+"\n"+_(n,"\n",dt)}var bt={make:function(n){return[]},getOrAdd:gt,encode:Et,show:wt};function yt(n,e){return n.push(e),n.length-1|0}function St(n){return nt(3,We(w(n,qe)))}function It(n,e){return et(3)+"\n"+_(H(n,e),"\n",(function(n){return n[1]+": "+String(n[0])}))}var kt={make:function(n){return[]},addSignature:yt,encode:St,show:It};function xt(n,e){return n.push(e),n.length-1|0}function Dt(n){return nt(10,We(w(n,mt)))}function Nt(n,e){var t=w(e,(function(n){return n[0]}));return et(10)+"\n"+_(H(n,e),"\n\n",(function(n){var e=n[1];return e[0]+"\n"+pt(n[0],t,e[1])}))}var Ct={make:function(n){return[]},addFunc:xt,encode:Dt,show:Nt};function Rt(n){return $e(w(n.split(""),(function(n){return 0|n.charCodeAt(0)})))}var Ft={encode:Rt};function Xt(n){switch(n){case 0:return"func";case 1:return"table";case 2:return"memory";case 3:return"global"}}function Ot(n){return tn([Rt(n.name),[n.kind],qe(n.index)])}function Lt(n){return"export "+Xt(n.kind)+" "+n.name+" (index: "+String(n.index)+")"}var Ut={ExternalKind:{encode:function(n){return[n]},show:Xt},make:function(n,e,t){return{name:n,kind:e,index:t}},encode:Ot,show:Lt};function Mt(n){return nt(7,We(w(n,Ot)))}function zt(n){return et(7)+"\n"+_(n,"\n",Lt)}var Pt={make:function(n){return[]},add:function(n,e){n.push(e)},encode:Mt,show:zt};var jt={show:function(n){return n?"externref":"funcref"},encode:function(n){return n?111:112}};function Vt(n){return"{ min: "+String(n[0])+", max: "+D(n[1],"?",(function(n){return String(n)}))+" }"}function Bt(n){var e=n[1],t=n[0];return void 0!==e?tn([[1],qe(t),qe(e)]):s([0],qe(t))}var qt={show:Vt,make:function(n,e){return[n,e]},makeExact:function(n){return[n,n]},encode:Bt};function Zt(n){return s([n[0]?111:112],Bt(n[1]))}function $t(n){return"table "+(n[0]?"externref":"funcref")+" "+Vt(n[1])}var Wt={make:function(n,e){return[n,e]},encode:Zt,show:$t};function Ht(n){return et(4)+"\n"+_(n,"\n",$t)}function Kt(n){return nt(4,We(w(n,Zt)))}var Yt={make:function(n){return[]},add:function(n,e){n.push(e)},show:Ht,encode:Kt};function Jt(n){return"elem funcref ("+_(n.funcIndices," ",(function(n){return String(n)}))+") (offset="+String(n.offset)+")"}function Qt(n){return tn([[0],lt({TAG:0,_0:n.offset}),lt(1),We(w(n.funcIndices,qe))])}var nr={fromFuncRefs:function(n,e){return{offset:void 0!==n?n:0,funcIndices:e}},show:Jt,encode:Qt};function er(n){return et(9)+"\n"+_(n,"\n",Jt)}function tr(n){return nt(9,We(w(n,Qt)))}var rr={make:function(n){return[]},add:function(n,e){n.push(e)},show:er,encode:tr};function ur(n){var e;return e=0===n.TAG?{TAG:0,_0:n._0}:{TAG:9,_0:n._0},s(lt(e),lt(1))}function ar(n){return 0===n.TAG?String(n._0):"global.get "+String(n._0)}function or(n){return"global "+(n[1]?"mutable":"immutable")+" "+ut(n[0])+" = "+ar(n[2])}function cr(n){return s([rt(n[0]),n[1]?1:0],ur(n[2]))}var ir={Initializer:{encode:ur,show:ar},make:function(n,e,t){return[e,n,t]},show:or,encode:cr};function _r(n){return et(6)+"\n"+_(n,"\n",or)}function sr(n){return nt(6,We(w(n,cr)))}var fr={make:function(n){return[]},add:function(n,e){n.push(e)},show:_r,encode:sr};function lr(n){return"memory "+Vt(n)}var vr={make:function(n){return n},show:lr,encode:Bt};function Tr(n,e){return n.push(e)-1|0}function dr(n){return et(5)+"\n"+_(n,"\n",lr)}function Gr(n){return nt(5,We(w(n,Bt)))}var Ar={make:function(n){return[]},add:Tr,show:dr,encode:Gr};function mr(n,e,t,r){var u=gt(n.typeSection,t);return yt(n.funcSection,u),n.funcs.push([e,t,r]),xt(n.codeSection,r)+n.importsCount|0}function pr(n){return tn([[0,97,115,109,1,0,0,0],Et(n.typeSection),St(n.funcSection),Kt(n.tableSection),Gr(n.memorySection),sr(n.globalSection),Mt(n.exportSection),tr(n.elementSection),Dt(n.codeSection)])}var hr={make:function(n){return{typeSection:[],funcSection:[],tableSection:[],memorySection:[],globalSection:[],exportSection:[],elementSection:[],codeSection:[],funcs:[],importsCount:0}},getOrAddSignature:function(n,e){return gt(n.typeSection,e)},addFunc:mr,addExportedFunc:function(n,e,t,r){var u=mr(n,e,t,r),a={name:e,kind:0,index:u};return n.exportSection.push(a),u},addTable:function(n,e){n.tableSection.push(e)},addElement:function(n,e){n.elementSection.push(e)},addGlobal:function(n,e){n.globalSection.push(e)},addMemory:function(n,e){return Tr(n.memorySection,e)},encode:pr,encodeAsUint8Array:function(n){return e=pr(n),Uint8Array.from(e);var e},show:function(n){return _([wt(n.typeSection),It(n.funcSection,w(n.funcs,(function(n){return n[0]}))),Ht(n.tableSection),dr(n.memorySection),_r(n.globalSection),zt(n.exportSection),er(n.elementSection),Nt(n.codeSection,n.funcs)],"\n\n",(function(n){return n}))}},gr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",uleb128:qe,sleb128:Ze,Vec:He,F32:Ye,F64:Qe,Section:tt,ValueType:at,BlockReturnType:ct,Inst:vt,Func:ht,TypeSection:bt,FuncSection:kt,CodeSection:Ct,Str:Ft,ExportEntry:Ut,ExportSection:Pt,ReferenceType:jt,Limits:qt,Table:Wt,TableSection:Yt,Elem:nr,ElementSection:rr,Global:ir,GlobalSection:fr,Memory:vr,MemorySection:Ar,Module:hr});function Er(n){return[n,0,n.length]}function wr(n,e){var t=e[2],r=void 0!==n?n:1;return[e[0],Math.min(e[1]+r|0,t),t]}function br(n){return un(n[0],n[1])}function yr(n){return wr(1,n)}function Sr(n){return n[1]===n[2]}function Ir(n,e){var t=br(e);if(void 0!==t&&c(n,t))return[t,wr(void 0,e)]}function kr(n){return function(e){return Ir((function(e){return e===n}),e)}}function xr(n){return n>=97&&n<=122}function Dr(n){return n>=48&&n<=57}function Nr(n){return!!function(n){return!!xr(n)||function(n){return n>=65&&n<=90}(n)}(n)||Dr(n)}function Cr(n){return Ir(xr,n)}function Rr(n){return Ir(Nr,n)}function Fr(n){return n>13||n<9?32===n:!(12===n||11===n)}function Xr(n){return Ir(Fr,n)}function Or(n,e,t){return M(c(n,t),(function(n){return[c(e,n[0]),n[1]]}))}function Lr(n,e,t){for(;;){var r=t,u=void 0!==n?n:[];if(Sr(r))return[u,r];var a=c(e,r);if(void 0===a)return[u,r];u.push(a[0]),t=a[1],n=u}}function Ur(n){return Lr(void 0,Xr,n)}function Mr(n,e,t){return K(c(n,t),(function(n){var t=n[0];return M(c(e,n[1]),(function(n){return[[t,n[0]],n[1]]}))}))}function zr(n){return function(e){return Or((function(e){return Mr(n,(function(e){return Lr(void 0,n,e)}),e)}),(function(n){return s([n[0]],n[1])}),e)}}function Pr(n){if(!n)return function(n){return[0,n]};var e=n.hd,t=Pr(n.tl),r=function(n){return Mr(e,t,n)};return function(n){return Or(r,(function(n){return{hd:n[0],tl:n[1]}}),n)}}function jr(n,e,t){var r=c(n,t);return void 0!==r?[r[0],r[1]]:c(e,t)}function Vr(n,e){return he(n,(function(n){return c(n,e)}))}function Br(n){var e=Array.from(n,(function(n){var e=fn(n,0);return function(n){return Ir((function(n){return n===e}),n)}})),t=Pr(on(e));return function(e){return Or(t,(function(e){return n}),e)}}var qr=zr((function(n){return Ir(Dr,n)}));var Zr=Br("false");function $r(n){return Or(Zr,(function(n){return{TAG:1,_0:!1}}),n)}var Wr=Br("true");function Hr(n){return Or(Wr,(function(n){return{TAG:1,_0:!0}}),n)}var Kr=[Rr,kr(95),kr(39)];function Yr(n){return Vr(Kr,n)}function Jr(n){return Lr(void 0,Yr,n)}var Qr=kr(95);function nu(n){return jr(Cr,Qr,n)}function eu(n){return Mr(nu,Jr,n)}var tu=[Rr,kr(95)],ru=zr((function(n){return Vr(tu,n)}));var uu=Br("let"),au=Br("mut"),ou=Br("in"),cu=Br("if"),iu=Br("else"),_u=Br("fn"),su=Br("while"),fu=Br("return"),lu=Br("as"),vu=Br("unsafe"),Tu=Br("struct"),du=Br("impl"),Gu=[function(n){return Or(uu,(function(n){return{TAG:5,_0:0}}),n)},function(n){return Or(au,(function(n){return{TAG:5,_0:1}}),n)},function(n){return Or(ou,(function(n){return{TAG:5,_0:2}}),n)},function(n){return Or(cu,(function(n){return{TAG:5,_0:3}}),n)},function(n){return Or(iu,(function(n){return{TAG:5,_0:4}}),n)},function(n){return Or(_u,(function(n){return{TAG:5,_0:5}}),n)},function(n){return Or(su,(function(n){return{TAG:5,_0:6}}),n)},function(n){return Or(fu,(function(n){return{TAG:5,_0:7}}),n)},function(n){return Or(lu,(function(n){return{TAG:5,_0:8}}),n)},function(n){return Or(vu,(function(n){return{TAG:5,_0:9}}),n)},function(n){return Or(Tu,(function(n){return{TAG:5,_0:10}}),n)},function(n){return Or(du,(function(n){return{TAG:5,_0:11}}),n)}];function Au(n){return Vr(Gu,n)}function mu(n){return Mr(Au,(function(n){return void 0!==c(Rr,e=n)?void 0:[void 0,yr(e)];var e}),n)}var pu=Br("->"),hu=Br("=="),gu=Br("!="),Eu=kr(43),wu=kr(45),bu=kr(42),yu=kr(47),Su=kr(37),Iu=Br("<="),ku=Br(">="),xu=kr(60),Du=kr(62),Nu=kr(40),Cu=kr(41),Ru=kr(44),Fu=kr(59),Xu=kr(61),Ou=kr(123),Lu=kr(125),Uu=kr(58),Mu=kr(33),zu=kr(46),Pu=[function(n){return Or(pu,(function(n){return{TAG:2,_0:5}}),n)},function(n){return Or(hu,(function(n){return{TAG:2,_0:14}}),n)},function(n){return Or(gu,(function(n){return{TAG:2,_0:15}}),n)},function(n){return Or(Eu,(function(n){return{TAG:2,_0:9}}),n)},function(n){return Or(wu,(function(n){return{TAG:2,_0:10}}),n)},function(n){return Or(bu,(function(n){return{TAG:2,_0:11}}),n)},function(n){return Or(yu,(function(n){return{TAG:2,_0:12}}),n)},function(n){return Or(Su,(function(n){return{TAG:2,_0:13}}),n)},function(n){return Or(Iu,(function(n){return{TAG:2,_0:17}}),n)},function(n){return Or(ku,(function(n){return{TAG:2,_0:19}}),n)},function(n){return Or(xu,(function(n){return{TAG:2,_0:16}}),n)},function(n){return Or(Du,(function(n){return{TAG:2,_0:18}}),n)},function(n){return Or(Nu,(function(n){return{TAG:2,_0:0}}),n)},function(n){return Or(Cu,(function(n){return{TAG:2,_0:1}}),n)},function(n){return Or(Ru,(function(n){return{TAG:2,_0:2}}),n)},function(n){return Or(Fu,(function(n){return{TAG:2,_0:3}}),n)},function(n){return Or(Xu,(function(n){return{TAG:2,_0:4}}),n)},function(n){return Or(Ou,(function(n){return{TAG:2,_0:6}}),n)},function(n){return Or(Lu,(function(n){return{TAG:2,_0:7}}),n)},function(n){return Or(Uu,(function(n){return{TAG:2,_0:8}}),n)},function(n){return Or(Mu,(function(n){return{TAG:2,_0:20}}),n)},function(n){return Or(zu,(function(n){return{TAG:2,_0:21}}),n)}];var ju=[function(n){return Or(qr,(function(n){return{TAG:0,_0:ln(vn(_(n,"",(function(n){return Tn(1,n)}))))}}),n)},function(n){return jr(Hr,$r,n)},function(n){return Or(mu,(function(n){return n[0]}),n)},function(n){return Vr(Pu,n)},function(n){return Or(eu,(function(n){return{TAG:3,_0:Tn(1,n[0])+_(n[1],"",(function(n){return Tn(1,n)}))}}),n)},function(n){return Or(ru,(function(n){return{TAG:4,_0:_(n,"",(function(n){return Tn(1,n)}))}}),n)}];function Vu(n){return Vr(ju,n)}function Bu(n){return Lr(void 0,(function(n){return Or((function(n){return e=Ur,K(Mr(Ur,Vu,n),(function(n){var t=n[0],r=t[1],u=t[0];return M(c(e,n[1]),(function(n){return[[u,r,n[0]],n[1]]}))}));var e}),(function(n){return n[1]}),n)}),n)}function qu(n){switch(0|n.TAG){case 0:return String(n._0);case 1:return n._0?"true":"false";case 2:return function(n){switch(n){case 0:return"(";case 1:return")";case 2:return",";case 3:return";";case 4:return"=";case 5:return"->";case 6:return"{";case 7:return"}";case 8:return":";case 9:return"+";case 10:return"-";case 11:return"*";case 12:return"/";case 13:return"%";case 14:return"==";case 15:return"!=";case 16:return"<";case 17:return"<=";case 18:return">";case 19:return">=";case 20:return"!";case 21:return"."}}(n._0);case 3:case 4:return n._0;case 5:return function(n){switch(n){case 0:return"let";case 1:return"mut";case 2:return"in";case 3:return"if";case 4:return"else";case 5:return"fn";case 6:return"while";case 7:return"return";case 8:return"as";case 9:return"unsafe";case 10:return"struct";case 11:return"impl"}}(n._0)}}function Zu(n){return{contents:function(e){return K(br(e),(function(t){if(c(n,t))return[t,yr(e)]}))}}}function $u(n){return{contents:function(e){return K(br(e),(function(t){return M(c(n,t),(function(n){return[n,yr(e)]}))}))}}}function Wu(n){return Zu((function(e){return sn(e,n)}))}function Hu(n,e){return{contents:function(t){return M(c(n.contents,t),(function(n){return[c(e,n[0]),n[1]]}))}}}function Ku(n,e){return{contents:function(t){return K(c(n.contents,t),(function(n){var t=n[0];return M(c(e.contents,n[1]),(function(n){return[[t,n[0]],n[1]]}))}))}}}function Yu(n){var e=function(n){return{contents:function(t){if(Sr(t))return[0,t];var r=c(n.contents,t);if(void 0===r)return[0,t];var u=r[0];return M(c(e(n).contents,r[1]),(function(n){return[{hd:u,tl:n[0]},n[1]]}))}}};return Hu(e(n),A)}function Ju(n,e,t){return{contents:function(r){return K(c(Ku(n,e).contents,r),(function(n){var e=n[0],r=e[1],u=e[0];return M(c(t.contents,n[1]),(function(n){return[[u,r,n[0]],n[1]]}))}))}}}function Qu(n,e,t,r){return{contents:function(u){return K(c(Ju(n,e,t).contents,u),(function(n){var e=n[0],t=e[2],u=e[1],a=e[0];return M(c(r.contents,n[1]),(function(n){return[[a,u,t,n[0]],n[1]]}))}))}}}function na(n,e,t,r,u){return{contents:function(a){return K(c(Qu(n,e,t,r).contents,a),(function(n){var e=n[0],t=e[3],r=e[2],a=e[1],o=e[0];return M(c(u.contents,n[1]),(function(n){return[[o,a,r,t,n[0]],n[1]]}))}))}}}function ea(n,e){return{contents:function(t){var r=c(n.contents,t);return void 0!==r?[r[0],r[1]]:c(e.contents,t)}}}function ta(n){return{contents:function(e){return he(n,(function(n){return c(n.contents,e)}))}}}function ra(n,e,t){return Hu(Ku(n,Yu(e)),(function(n){var e=n[1],r=n[0];return sn(e,[])?r:h(e,r,t)}))}function ua(n,e,t){return ra(n,Ku(e,n),(function(n,e){return dn(t,n,e[0],e[1])}))}function aa(n){return Hu(Ju(Zu((function(n){return sn(n,{TAG:2,_0:0})})),n,Zu((function(n){return sn(n,{TAG:2,_0:1})}))),(function(n){return n[1]}))}function oa(n){return function(n,e){var t=function(r,u){var a=c(n.contents,r);if(void 0===a)return[u,r];var o=a[1];return u.push(a[0]),D(c(e.contents,o),[u,o],(function(n){return t(n[1],u)}))};return{contents:function(n){return t(n,[])}}}(n,Zu((function(n){return sn(n,{TAG:2,_0:2})})))}function ca(n){return ea(Hu(n,(function(n){return L(n)})),{contents:function(n){return[void 0,n]}})}var ia={contents:function(n){}},_a={contents:function(n){}},sa={contents:function(n){}},fa={contents:function(n){}},la={contents:function(n){}},va=$u((function(n){if(0===n.TAG)return{TAG:0,_0:{TAG:0,_0:n._0}}})),Ta=$u((function(n){if(1===n.TAG)return{TAG:0,_0:{TAG:1,_0:n._0}}})),da=$u((function(n){if(3===n.TAG)return n._0})),Ga=$u((function(n){if(4===n.TAG)return n._0})),Aa=$u((function(n){switch(0|n.TAG){case 3:case 4:return n._0;default:return}})),ma=ea(Hu(Ku(Wu({TAG:2,_0:0}),Wu({TAG:2,_0:1})),(function(n){return Wn})),$u((function(n){switch(0|n.TAG){case 3:switch(n._0){case"bool":return $n;case"u32":return Zn;default:return}case 4:return{TAG:2,_0:{TAG:0,_0:n._0}};default:return}}))),pa=ea(ma,aa(la)),ha=ea(Hu(Ju(ea(aa(oa(la)),Hu(pa,(function(n){return[n]}))),Wu({TAG:2,_0:5}),la),(function(n){return Hn(n[0],n[2])})),pa),ga=ea(Hu(Qu(Ga,Wu({TAG:2,_0:16}),oa(la),Wu({TAG:2,_0:18})),(function(n){return{TAG:1,_0:n[0],_1:n[2]}})),ha);la.contents=ga.contents;var Ea,wa,ba,ya,Sa,Ia,ka,xa=Hu(Ku(Aa,ca(Ku(Wu({TAG:2,_0:8}),la))),(function(n){return[n[0],M(n[1],(function(n){return n[1]}))]})),Da=Hu(ea(da,Aa),(function(n){return{TAG:3,_0:n}})),Na=ta([va,Ta,Hu(Ku(Wu({TAG:2,_0:0}),Wu({TAG:2,_0:1})),(function(n){return{TAG:0,_0:0}})),Da,Hu(aa(Qu(_a,Wu({TAG:2,_0:2}),_a,ca(Ku(Wu({TAG:2,_0:2}),oa(_a))))),(function(n){return{TAG:13,_0:s([n[0],n[2]],D(n[3],[],(function(n){return n[1]})))}})),aa(_a)]),Ca=ea(ra(Na,Ku(Wu({TAG:2,_0:21}),da),(function(n,e){return{TAG:15,_0:n,_1:e[1]}})),Na),Ra=ea(Hu(Ku(Ca,Hu(Ku(Ea=aa(oa(_a)),Yu(Ea)),(function(n){return s([n[0]],n[1])}))),(function(n){return h(n[1],n[0],(function(n,e){return{TAG:7,_0:n,_1:e}}))})),Ca),Fa=ta([Hu(Wu({TAG:2,_0:11}),(function(n){return 2})),Hu(Wu({TAG:2,_0:10}),(function(n){return 0})),Hu(Wu({TAG:2,_0:20}),(function(n){return 1}))]),Xa=ea(Hu(Wu({TAG:2,_0:9}),(function(n){return 0})),Hu(Wu({TAG:2,_0:10}),(function(n){return 1}))),Oa=ta([Hu(Wu({TAG:2,_0:11}),(function(n){return 2})),Hu(Wu({TAG:2,_0:12}),(function(n){return 3})),Hu(Wu({TAG:2,_0:13}),(function(n){return 4}))]),La=ta([Hu(Wu({TAG:2,_0:16}),(function(n){return 5})),Hu(Wu({TAG:2,_0:17}),(function(n){return 6})),Hu(Wu({TAG:2,_0:18}),(function(n){return 7})),Hu(Wu({TAG:2,_0:19}),(function(n){return 8}))]),Ua=ea(Hu(Wu({TAG:2,_0:14}),(function(n){return 9})),Hu(Wu({TAG:2,_0:15}),(function(n){return 10}))),Ma=ua(ea(Hu(Ku(Fa,Ra),(function(n){return{TAG:1,_0:n[0],_1:n[1]}})),Ra),Oa,(function(n,e,t){return{TAG:2,_0:n,_1:e,_2:t}})),za=ua(Ma,Xa,(function(n,e,t){return{TAG:2,_0:n,_1:e,_2:t}})),Pa=ua(za,La,(function(n,e,t){return{TAG:2,_0:n,_1:e,_2:t}})),ja=ua(Pa,Ua,(function(n,e,t){return{TAG:2,_0:n,_1:e,_2:t}})),Va=ea(Hu(Qu(Wu({TAG:5,_0:3}),_a,sa,ca(Ku(Wu({TAG:5,_0:4}),sa))),(function(n){return{TAG:9,_0:n[1],_1:n[2],_2:M(n[3],(function(n){return n[1]}))}})),ja),Ba=ea(Hu(Ju(Wu({TAG:5,_0:6}),_a,sa),(function(n){return{TAG:10,_0:n[1],_1:n[2]}})),Va),qa=ea(Hu((wa=Wu({TAG:5,_0:0}),ba=da,ya=Wu({TAG:2,_0:4}),Sa=_a,Ia=Wu({TAG:5,_0:2}),ka=_a,{contents:function(n){return K(c(na(wa,ba,ya,Sa,Ia).contents,n),(function(n){var e=n[0],t=e[4],r=e[3],u=e[2],a=e[1],o=e[0];return M(c(ka.contents,n[1]),(function(n){return[[o,a,u,r,t,n[0]],n[1]]}))}))}}),(function(n){return{TAG:6,_0:n[1],_1:n[3],_2:n[5]}})),Ba),Za=ea(aa(oa(da)),Hu(da,(function(n){return[n]}))),$a=ua(ea(Hu(Ju(Za,Wu({TAG:2,_0:5}),_a),(function(n){return{TAG:5,_0:n[0],_1:n[2]}})),qa),Wu({TAG:2,_0:4}),(function(n,e,t){return{TAG:4,_0:n,_1:t}})),Wa=function(n,e){return{contents:function(t){var r=c(n.contents,t);if(void 0!==r){var u=r[1];return M(c(e,r[0]),(function(n){return[n,u]}))}}}}(_a,(function(n){switch(0|n.TAG){case 9:case 10:return[!0,{TAG:1,_0:n}];default:return}}));sa.contents=ea(Hu(na(ca(Wu({TAG:5,_0:9})),Wu({TAG:2,_0:6}),Yu(ea(Hu(fa,(function(n){return[!1,n]})),Wa)),ca(_a),Wu({TAG:2,_0:7})),(function(n){var e=n[3],t=n[2],r=w(t,(function(n){return n[1]})),u=D(n[0],0,(function(n){return 1})),a=un(t,t.length-1|0);if(void 0===a)return{TAG:8,_0:r,_1:e,_2:u};var o=a[1];return 0!==o.TAG&&a[0]&&O(e)?{TAG:8,_0:m(r,0,t.length-2|0),_1:o._0,_2:u}:{TAG:8,_0:r,_1:e,_2:u}})),$a).contents;var Ha=ea(Hu(Qu(Ga,Wu({TAG:2,_0:6}),oa(Ju(da,Wu({TAG:2,_0:8}),_a)),Wu({TAG:2,_0:7})),(function(n){return{TAG:14,_0:n[0],_1:w(n[2],(function(n){return[n[0],n[2]]}))}})),sa),Ka=ea(Hu(Ku(Wu({TAG:5,_0:7}),ca(_a)),(function(n){return{TAG:11,_0:n[1]}})),Ha),Ya=Hu(Ku(Ka,ca(Ku(Wu({TAG:5,_0:8}),la))),(function(n){var e=n[1],t=n[0];return void 0!==e?{TAG:12,_0:t,_1:e[1]}:t}));_a.contents=Ya.contents;var Ja=Hu(Ku(_a,Wu({TAG:2,_0:3})),(function(n){return{TAG:1,_0:n[0]}})),Qa=ea(Hu(na(ea(Wu({TAG:5,_0:0}),Wu({TAG:5,_0:1})),xa,Wu({TAG:2,_0:4}),_a,Wu({TAG:2,_0:3})),(function(n){var e=n[1];return{TAG:0,_0:e[0],_1:sn(n[0],{TAG:5,_0:1}),_2:n[3],_3:e[1]}})),Ja);fa.contents=Qa.contents;var no=Hu(na(ea(Wu({TAG:5,_0:0}),Wu({TAG:5,_0:1})),Aa,Wu({TAG:2,_0:4}),_a,Wu({TAG:2,_0:3})),(function(n){return{TAG:1,_0:n[1],_1:sn(n[0],{TAG:5,_0:1}),_2:n[3]}})),eo=ea(Hu(na(Wu({TAG:5,_0:10}),Ga,Wu({TAG:2,_0:6}),oa(Ju(Ku(ca(Wu({TAG:5,_0:1})),da),Wu({TAG:2,_0:8}),la)),Wu({TAG:2,_0:7})),(function(n){var e=w(n[3],(function(n){var e=n[0];return[e[1],n[2],Gn(e[0])]}));return{TAG:2,_0:n[1],_1:e}})),no),to=ea(Hu(Qu(Wu({TAG:5,_0:5}),da,Hu(aa(oa(Ku(ca(Wu({TAG:5,_0:1})),da))),(function(n){return w(n,(function(n){return[n[1],Gn(n[0])]}))})),sa),(function(n){return{TAG:0,_0:n[1],_1:n[2],_2:n[3]}})),eo),ro=ea(Hu(Ju(Wu({TAG:5,_0:11}),Ga,Hu(Ju(Wu({TAG:2,_0:6}),Yu(to),Wu({TAG:2,_0:7})),(function(n){return n[1]}))),(function(n){return{TAG:3,_0:n[1],_1:n[2]}})),to);ia.contents=ro.contents;var uo=Yu(ia);function ao(n){var e,t=n.replace(/(\/\/[^\n]*)/g,""),r=Bu((e=t,Er(Array.from(e,(function(n){return fn(n,0)})))));if(void 0===r)return{TAG:1,_0:"could not tokenize"};var u=c(uo.contents,Er(r[0]));if(void 0===u)return{TAG:1,_0:"could not parse"};var a,o=u[1];return Sr(o)?{TAG:0,_0:u[0]}:{TAG:1,_0:"could not parse near "+_(m((a=o)[0].slice(a[1],a[2]),0,5)," ",qu)}}function oo(n,e){switch(0|e.TAG){case 0:return n===e._0;case 1:return wn(e._1,(function(e){return oo(n,e)}));case 2:var t=e._0;return 0!==t.TAG&&wn(re.toArray(t._0),(function(e){return oo(n,e[1])}))}}function co(n,e,t){if(oo(n,e))return{TAG:1,_0:ce({TAG:0,_0:n})+" occurs in "+ce(e)};var r=X(t,n);return void 0!==r?sn(r,e)?{TAG:0,_0:t}:{TAG:1,_0:ce(e)+" is not unifiable with "+ce(r)}:{TAG:0,_0:En(t,n,e)}}function io(n,e){for(;;){var t=n;if(!t)return{TAG:0,_0:e};var r=t.tl,u=t.hd,a=u[1],o=u[0],c=0;switch(0|o.TAG){case 0:var i=o._0,_=0;switch(0|a.TAG){case 0:if(i===a._0){n=r;continue}_=3;break;case 1:case 2:_=3}if(3===_)return pn(co(i,a,e),function(n){return function(e){return io(n,e)}}(r));break;case 1:var s=o._1;switch(0|a.TAG){case 0:c=1;break;case 1:var f=a._1;if(o._0===a._0&&s.length===f.length){n=h(H(s,f),r,(function(n,t){return{hd:[Ae(e,t[0]),Ae(e,t[1])],tl:n}}));continue}c=2;break;case 2:c=2}break;case 2:var l=o._0;switch(0|a.TAG){case 0:c=1;break;case 1:c=2;break;case 2:var d=a._0;if(0===l.TAG){var G=l._0;if(0===d.TAG){if(G!==d._0)return{TAG:1,_0:"cannot unify "+ce(o)+" with "+ce(a)};n=r;continue}var A=De(G);if(void 0===A)return{TAG:1,_0:'undeclared struct "'+G+'"'};var m=io({hd:[{TAG:2,_0:{TAG:1,_0:d._0}},we.toPartialStructType(A,ye())],tl:r},e);return 0===m.TAG?{TAG:0,_0:m._0}:{TAG:1,_0:"struct type "+ce(a)+" does not match "+G+": "+m._0}}var p=l._0;if(0===d.TAG){var g=d._0,E=De(g);if(void 0===E)return{TAG:1,_0:'undeclared struct "'+g+'"'};var b=io({hd:[{TAG:2,_0:{TAG:1,_0:p}},we.toPartialStructType(E,ye())],tl:r},e);return 0===b.TAG?{TAG:0,_0:b._0}:{TAG:1,_0:"struct type "+ce(o)+" does not match "+g+": "+b._0}}var y=re.toMap(d._0),S=re.toArray(p);return pn(Ee(w(S,function(n,e,t){return function(r){var u=r[0],a=v(t,u);return void 0!==a?{TAG:0,_0:[r[1],a]}:{TAG:1,_0:"struct type "+ce(e)+' is missing attribute "'+u+'" from type "'+ce(n)+'"'}}}(o,a,y)),(function(n){return n})),function(n,t,r,u){return function(a){var o={TAG:2,_0:{TAG:1,_0:re.fromArray(T(hn(r,w(u,(function(n){return n[0]})))),ye())}};return io(gn(on(a),{hd:[re.tail(t),o],tl:n}),e)}}(r,p,y,S))}}switch(c){case 1:return pn(co(a._0,o,e),function(n){return function(e){return io(n,e)}}(r));case 2:return{TAG:1,_0:ce(o)+" is not unifiable with "+ce(a)}}}}function _o(n,e){return io({hd:[n,e],tl:0},void 0)}function so(n){if(8!==n.TAG)return n;var e=n._3,t=n._2,r=n._0,u=function(n){if(!n)return M(t,so);var a=n.hd;return 0===a.TAG?{TAG:6,_0:r,_1:a._0,_2:so(a._2),_3:D(u(n.tl),{TAG:0,_0:0},(function(n){return n}))}:{TAG:8,_0:r,_1:[fo(a)],_2:u(n.tl),_3:e}};return{TAG:8,_0:r,_1:[],_2:u(on(n._1)),_3:e}}function fo(n){return 0===n.TAG?{TAG:0,_0:n._0,_1:n._1,_2:so(n._2)}:{TAG:1,_0:so(n._0)}}function lo(n){switch(0|n.TAG){case 0:return{TAG:0,_0:n._0,_1:n._1,_2:so(n._2)};case 1:return{TAG:1,_0:n._0,_1:n._1,_2:so(n._2)};case 2:return n;case 3:return{TAG:3,_0:n._0,_1:w(n._1,(function(n){return[n[0],n[1],so(n[2])]}))}}}function vo(n){var e=Nn(Cn(be.structs),(function(e){return Fn(_o({TAG:2,_0:{TAG:1,_0:n}},we.toPartialStructType(e,ye())),void 0,(function(n){return e}))}));return 1!==e.length?0===e.length?0:{TAG:1,_0:e}:{TAG:0,_0:e[0]}}var To={ambiguousMatchesError:function(n,e){return"cannot infer struct type: inferred type "+re.show(n,ce)+" matches "+_(e,", ",(function(n){return n.name}))},findMatchingStruct:vo},Go=In();function Ao(n,e,t){return pn(mo(n,e),(function(n){return yn(_o(Ae(n,t),Ae(n,Ve.typeOf(e))),(function(e){return me(e,n)}))}))}function mo(n,e){switch(0|e.TAG){case 0:var t=Ie(function(n){return Bn("number"==typeof n?Wn:0===n.TAG?Zn:$n)}(e._0));return _o(Ve.typeOf(e),t);case 1:var r=e._3,u=e._2,a=e._1,o=e._0;return pn(mo(n,a),(function(e){var t=pe(e,n);return pn(mo(t,r),(function(n){var t=me(n,e),c=Ae(t,Hn([Ve.typeOf(a),Ve.typeOf(r)],o)),i=Ie(function(n){return n>=5?n>=9?[[0],Hn([{TAG:0,_0:0},{TAG:0,_0:0}],$n)]:Bn(Hn([Zn,Zn],$n)):Bn(Hn([Zn,Zn],Zn))}(u));return yn(_o(c,i),(function(n){return me(n,t)}))}))}));case 2:var c=e._2,i=e._1,_=e._0,s=Ve.typeOf(c);return pn(mo(n,c),(function(n){var e=Ae(n,Hn([s],_)),t=Ie(function(n){switch(n){case 0:return Bn(Hn([Zn],Zn));case 1:return Bn(Hn([$n],$n));case 2:return[[0],Hn([(e={TAG:0,_0:0},{TAG:1,_0:"Ptr",_1:[e]})],{TAG:0,_0:0})]}var e}(i));return yn(_o(e,t),(function(e){return me(e,n)}))}));case 3:var f=e._0.contents,l=qn.get(n,f.name);return void 0!==l?_o(f.ty,Ie(l)):{TAG:1,_0:'unbound variable: "'+f.name+'"'};case 4:var T=e._1,d=e._0,G=je.typeOfExpr(d),A=je.typeOfExpr(T);return pn(mo(n,T),(function(e){var t=pe(e,n),r=Ae(e,G);return pn(Ao(t,d,r),(function(n){var t=me(n,e),u=Ae(n,r),a=Ae(t,A);return yn(_o(u,a),(function(n){return me(n,t)}))}))}));case 5:var m=e._3,p=e._2,g=e._0,E=Ve.typeOf(m);xn(Go,E);var b=h(p,n,(function(n,e){return qn.addMono(n,e.contents.name,e.contents.ty)})),y=Hn(w(p,(function(n){return n.contents.ty})),E),S=D(e._1,b,(function(n){return qn.add(b,n.contents.name,Bn(y))}));return pn(Ao(S,m,E),(function(n){var e=Ae(n,y),t=Ae(n,g);return pn(_o(t,e),(function(e){var t=me(e,n);return Dn(Go),{TAG:0,_0:t}}))}));case 6:var I=e._3,k=e._2,x=e._0,N=e._1.contents,C=Ve.typeOf(k);return pn(mo(n,k),(function(e){var t=pe(e,n),r=Ae(e,C),u=Ae(e,x),a=oe(qn.remove(t,N.name),r),o=qn.add(t,N.name,a);return pn(Ao(o,I,u),(function(n){var t=me(n,e);return yn(_o(Ae(t,C),Ae(t,N.ty)),(function(n){return me(n,t)}))}))}));case 7:var R=e._2,F=w(R,Ve.typeOf),X=Hn(F,e._0);return yn(pn(Ao(n,e._1,X),(function(e){return h(H(R,F),{TAG:0,_0:[e,pe(e,n)]},(function(n,e){var t=e[1],r=e[0];return pn(n,(function(n){var e=n[1],u=n[0],a=Ae(u,t);return yn(Ao(e,r,a),(function(n){return[me(n,u),pe(n,e)]}))}))}))})),(function(n){return n[0]}));case 8:var L=e._2,U=e._0;return pn(h(e._1,{TAG:0,_0:[void 0,n]},(function(n,e){return pn(n,(function(n){var t=n[1],r=n[0];return yn(function(n,e){return 0===e.TAG?{TAG:1,_0:"CoreLetStmt should have been rewritten to CoreLetIn in the inferencer"}:mo(n,e._0)}(t,e),(function(n){return[me(n,r),pe(n,t)]}))}))})),(function(e){var t=e[0];return void 0!==L?pn(mo(pe(t,n),L),(function(n){var e=Ve.typeOf(L),r=me(n,t);return yn(_o(Ae(r,U),Ae(r,e)),(function(n){return me(n,r)}))})):yn(_o(Ae(t,U),Wn),(function(n){return me(n,t)}))}));case 9:var M=e._3,z=e._2,P=e._0;return pn(Ao(n,e._1,$n),(function(e){var t=pe(e,n),r=Ae(e,P);return pn(Ao(t,z,r),(function(n){var u=pe(n,t),a=Ae(n,r),o=me(n,e);return yn(Ao(u,M,a),(function(n){return me(n,o)}))}))}));case 10:var j=e._1,V=Ve.typeOf(j);return pn(mo(n,e._0),(function(e){var t=Ae(e,V),r=pe(e,n);return yn(Ao(r,j,t),(function(n){return me(n,e)}))}));case 11:var B=kn(Go);return void 0!==B?Ao(n,D(e._0,{TAG:0,_0:0},(function(n){return n})),B):{TAG:1,_0:"'return' used outside of a function"};case 12:return Ao(n,e._0,e._1);case 13:var q=h(e._0,{TAG:0,_0:[undefined,n]},(function(n,e){return pn(n,(function(n){var t=n[1],r=n[0];return pn(mo(t,e),(function(n){return{TAG:0,_0:[me(n,r),pe(n,t)]}}))}))}));return yn(q,(function(n){return n[0]}));case 14:var Z=e._1,$=e._0,W=De($);if(void 0===W)return{TAG:1,_0:'undeclared struct "'+$+'"'};var K=h(en(W.attributes,(function(n){return O(n.impl)})),{TAG:0,_0:[n,undefined]},(function(n,e){var t=e.ty,r=e.name;return pn(n,(function(n){var e=n[1],u=n[0],a=nn(Z,(function(n){return n[0]===r}));return void 0!==a?pn(Ao(u,a[1],t),(function(n){return{TAG:0,_0:[pe(n,u),me(n,e)]}})):{TAG:1,_0:'missing attribute "'+r+'" for struct "'+$+'"'}}))}));return yn(K,(function(n){return n[1]}));case 15:var Y=e._2,J=e._1,Q=e._0;return pn(mo(n,J),(function(t){var r=je.typeOfExpr(J),u=Ae(t,r),a=function(t){return Rn(u,Ae(t,r))?Ao(pe(t,n),e,Ae(t,Q)):{TAG:0,_0:t}};switch(0|u.TAG){case 0:case 1:break;case 2:var o=u._0;if(0===o.TAG){var c=o._0,i=De(c);if(void 0===i)return{TAG:1,_0:'undeclared struct: "'+c+'"'};var _=nn(i.attributes,(function(n){return n.name===Y}));if(void 0===_)return{TAG:1,_0:'attribute "'+Y+'" does not exist on struct "'+c+'"'};var s=D(_.impl,_.ty,(function(n){return n[0].contents.ty}));return yn(_o(Ae(t,Q),Ae(t,s)),(function(n){return me(n,t)}))}var f=o._0,l=v(re.toMap(f),Y);if(void 0!==l)return yn(_o(Ae(t,Q),Ae(t,l)),(function(n){return me(n,t)}));var T=re.insert(f,Y,Q),d=Ae(t,{TAG:2,_0:{TAG:1,_0:T}}),G=vo(T);if("number"!=typeof G)return 0===G.TAG?pn(_o(u,{TAG:2,_0:{TAG:0,_0:G._0.name}}),(function(n){return a(me(n,t))})):pn(_o(u,d),(function(n){return a(me(n,t))}));var A=0;switch(0|r.TAG){case 0:return{TAG:0,_0:me(En(undefined,r._0,d),t)};case 1:case 2:A=2}if(2===A)return yn(_o(r,d),(function(n){return me(n,t)}))}var m=ye(),p=re.insert(re.make({TAG:0,_0:m}),Y,Q),h=Ae(t,{TAG:2,_0:{TAG:1,_0:p}}),g=vo(p);return"number"==typeof g?{TAG:1,_0:"no struct declaration matches type "+ce(h)}:0===g.TAG?pn(_o(u,{TAG:2,_0:{TAG:0,_0:g._0.name}}),(function(n){return a(me(n,t))})):pn(_o(u,h),(function(n){return a(me(n,t))}))}))}}function po(n,e){return"impl_"+n+"_"+e}function ho(n,e){switch(0|e.TAG){case 0:var t=e._0;return yn(mo(n,{TAG:5,_0:t.contents.ty,_1:t,_2:w(e._1,(function(n){return n[0]})),_3:e._2}),(function(e){return[pe(e,qn.addMono(n,t.contents.name,t.contents.ty)),e]}));case 1:var r=e._0;return yn(Ao(n,e._2,r.contents.ty),(function(e){return[pe(e,qn.addMono(n,r.contents.name,r.contents.ty)),e]}));case 2:return o=we.make(e._0,e._1),Z(be.structs,o.name,o),{TAG:0,_0:[n,undefined]};case 3:var u=e._0,a=De(u);return void 0!==a?h(e._1,{TAG:0,_0:[n,undefined]},(function(n,e){var t=e[2],r=e[1],o=e[0];return pn(n,(function(n){var e=n[1],c=n[0];o.contents.newName=po(u,o.contents.name);var i=un(r,0),_=void 0!==i&&i[1];we.addImpl(a,o,_);var s,f=sn(r,[])?[]:Sn(r,1),l={TAG:2,_0:{TAG:0,_0:u}},v=un(r,0);if(void 0!==v){var T=v[0];T.contents.ty=l,s=qn.addMono(c,T.contents.name,l)}else s=c;return pn(ho(s,{TAG:0,_0:o,_1:f,_2:t}),(function(n){var t=me(n[1],e);return xe(t,o),{TAG:0,_0:[qn.remove(n[0],o.contents.name),t]}}))}))})):{TAG:1,_0:'cannot implement for unknown type "'+u+'"'}}var o}var go=E("Compiler.CompilerExn.InvalidTypeConversion"),Eo=E("Compiler.CompilerExn.InvalidFunctionSignature"),wo=E("Compiler.CompilerExn.VariableNotFound"),bo=E("Compiler.CompilerExn.EmptyFunctionStack"),yo=E("Compiler.CompilerExn.CannotReassignImmutableValue"),So=E("Compiler.CompilerExn.FunctionNotFound"),Io=E("Compiler.CompilerExn.Unimplemented"),ko=E("Compiler.CompilerExn.UnsupportedGlobalInitializer"),xo=E("Compiler.CompilerExn.InvalidTypeAssertion"),Do=E("Compiler.CompilerExn.DerefUsedOutsideOfUnsafeBlock"),No=E("Compiler.CompilerExn.UndeclaredStruct"),Co=E("Compiler.CompilerExn.InvalidAttributeAccess"),Ro=E("Compiler.CompilerExn.StructTypeNotMatched"),Fo=E("Compiler.CompilerExn.AmibguousStruct");function Xo(n){return n.RE_EXN_ID===go?"unsupported type: "+ce(n._1):n.RE_EXN_ID===Eo?"invalid function signature: "+ce(n._1):n.RE_EXN_ID===wo?'variable "'+n._1+'" not found':n.RE_EXN_ID===bo?"Function stack is empty":n.RE_EXN_ID===yo?'cannot mutate "'+n._1+'" as it is behind an immutable binding':n.RE_EXN_ID===So?'no function named "'+n._1+'" found':n.RE_EXN_ID===Io?"unimplemented: "+n._1:n.RE_EXN_ID===ko?"unsupported global initializer: "+Ve.show(void 0,n._1):n.RE_EXN_ID===xo?"invalid type assertion from "+ce(n._1)+" to "+ce(n._2):n.RE_EXN_ID===Do?"the deref operator can only be used in an unsafe block":n.RE_EXN_ID===Qn.UnkownTypeSize?"unknown type size: "+ce(n._1):n.RE_EXN_ID===No?'undeclared struct "'+n._1+'"':n.RE_EXN_ID===Co?n._1+' does not exist for type "'+ce(n._2)+'"':n.RE_EXN_ID===Ro?"No struct declaration matches type "+ce(n._1):n.RE_EXN_ID===Fo?To.ambiguousMatchesError(n._1,n._2):"unexpected compiler exception"}function Oo(n){if(0===n.TAG){var e=n._0,t=De(e);if(void 0!==t)return t;throw{RE_EXN_ID:No,_1:e,Error:new Error}}var r=n._0,u=To.findMatchingStruct(r);if("number"==typeof u)throw{RE_EXN_ID:Ro,_1:{TAG:2,_0:n},Error:new Error};if(0===u.TAG)return u._0;throw{RE_EXN_ID:Fo,_1:r,_2:u._0,Error:new Error}}function Lo(n){switch(0|n.TAG){case 0:throw{RE_EXN_ID:go,_1:n,Error:new Error};case 1:switch(n._0){case"()":if(0!==n._1.length)throw{RE_EXN_ID:go,_1:n,Error:new Error};return[];case"Fun":case"Ptr":return[0];case"Tuple":return tn(w(n._1,Lo));case"bool":case"u32":break;case"u64":if(0!==n._1.length)throw{RE_EXN_ID:go,_1:n,Error:new Error};return[1];default:throw{RE_EXN_ID:go,_1:n,Error:new Error}}if(0!==n._1.length)throw{RE_EXN_ID:go,_1:n,Error:new Error};return[0];case 2:return 0===Oo(n._0).size?[]:[0]}}function Uo(n,e){switch(0|e.TAG){case 1:if("Tuple"===e._0){var t=tn(w(e._1,Lo)),r={_0:[],_1:t};return{TAG:1,_0:hr.getOrAddSignature(n,r),_1:[[],t]}}}var u=Lo(e),a=u.length;if(1!==a){if(0===a)return 0;throw{RE_EXN_ID:Io,_1:"wasmBlockReturnTypeOf for "+ce(e),Error:new Error}}return{TAG:0,_0:u[0]}}function Mo(n){switch(0|n.TAG){case 1:if("Fun"===n._0){var e=n._1,t=e.slice(0,e.length-1|0),r=un(e,e.length-1|0);return Ln(ht.Signature.make,tn(w(t,Lo)),D(r,[],Lo))}throw{RE_EXN_ID:Eo,_1:n,Error:new Error};case 0:case 2:throw{RE_EXN_ID:Eo,_1:n,Error:new Error}}}function zo(n,e){n.instructions.push(e)}function Po(n){var e=Mo(Hn(w(n.params,(function(n){return n[1]})),n.ret)),t=c(ht.Local.fromTypes,tn(w(n.locals,(function(n){return w(Lo(n.ty),(function(e){return[n.name,e]}))})))),r=Ln(ht.Body.make,t,function(n){for(var e=on(n),t=0;;){var r=t,u=e;if(!u)return G(A(r));var a=u.hd,o=0;if("number"==typeof a)switch(a){case 2:var c=u.tl;if(c&&3===c.hd){e={hd:2,tl:c.tl};continue}break;case 9:var i=u.tl;if(i&&9===i.hd){e=i.tl;continue}break;case 10:var _=u.tl;if(_&&9===_.hd){e={hd:14,tl:_.tl};continue}break;case 14:var s=u.tl;if(s&&9===s.hd){e={hd:10,tl:s.tl};continue}break;case 18:var f=u.tl;if(f&&9===f.hd){e={hd:36,tl:f.tl};continue}break;case 19:var l=u.tl;if(l&&9===l.hd){e={hd:37,tl:l.tl};continue}break;case 24:var v=u.tl;if(v&&9===v.hd){e={hd:30,tl:v.tl};continue}break;case 25:var T=u.tl;if(T&&9===T.hd){e={hd:31,tl:T.tl};continue}break;case 30:var d=u.tl;if(d&&9===d.hd){e={hd:24,tl:d.tl};continue}break;case 31:var m=u.tl;if(m&&9===m.hd){e={hd:25,tl:m.tl};continue}break;case 36:var p=u.tl;if(p&&9===p.hd){e={hd:18,tl:p.tl};continue}break;case 37:var h=u.tl;if(h&&9===h.hd){e={hd:19,tl:h.tl};continue}}else switch(0|a.TAG){case 0:var g=a._0,E=0,w=u.tl;if(w){var b=w.hd;if("number"==typeof b){if(3===b){e=w.tl;continue}E=3}else switch(0|b.TAG){case 0:var y=w.tl;if(y){var S=y.hd;if("number"==typeof S){var I=b._0;if(43===S){e={hd:{TAG:0,_0:mn(g,I)},tl:y.tl};continue}if(S<15)switch(S){case 4:e={hd:{TAG:0,_0:g+I|0},tl:y.tl};continue;case 5:e={hd:{TAG:0,_0:g-I|0},tl:y.tl};continue;case 6:e={hd:{TAG:0,_0:Math.imul(g,I)},tl:y.tl};continue;case 7:e={hd:{TAG:0,_0:An(g,I)},tl:y.tl};continue;case 10:e={hd:{TAG:0,_0:g===I?1:0},tl:y.tl};continue;case 0:case 1:case 2:case 3:case 8:case 9:case 11:case 12:case 13:break;case 14:e={hd:{TAG:0,_0:g===I?0:1},tl:y.tl};continue}}}break;case 15:e={hd:{TAG:14,_0:g},tl:w.tl};continue;default:E=3}}if(3===E&&0===g){var k=u.tl;if(10===k.hd){e={hd:9,tl:k.tl};continue}}break;case 1:case 2:case 3:case 11:o=2;break;case 12:var x=u.tl;if(x){var D=x.hd;if("number"!=typeof D&&11===D.TAG){var N=a._0;if(N===D._0){e={hd:{TAG:13,_0:N},tl:x.tl};continue}}}break;case 13:var C=u.tl;if(C&&3===C.hd){e={hd:{TAG:12,_0:a._0},tl:C.tl};continue}}if(2===o){var R=u.tl;if(R&&3===R.hd){e=R.tl;continue}}t={hd:a,tl:r},e=u.tl}}(n.instructions));return ht.make(n.name,e,r)}function jo(n,e,t,r,u){return{name:n,isMutable:e,ty:t,index:r,init:u}}function Vo(n){var e=kn(n.funcStack);if(void 0!==e)return e;throw{RE_EXN_ID:bo,Error:new Error}}function Bo(n,e){return t=n.funcs,M(z(t,(function(n){return n.name===e})),(function(n){return[p(t,n),n]}));var t}function qo(n,e){var t=kn(n.blockStack);if(void 0!==t&&!(e<=0)){var r=t.shadowStackDelta;return r.contents=r.contents+e|0,zo(Vo(n),{TAG:9,_0:n.stackTop.index}),zo(Vo(n),{TAG:0,_0:e}),zo(Vo(n),5),zo(Vo(n),{TAG:10,_0:n.stackTop.index})}}function Zo(n){var e=kn(n.blockStack);return void 0!==e&&e.isUnsafe}function $o(n,e){return n.scopeDepth=n.scopeDepth+1|0,xn(n.blockStack,{isUnsafe:e||Zo(n),shadowStackDelta:{contents:0}})}function Wo(n){n.scopeDepth=n.scopeDepth-1|0,function(n,e){var t=kn(n.blockStack);if(void 0!==t&&!(e<=0)){var r=t.shadowStackDelta;r.contents=r.contents-e|0,zo(Vo(n),{TAG:9,_0:n.stackTop.index}),zo(Vo(n),{TAG:0,_0:e}),zo(Vo(n),4),zo(Vo(n),{TAG:10,_0:n.stackTop.index})}}(n,D(kn(n.blockStack),0,(function(n){return n.shadowStackDelta.contents}))),Dn(n.blockStack)}function Ho(n,e,t,r){var u=function(n,e,t,r,u){return n.locals.push(function(n,e,t,r){return{name:n,depth:e,ty:t,isMutable:r}}(e,r,t,u)),(n.params.length+n.locals.length|0)-1|0}(Vo(n),e,t,n.scopeDepth,r);return zo(Vo(n),{TAG:12,_0:u})}function Ko(n,e){var t=function(n,e){var t=z(n.params,(function(n){return n[0]===e}));if(void 0!==t)return[t,p(n.params,t)[2]];var r=ge(n.locals,(function(n){return n.name===e}));return void 0!==r?[n.params.length+r|0,p(n.locals,r).isMutable]:void 0}(Vo(n),e);return void 0!==t?{TAG:0,_0:t[0],_1:t[1]}:M(q(n.globals,e),(function(n){return{TAG:1,_0:n.index,_1:n.isMutable}}))}function Yo(n){return"number"==typeof n?void 0:0===n.TAG?{TAG:0,_0:n._0}:{TAG:0,_0:n._0?1:0}}function Jo(n){if(!Zo(n))throw{RE_EXN_ID:Do,Error:new Error}}function Qo(n,e,t){switch(0|e.TAG){case 0:case 1:return{TAG:1,_0:{RE_EXN_ID:Co,_1:t,_2:e}};case 2:var r=Oo(e._0),u=nn(r.attributes,(function(n){return n.name===t}));if(void 0===u)return{TAG:1,_0:{RE_EXN_ID:Co,_1:t,_2:e}};var a=u.impl;if(void 0===a)return{TAG:0,_0:{TAG:0,_0:{offset:u.offset,ty:u.ty,size:u.size,mut:u.mut}}};var o=Bo(n,po(r.name,a[0].contents.name));return void 0!==o?{TAG:0,_0:{TAG:1,_0:[o[0],o[1],a[1]]}}:{TAG:1,_0:{RE_EXN_ID:Co,_1:t,_2:e}}}}function nc(n,e){for(;;){var t=e;switch(0|t.TAG){case 3:var r=t._0,u=Ko(n,r.contents.newName);if(void 0!==u)return u._1?void 0:r.contents.name;throw{RE_EXN_ID:wo,_1:r.contents.name,Error:new Error};case 15:var a=t._2,o=t._1,c=Qo(n,je.typeOfExpr(o),a);if(0===c.TAG){var i=c._0;if(0!==i.TAG)return;if(!i._0.mut)return a;e=o;continue}throw c._0;default:return}}}function ec(n,e){for(;;){var t=e;switch(0|t.TAG){case 0:var r=Yo(t._0);return void 0!==r?zo(Vo(n),r):void 0;case 1:var u,a=t._2,o=t._1;if(Qn.isZeroSizedType(je.typeOfExpr(o))){e={TAG:0,_0:{TAG:1,_0:9===a}};continue}switch(a){case 0:u=4;break;case 1:u=5;break;case 2:u=6;break;case 3:u=7;break;case 4:u=43;break;case 5:u=31;break;case 6:u=19;break;case 7:u=37;break;case 8:u=25;break;case 9:u=10;break;case 10:u=14}return ec(n,o),ec(n,t._3),zo(Vo(n),u);case 2:var c;switch(t._1){case 0:throw{RE_EXN_ID:Io,_1:"u32 negation is not handled",Error:new Error};case 1:c=9;break;case 2:Jo(n),c={TAG:16,_0:0,_1:0}}return ec(n,t._2),zo(Vo(n),c);case 3:var i=t._0;if(Qn.isZeroSizedType(i.contents.ty))return;var _=Ko(n,i.contents.newName);if(void 0!==_)return 0===_.TAG?zo(Vo(n),{TAG:11,_0:_._0}):zo(Vo(n),{TAG:9,_0:_._0});throw{RE_EXN_ID:wo,_1:i.contents.name,Error:new Error};case 4:var s=t._1,f=t._0;if(Qn.isZeroSizedType(je.typeOfExpr(s)))return;switch(0|f.TAG){case 2:if(f._1>=2){Jo(n),ec(n,f._2),ec(n,s);var l={TAG:17,_0:Qn.sizeLog2(je.typeOfExpr(s)),_1:0};return zo(Vo(n),l)}throw{RE_EXN_ID:Io,_1:"[unreachable]: assignement to an invalid lhs expression",Error:new Error};case 3:var v=f._0,T=Ko(n,v.contents.newName);if(void 0!==T){var d;if(T._1)return d=0===T.TAG?{TAG:12,_0:T._0}:{TAG:10,_0:T._0},ec(n,s),zo(Vo(n),d);throw{RE_EXN_ID:yo,_1:v.contents.name,Error:new Error}}throw{RE_EXN_ID:wo,_1:v.contents.name,Error:new Error};case 15:var G=f._2,A=f._1,m=Qo(n,je.typeOfExpr(A),G);if(0===m.TAG){var p=m._0;if(0===p.TAG){var h=p._0;if(!h.mut)throw{RE_EXN_ID:yo,_1:G,Error:new Error};var g=nc(n,A);if(void 0!==g)throw{RE_EXN_ID:yo,_1:g,Error:new Error};return h.size>0?(ec(n,A),ec(n,s),zo(Vo(n),{TAG:17,_0:0,_1:h.offset})):void 0}throw{RE_EXN_ID:Io,_1:"cannot reassign "+G+" for type "+ce(je.typeOfExpr(A)),Error:new Error}}throw m._0;default:throw{RE_EXN_ID:Io,_1:"[unreachable]: assignement to an invalid lhs expression",Error:new Error}}case 5:var E=t._1,b=ke(void 0,"__lambda"+String(n.funcs.length)+"__");void 0!==E&&(E.contents.newName=b.contents.name);var y=rc(n,b,w(t._2,(function(n){return[n,!1]})),t._3);return zo(Vo(n),{TAG:0,_0:y});case 6:var S=t._2,I=t._1.contents;Qn.isZeroSizedType(je.typeOfExpr(S))||(ec(n,S),Ho(n,I.name,I.ty,!1)),e=t._3;continue;case 7:var k=t._2,x=t._1,D=function(e,t){return function(r){V(t,(function(e){return ec(n,e)}));var u=Mo(je.typeOfExpr(e)),a=hr.getOrAddSignature(n.mod,u);return ec(n,e),zo(Vo(n),{TAG:15,_0:a,_1:0})}}(x,k),N=function(e){return function(t){return V(H(e,t.params),(function(e){var t=e[1];if(t[2]&&Gn(nc(n,e[0])))throw{RE_EXN_ID:yo,_1:t[0],Error:new Error}}))}}(k);switch(0|x.TAG){case 3:var C=x._0;if(void 0!==Ko(n,C.contents.newName))return D(void 0);var R=Bo(n,C.contents.newName);if(void 0!==R)return N(R[0]),V(k,(function(e){return ec(n,e)})),zo(Vo(n),{TAG:14,_0:R[1]});throw{RE_EXN_ID:So,_1:C.contents.name,Error:new Error};case 15:var F=x._1,X=Qo(n,je.typeOfExpr(F),x._2);if(0!==X.TAG)throw X._0;var L=X._0;return 0!==L.TAG&&N(L._0[0]),ec(n,F),D(void 0);default:return D(void 0)}case 8:var U=t._2;return $o(n,1===t._3),V(t._1,(function(e){return tc(n,e)})),void 0!==U&&ec(n,U),Wo(n);case 9:var M=t._3,z=Uo(n.mod,t._0);return ec(n,t._1),zo(Vo(n),{TAG:4,_0:z}),ec(n,t._2),Rn(M,{TAG:0,_0:0})&&(zo(Vo(n),0),ec(n,M)),zo(Vo(n),1);case 10:return zo(Vo(n),{TAG:7,_0:0}),zo(Vo(n),{TAG:8,_0:0}),ec(n,t._0),zo(Vo(n),9),zo(Vo(n),{TAG:5,_0:1}),ec(n,t._1),zo(Vo(n),{TAG:6,_0:0}),zo(Vo(n),1),zo(Vo(n),1);case 11:var P=t._0;return void 0!==P&&ec(n,P),zo(Vo(n),2);case 12:var j=t._2,B=t._1;if(!sn(B,j))switch(0|B.TAG){case 1:switch(B._0){case"Ptr":var q=B._1;if(1!==q.length)throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error};var Z=q[0];switch(0|Z.TAG){case 1:if("u32"!==Z._0)throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error};if(0!==Z._1.length)throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error};switch(0|j.TAG){case 1:if("u32"!==j._0)throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error};if(0!==j._1.length)throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error};break;case 0:case 2:throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error}}break;case 0:case 2:throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error}}break;case"u32":if(0!==B._1.length)throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error};switch(0|j.TAG){case 1:if("Ptr"!==j._0)throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error};if(1!==j._1.length)throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error};break;case 0:case 2:throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error}}break;default:throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error}}break;case 0:case 2:throw{RE_EXN_ID:xo,_1:B,_2:j,Error:new Error}}e=t._0;continue;case 13:return V(t._0,(function(e){return ec(n,e)}));case 14:var $=t._1,W=ln(De(t._0)),K=W.size;qo(n,K),V(H(W.attributes,$),(function(e){var t=e[0];if(t.mut){var r=nc(n,e[1][1]);if(void 0!==r)throw{RE_EXN_ID:yo,_1:r,Error:new Error}}if(O(t.impl)&&Qn.size(t.ty)>0)return zo(Vo(n),{TAG:9,_0:n.stackTop.index})})),K>0&&zo(Vo(n),{TAG:9,_0:n.stackTop.index});return V($,function(e){return function(t){var r=t[1],u=function(t){ec(n,r),zo(Vo(n),{TAG:17,_0:0,_1:e.contents}),e.contents=e.contents+t|0},a=Ve.typeOf(r);switch(0|a.TAG){case 0:break;case 1:var o=0;switch(a._0){case"()":if(0===a._1.length)return;break;case"Fun":return u(4);case"Ptr":if(1===a._1.length)return u(4);break;case"bool":case"u32":o=2}if(2===o&&0===a._1.length)return u(4);break;case 2:return Oo(a._0),u(4)}throw{RE_EXN_ID:Io,_1:"cannot store "+ce(a)+" in the shadow stack",Error:new Error}}}({contents:0}));case 15:var Y=t._1,J=Qo(n,je.typeOfExpr(Y),t._2);if(0===J.TAG){var Q=J._0;if(0===Q.TAG){var nn=Q._0;return Qn.isZeroSizedType(nn.ty)?void 0:(ec(n,Y),zo(Vo(n),{TAG:16,_0:0,_1:nn.offset}))}var en=Q._0;if(en[2]){var tn=nc(n,Y);if(void 0!==tn)throw{RE_EXN_ID:yo,_1:tn,Error:new Error}}return zo(Vo(n),{TAG:0,_0:en[1]})}throw J._0}}}function tc(n,e){if(0===e.TAG){var t=e._2,r=e._0;return ec(n,t),Qn.isZeroSizedType(je.typeOfExpr(t))?void 0:Ho(n,r.contents.name,r.contents.ty,e._1)}var u=e._0;return ec(n,u),V(Lo(Ve.typeOf(u)),(function(e){return zo(Vo(n),3)}))}function rc(n,e,t,r){var u,a,o,c=w(t,(function(n){var e=n[0];return[e.contents.name,e.contents.ty,n[1]||!Kn(e.contents.ty)]})),i=(u=e.contents.newName,a=c,o=Ve.typeOf(r),{name:u,locals:[],params:en(a,(function(n){return!Qn.isZeroSizedType(n[1])})),ret:o,instructions:[]}),_=n.funcs.push(i)-1|0;return xn(n.funcStack,i),ec(n,r),zo(Vo(n),1),Dn(n.funcStack),_}function uc(n,e){switch(0|e.TAG){case 0:return void rc(n,e._0,e._1,e._2);case 1:var t,r=e._2;if(0!==r.TAG)throw{RE_EXN_ID:ko,_1:r,Error:new Error};var u=Yo(r._0);if(void 0===u)throw{RE_EXN_ID:ko,_1:r,Error:new Error};if("number"==typeof u)throw{RE_EXN_ID:ko,_1:r,Error:new Error};if(0!==u.TAG)throw{RE_EXN_ID:ko,_1:r,Error:new Error};return t={TAG:0,_0:u._0},void function(n,e,t,r,u){var a=Un(n.globals),o=jo(e,t,r,a,u);Z(n.globals,e,o)}(n,e._0.contents.name,e._1,0,t);case 2:return;case 3:return V(e._1,(function(e){return uc(n,{TAG:0,_0:e[0],_1:e[1],_2:e[2]})}))}}function ac(n){var e={mod:hr.make(void 0),funcs:[],scopeDepth:0,funcStack:In(),globals:j(1),stackTop:jo("__STACK_TOP__",!0,0,0,{TAG:0,_0:65535}),blockStack:In()};Z(e.globals,e.stackTop.name,e.stackTop);try{V(n,(function(n){return uc(e,n)})),hr.addMemory(e.mod,vr.make(qt.make(6,void 0))),V(Xn(Cn(e.globals),(function(n,e){return n.index-e.index|0})),(function(n){var t,r,u,a=(r=(t=n).init,u=t.isMutable,M(t.ty,(function(n){return ir.make(u,n,r)})));if(void 0!==a)return hr.addGlobal(e.mod,a)}));var t=nr.fromFuncRefs(0,_n(e.funcs,(function(n,e){return n})));return hr.addElement(e.mod,t),hr.addTable(e.mod,Wt.make(0,qt.makeExact(e.funcs.length))),V(e.funcs,(function(n){var t=Po(n);hr.addExportedFunc(e.mod,n.name,t[1],t[2])})),{TAG:0,_0:e.mod}}catch(r){return{TAG:1,_0:Xo(On(r))}}}var oc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",compile:function(n){return pn(ao(n),(function(n){var e=w(n,Be.from);return pn(function(n){return bn(Go),h(w(n,lo),{TAG:0,_0:[qn.empty,void 0]},(function(n,e){return pn(n,(function(n){var t=n[1];return yn(ho(n[0],e),(function(n){return[n[0],me(n[1],t)]}))}))}))}(e),(function(n){var t,r=n[1];t=r,V(B(be.renaming),(function(n){return xe(t,n)}));var u=w(e,(function(n){return Be.subst(r,n)}));return yn(ac(u),(function(n){return[n,hr.encodeAsUint8Array(n)]}))}))}))}});const cc={0:"I32",1:"I64",2:"F32",3:"F64"},ic={0:"Else",1:"End",2:"Return",3:"Drop",4:"AddI32",5:"SubI32",6:"MulI32",7:"DivI32Unsigned",8:"DivI32Signed",9:"EqzI32",10:"EqI32",11:"EqI64",12:"EqF32",13:"EqF64",14:"NeI32",15:"NeI64",16:"NeF32",17:"NeF64",18:"LeI32Signed",19:"LeI32Unsigned",20:"LeI64Signed",21:"LeI64Unsigned",22:"LeF32",23:"LeF64",24:"GeI32Signed",25:"GeI32Unsigned",26:"GeI64Signed",27:"GeI64Unsigned",28:"GeF32",29:"GeF64",30:"LtI32Signed",31:"LtI32Unsigned",32:"LtI64Signed",33:"LtI64Unsigned",34:"LtF32",35:"LtF64",36:"GtI32Signed",37:"GtI32Unsigned",38:"GtI64Signed",39:"GtI64Unsigned",40:"GtF32",41:"GtF64",42:"RemI32Signed",43:"RemI32Unsigned",44:"And"},_c={0:"FuncRef",1:"ExternRef"},sc={0:"Func",1:"Table",2:"Memory",3:"Global"},fc={0:"Void"},lc=oc,vc=function(n){const e=lc.compile(n);return 0===e.TAG?{tag:"Ok",value:[{typeSection:e._0[0].typeSection.map((function(n){return[n._0.map((function(n){return cc[n]})),n._1.map((function(n){return cc[n]}))]})),funcSection:e._0[0].funcSection,tableSection:e._0[0].tableSection.map((function(n){return[_c[n[0]],n[1]]})),memorySection:e._0[0].memorySection,globalSection:e._0[0].globalSection.map((function(n){return[cc[n[0]],n[1],0===n[2].TAG?{tag:"InitConstI32",value:n[2]._0}:{tag:"InitGetGlobal",value:n[2]._0}]})),exportSection:e._0[0].exportSection.map((function(n){return{name:n.name,kind:sc[n.kind],index:n.index}})),elementSection:e._0[0].elementSection,codeSection:e._0[0].codeSection.map((function(n){return[n[0].map((function(n){return[n[0],cc[n[1]]]})),n[1].map((function(n){return"object"==typeof n?0===n.TAG?{tag:"ConstI32",value:n._0}:1===n.TAG?{tag:"ConstI64",value:n._0}:2===n.TAG?{tag:"ConstF32",value:n._0}:3===n.TAG?{tag:"ConstF64",value:n._0}:4===n.TAG?{tag:"If",value:"object"==typeof n._0?0===n._0.TAG?{tag:"TypeValue",value:cc[n._0._0]}:{tag:"TypeIndex",value:[n._0._0,[n._0._1[0].map((function(n){return cc[n]})),n._0._1[1].map((function(n){return cc[n]}))]]}:fc[n._0]}:5===n.TAG?{tag:"BranchIf",value:n._0}:6===n.TAG?{tag:"Branch",value:n._0}:7===n.TAG?{tag:"Block",value:"object"==typeof n._0?0===n._0.TAG?{tag:"TypeValue",value:cc[n._0._0]}:{tag:"TypeIndex",value:[n._0._0,[n._0._1[0].map((function(n){return cc[n]})),n._0._1[1].map((function(n){return cc[n]}))]]}:fc[n._0]}:8===n.TAG?{tag:"Loop",value:"object"==typeof n._0?0===n._0.TAG?{tag:"TypeValue",value:cc[n._0._0]}:{tag:"TypeIndex",value:[n._0._0,[n._0._1[0].map((function(n){return cc[n]})),n._0._1[1].map((function(n){return cc[n]}))]]}:fc[n._0]}:9===n.TAG?{tag:"GetGlobal",value:n._0}:10===n.TAG?{tag:"SetGlobal",value:n._0}:11===n.TAG?{tag:"GetLocal",value:n._0}:12===n.TAG?{tag:"SetLocal",value:n._0}:13===n.TAG?{tag:"TeeLocal",value:n._0}:14===n.TAG?{tag:"Call",value:n._0}:15===n.TAG?{tag:"CallIndirect",value:[n._0,n._1]}:16===n.TAG?{tag:"LoadI32",value:[n._0,n._1]}:{tag:"StoreI32",value:[n._0,n._1]}:ic[n]}))]})),funcs:e._0[0].funcs.map((function(n){return[n[0],[n[1]._0.map((function(n){return cc[n]})),n[1]._1.map((function(n){return cc[n]}))],[n[2][0].map((function(n){return[n[0],cc[n[1]]]})),n[2][1].map((function(n){return"object"==typeof n?0===n.TAG?{tag:"ConstI32",value:n._0}:1===n.TAG?{tag:"ConstI64",value:n._0}:2===n.TAG?{tag:"ConstF32",value:n._0}:3===n.TAG?{tag:"ConstF64",value:n._0}:4===n.TAG?{tag:"If",value:"object"==typeof n._0?0===n._0.TAG?{tag:"TypeValue",value:cc[n._0._0]}:{tag:"TypeIndex",value:[n._0._0,[n._0._1[0].map((function(n){return cc[n]})),n._0._1[1].map((function(n){return cc[n]}))]]}:fc[n._0]}:5===n.TAG?{tag:"BranchIf",value:n._0}:6===n.TAG?{tag:"Branch",value:n._0}:7===n.TAG?{tag:"Block",value:"object"==typeof n._0?0===n._0.TAG?{tag:"TypeValue",value:cc[n._0._0]}:{tag:"TypeIndex",value:[n._0._0,[n._0._1[0].map((function(n){return cc[n]})),n._0._1[1].map((function(n){return cc[n]}))]]}:fc[n._0]}:8===n.TAG?{tag:"Loop",value:"object"==typeof n._0?0===n._0.TAG?{tag:"TypeValue",value:cc[n._0._0]}:{tag:"TypeIndex",value:[n._0._0,[n._0._1[0].map((function(n){return cc[n]})),n._0._1[1].map((function(n){return cc[n]}))]]}:fc[n._0]}:9===n.TAG?{tag:"GetGlobal",value:n._0}:10===n.TAG?{tag:"SetGlobal",value:n._0}:11===n.TAG?{tag:"GetLocal",value:n._0}:12===n.TAG?{tag:"SetLocal",value:n._0}:13===n.TAG?{tag:"TeeLocal",value:n._0}:14===n.TAG?{tag:"Call",value:n._0}:15===n.TAG?{tag:"CallIndirect",value:[n._0,n._1]}:16===n.TAG?{tag:"LoadI32",value:[n._0,n._1]}:{tag:"StoreI32",value:[n._0,n._1]}:ic[n]}))]]})),importsCount:e._0[0].importsCount},e._0[1]]}:{tag:"Error",value:e._0}},Tc={0:"I32",1:"I64",2:"F32",3:"F64"},dc={I32:0,I64:1,F32:2,F64:3},Gc={Else:0,End:1,Return:2,Drop:3,AddI32:4,SubI32:5,MulI32:6,DivI32Unsigned:7,DivI32Signed:8,EqzI32:9,EqI32:10,EqI64:11,EqF32:12,EqF64:13,NeI32:14,NeI64:15,NeF32:16,NeF64:17,LeI32Signed:18,LeI32Unsigned:19,LeI64Signed:20,LeI64Unsigned:21,LeF32:22,LeF64:23,GeI32Signed:24,GeI32Unsigned:25,GeI64Signed:26,GeI64Unsigned:27,GeF32:28,GeF64:29,LtI32Signed:30,LtI32Unsigned:31,LtI64Signed:32,LtI64Unsigned:33,LtF32:34,LtF64:35,GtI32Signed:36,GtI32Unsigned:37,GtI64Signed:38,GtI64Unsigned:39,GtF32:40,GtF64:41,RemI32Signed:42,RemI32Unsigned:43,And:44},Ac={FuncRef:0,ExternRef:1},mc={Func:0,Table:1,Memory:2,Global:3},pc={Void:0},hc=gr;hc.uleb128,hc.sleb128,hc.Vec.encode,hc.Vec.encodeMany,hc.F32.encode,hc.F64.encode,hc.Func.Signature.funcTypeCode,hc.Func.Signature.empty._0.map((function(n){return Tc[n]})),hc.Func.Signature.empty._1.map((function(n){return Tc[n]})),hc.FuncSection.make,hc.FuncSection.encode,hc.Str.encode,hc.Limits.makeExact,hc.Elem.show,hc.Elem.encode,hc.ElementSection.make,hc.ElementSection.show,hc.ElementSection.encode,hc.MemorySection.make;hc.F32,hc.F64,hc.Vec,hc.Str;const gc=({theme:n,code:e,onChange:t})=>Mn.createElement(zn,{mode:"rust",width:"100vw",height:"calc(100vh - 39px)",value:e,theme:n,enableLiveAutocompletion:!0,onChange:t,fontSize:16,editorProps:{$blockScrolling:!0},setOptions:{tabSize:2}}),Ec=({theme:n,text:e})=>Mn.createElement(zn,{mode:"text",width:"100vw",height:"calc(100vh - 39px)",value:e,theme:n,enableLiveAutocompletion:!0,onChange:()=>null,fontSize:16,editorProps:{$blockScrolling:!0},setOptions:{showLineNumbers:!0,tabSize:2}}),wc={dark:{backgroundColor:"#1c1c1c",color:"white",borderColor:"#3b3b3b"},light:{backgroundColor:"white",color:"black",borderColor:"black"}},bc=n=>((n,r)=>e(n,t(r)))(((n,e)=>{for(var t in e||(e={}))u.call(e,t)&&o(n,t,e[t]);if(r)for(var t of r(e))a.call(e,t)&&o(n,t,e[t]);return n})({},n?wc.dark:wc.light),{borderWidth:"2px",borderStyle:"solid",fontSize:"20px",margin:"4px",borderRadius:"4px"}),yc=({children:n,onClick:e,isDark:t})=>Mn.createElement("button",{onClick:e,style:bc(t)},n);const Sc={"Prime sieve":"\nlet SIZEOF_U32 = 4;\n\nstruct Array {\n  start: Ptr<u32>,\n  mut length: u32,\n  capacity: u32,\n}\n\nimpl Array {\n  fn read(self, n) unsafe {\n    *(((self.start as u32) + n * SIZEOF_U32) as Ptr<u32>)\n  }\n\n  fn write(self, n, val) unsafe {\n    *(((self.start as u32) + n * SIZEOF_U32) as Ptr<u32>) = val;\n  }\n\n  fn push(mut self, val) {\n    self.write(self.length, val);\n    self.length = self.length + 1;\n  }\n}\n\nstruct Sieve {\n  mut primes: Array,\n  mut current: u32\n}\n\nimpl Sieve {\n  fn clear(mut self) {\n    self.primes.length = 0;\n    // 2 is the first prime\n    self.primes.push(2);\n    self.current = 1;\n  }\n\n  fn isPrime(mut self, n) {\n    mut i = 0;\n    mut p = self.primes.read(i);\n\n    while p * p <= n {\n      if n % p == 0 { return false; }\n      i = i + 1;\n      p = self.primes.read(i);\n    }\n\n    // n is prime\n    // add it to the sieve\n    self.primes.push(n);\n\n    true\n  }\n\n  fn nextPrime(mut self) {\n    self.current = self.current + 2;\n\n    while !self.isPrime(self.current) {\n      self.current = self.current + 2;\n    }\n\n    self.current\n  }\n\n  // count the prime numbers <= m\n  fn countUpTo(mut self, m) {\n    self.clear();\n\n    while self.current <= m {\n      self.nextPrime();\n    }\n\n    self.primes.length - 1\n  }\n}\n\nfn main() {\n  mut sieve = Sieve {\n    primes: Array {\n      // right after the shadow stack\n      start: 65536 as Ptr<u32>,\n      length: 0,\n      capacity: 100000\n    },\n    current: 0\n  };\n\n  sieve.countUpTo(1000000)\n}",Factorial:"\nfn fact(n) {\n  let aux = (n, acc) -> if n == 0 { acc } else { aux(n - 1, n * acc) } in\n  aux(n, 1)\n}\n\nfn main() {\n  fact(11)\n}",Fibonacci:"\nfn fib(n) {\n  let fib_aux = (n, a, b) -> {\n    if n == 0 { return a; }\n    if n == 1 { return b; }\n    fib_aux(n - 1, b, a + b)\n  };\n\n  fib_aux(n, 0, 1)\n}\n\nfn main() {\n  fib(83)\n}",Pointers:"\nlet SIZEOF_U32 = 4;\n\nfn read_u32(addr) unsafe {\n  *((addr * SIZEOF_U32) as Ptr<u32>)\n}\n\nfn write_u32(addr, val) unsafe {\n  *((addr * SIZEOF_U32) as Ptr<u32>) = val;\n}\n\nfn main() {\n  let square = n -> n * n;\n\n  mut i = 0;\n  while i < 100 {\n    write_u32(i, square(i));\n    i = i + 1;\n  }\n\n  read_u32(42) // 1764\n}",Primes:"\nfn isEven(n) {\n  n % 2 == 0\n}\n\nfn isPrime(n) {\n  if n < 2 { return false; }\n  if n == 2 { return true; }\n  if isEven(n) { return false; }\n\n  mut i = 3;\n\n  while i * i <= n {\n    if n % i == 0 { return false; }\n    i = i + 2;\n  }\n\n  true\n}\n\nfn countPrimesLessThan(m) {\n  mut i = m;\n  mut count = 0;\n\n  while i > 1 {\n    if isPrime(i) {\n      count = count + 1;\n    }\n\n    i = i - 1;\n  }\n\n  count\n}\n\nfn main() {\n  countPrimesLessThan(1000000)\n}",Structs:"\nstruct MinMax {\n  mut min: u32,\n  mut max: u32\n}\n\nimpl MinMax {\n  fn reset(mut self) {\n    self.min = 0;\n    self.max = 0;\n  }\n}\n\nfn main() {\n  mut m = MinMax {\n    min: 1789,\n    max: 1998\n  };\n\n  m.reset();\n  \n  m.min + m.max == 0\n}","Lambda (kind of)":"\nfn main() {\n  let twice = (f, x) -> f(f(x));\n  \n  twice(n -> n * n, 7)\n}"},Ic=({onSelect:n,isDark:e,defaultSample:t})=>{const[r,u]=Pn.exports.useState(t);return Pn.exports.useEffect((()=>{n(Sc[r])}),[]),Mn.createElement("select",{value:r,style:bc(e),onChange:e=>{const t=e.target.value;u(t),n(Sc[t])}},Object.entries(Sc).map((([n,e])=>Mn.createElement("option",{key:n},n))))},kc=({onRun:n,onDisassemble:e,isDark:t,toggleDarkMode:r,onSelectSample:u})=>Mn.createElement("div",{style:{display:"flex",flexDirection:"row",backgroundColor:t?"black":"white",borderBottom:"2px solid silver"}},Mn.createElement(yc,{isDark:t,onClick:n},"Run"),Mn.createElement(yc,{isDark:t,onClick:e},"Disassemble"),Mn.createElement(Ic,{isDark:t,onSelect:u,defaultSample:"Prime sieve"}),Mn.createElement(yc,{isDark:t,onClick:r},(t?"Light":"Dark")+" Mode")),xc=({children:n})=>Mn.createElement("div",{style:{background:"silver",cursor:"col-resize",width:"100%",height:"100%",outline:"none",overflow:"hidden"}},n);function Dc(){const[n,e]=Pn.exports.useState(""),[t,r]=Pn.exports.useState(""),[u,a]=Pn.exports.useState((new Date).getHours()>=20||(new Date).getHours()<=9),o=u?"terminal":"github",c=Pn.exports.useCallback((async()=>{try{const e=vc(n);if("Ok"===e.tag){r("running...");const n=await(async n=>{const e=await WebAssembly.compile(n),t=await WebAssembly.instantiate(e);if("main"in t.exports)return t.exports.main();throw new Error("main function not found, exported functions are: "+Object.keys(t.exports).join(", "))})(e.value[1]);r(String(n))}else r(e.value)}catch(e){r(`${e}`)}}),[n,r]),i=Pn.exports.useCallback((()=>{try{const t=vc(n);if("Ok"===t.tag){const[n]=t.value;r((e=n,hc.Module.show({typeSection:e.typeSection.map((function(n){return{TAG:0,_0:n[0].map((function(n){return dc[n]})),_1:n[1].map((function(n){return dc[n]}))}})),funcSection:e.funcSection,tableSection:e.tableSection.map((function(n){return[Ac[n[0]],[n[1][0],null==n[1][1]?void 0:n[1][1]]]})),memorySection:e.memorySection.map((function(n){return[n[0],null==n[1]?void 0:n[1]]})),globalSection:e.globalSection.map((function(n){return[dc[n[0]],n[1],"InitConstI32"===n[2].tag?{TAG:0,_0:n[2].value}:{TAG:1,_0:n[2].value}]})),exportSection:e.exportSection.map((function(n){return{name:n.name,kind:mc[n.kind],index:n.index}})),elementSection:e.elementSection,codeSection:e.codeSection.map((function(n){return[n[0].map((function(n){return[n[0],dc[n[1]]]})),n[1].map((function(n){return"object"==typeof n?"ConstI32"===n.tag?{TAG:0,_0:n.value}:"ConstI64"===n.tag?{TAG:1,_0:n.value}:"ConstF32"===n.tag?{TAG:2,_0:n.value}:"ConstF64"===n.tag?{TAG:3,_0:n.value}:"If"===n.tag?{TAG:4,_0:"object"==typeof n.value?"TypeValue"===n.value.tag?{TAG:0,_0:dc[n.value.value]}:{TAG:1,_0:n.value.value[0],_1:[n.value.value[1][0].map((function(n){return dc[n]})),n.value.value[1][1].map((function(n){return dc[n]}))]}:pc[n.value]}:"BranchIf"===n.tag?{TAG:5,_0:n.value}:"Branch"===n.tag?{TAG:6,_0:n.value}:"Block"===n.tag?{TAG:7,_0:"object"==typeof n.value?"TypeValue"===n.value.tag?{TAG:0,_0:dc[n.value.value]}:{TAG:1,_0:n.value.value[0],_1:[n.value.value[1][0].map((function(n){return dc[n]})),n.value.value[1][1].map((function(n){return dc[n]}))]}:pc[n.value]}:"Loop"===n.tag?{TAG:8,_0:"object"==typeof n.value?"TypeValue"===n.value.tag?{TAG:0,_0:dc[n.value.value]}:{TAG:1,_0:n.value.value[0],_1:[n.value.value[1][0].map((function(n){return dc[n]})),n.value.value[1][1].map((function(n){return dc[n]}))]}:pc[n.value]}:"GetGlobal"===n.tag?{TAG:9,_0:n.value}:"SetGlobal"===n.tag?{TAG:10,_0:n.value}:"GetLocal"===n.tag?{TAG:11,_0:n.value}:"SetLocal"===n.tag?{TAG:12,_0:n.value}:"TeeLocal"===n.tag?{TAG:13,_0:n.value}:"Call"===n.tag?{TAG:14,_0:n.value}:"CallIndirect"===n.tag?{TAG:15,_0:n.value[0],_1:n.value[1]}:"LoadI32"===n.tag?{TAG:16,_0:n.value[0],_1:n.value[1]}:{TAG:17,_0:n.value[0],_1:n.value[1]}:Gc[n]}))]})),funcs:e.funcs.map((function(n){return[n[0],{TAG:0,_0:n[1][0].map((function(n){return dc[n]})),_1:n[1][1].map((function(n){return dc[n]}))},[n[2][0].map((function(n){return[n[0],dc[n[1]]]})),n[2][1].map((function(n){return"object"==typeof n?"ConstI32"===n.tag?{TAG:0,_0:n.value}:"ConstI64"===n.tag?{TAG:1,_0:n.value}:"ConstF32"===n.tag?{TAG:2,_0:n.value}:"ConstF64"===n.tag?{TAG:3,_0:n.value}:"If"===n.tag?{TAG:4,_0:"object"==typeof n.value?"TypeValue"===n.value.tag?{TAG:0,_0:dc[n.value.value]}:{TAG:1,_0:n.value.value[0],_1:[n.value.value[1][0].map((function(n){return dc[n]})),n.value.value[1][1].map((function(n){return dc[n]}))]}:pc[n.value]}:"BranchIf"===n.tag?{TAG:5,_0:n.value}:"Branch"===n.tag?{TAG:6,_0:n.value}:"Block"===n.tag?{TAG:7,_0:"object"==typeof n.value?"TypeValue"===n.value.tag?{TAG:0,_0:dc[n.value.value]}:{TAG:1,_0:n.value.value[0],_1:[n.value.value[1][0].map((function(n){return dc[n]})),n.value.value[1][1].map((function(n){return dc[n]}))]}:pc[n.value]}:"Loop"===n.tag?{TAG:8,_0:"object"==typeof n.value?"TypeValue"===n.value.tag?{TAG:0,_0:dc[n.value.value]}:{TAG:1,_0:n.value.value[0],_1:[n.value.value[1][0].map((function(n){return dc[n]})),n.value.value[1][1].map((function(n){return dc[n]}))]}:pc[n.value]}:"GetGlobal"===n.tag?{TAG:9,_0:n.value}:"SetGlobal"===n.tag?{TAG:10,_0:n.value}:"GetLocal"===n.tag?{TAG:11,_0:n.value}:"SetLocal"===n.tag?{TAG:12,_0:n.value}:"TeeLocal"===n.tag?{TAG:13,_0:n.value}:"Call"===n.tag?{TAG:14,_0:n.value}:"CallIndirect"===n.tag?{TAG:15,_0:n.value[0],_1:n.value[1]}:"LoadI32"===n.tag?{TAG:16,_0:n.value[0],_1:n.value[1]}:{TAG:17,_0:n.value[0],_1:n.value[1]}:Gc[n]}))]]})),importsCount:e.importsCount})))}else r(t.value)}catch(t){r(`${t}`)}var e}),[n,r]);return Mn.createElement("div",{style:{display:"flex",flexDirection:"column"}},Mn.createElement(kc,{onRun:c,onDisassemble:i,toggleDarkMode:()=>a(!u),isDark:u,onSelectSample:n=>e(n)}),Mn.createElement(jn.exports.Split,{splitterSize:"10px",renderSplitter:()=>Mn.createElement(xc,null)},Mn.createElement(gc,{theme:o,code:n,onChange:e}),Mn.createElement(Ec,{theme:o,text:t})))}Vn.render(Mn.createElement(Mn.StrictMode,null,Mn.createElement(Dc,null)),document.getElementById("root"));
