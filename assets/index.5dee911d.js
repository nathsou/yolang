import{c as un,a as cn,j as m,r as po,m as Tn,g as Ve,b as rr,d as s,z as Be,k as Xt,e as Yr,f as ht,t as et,h as bo,i as Hr,l as Un,n as Qr,o as ge,_ as d,p as he,s as N,v as On,q as J,u as Ir,w as ko,x as Do,y as ur,A as yr,B as xr,C as hn,D as ar,E as En,F as No,G as Fo,H as nu,I as or,J as Ro,K as $o,L as Lo,M as Xo,N as Co,O as Mo,P as Uo,Q as eu,R as Fn,S as Oo,T as tu,U as zo,V as ir,W as ru,X as Vo,Y as xn,Z as Bo,$ as Po,a0 as le,a1 as uu,a2 as Ct,a3 as au,a4 as Mt,a5 as ou,a6 as iu,a7 as qo,a8 as Ut,a9 as jo,aa as Zo,ab as Wo,ac as F,ad as Jo,ae as Ko,af as cu,ag as Yo,ah as cr,ai as Ho,aj as _u,ak as Qo,al as Io,am as Q,an as yo,ao as Et,ap as Ot,aq as pe,ar as be,as as fu,at as xo,au as At,av as su,aw as ni,ax as ei,ay as ti,az as zt,aA as ri,aB as ui}from"./vendor.3fa12d20.js";const ai=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&u(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerpolicy&&(t.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?t.credentials="include":a.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(a){if(a.ep)return;a.ep=!0;const t=r(a);fetch(a.href,t)}};ai();function _n(n){var e=[],r=function(u){for(;;){var a=u,t=a&127,o=a>>>7;if(o!==0){e.push(t|128),u=o;continue}e.push(t);return}};return r(n),e}function Vt(n){var e=[],r=function(u){for(;;){var a=u,t=a&127,o=a>>7;if(o===0&&(t&64)==0||o===-1&&(t&64)!=0){e.push(t);return}e.push(t|128),u=o}};return r(n|0),e}function ke(n){return un(_n(n.length),n)}function Bn(n){return un(_n(n.length),cn(n))}var oi={encode:ke,encodeMany:Bn},ii=Vt,ci={encode:ii},_i=Vt,fi={encode:_i};function lu(n){var e=new DataView(new ArrayBuffer(4));return e.setFloat32(0,n,1),[e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3)]}var si={encode:lu};function vu(n){var e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,1),[e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3),e.getUint8(4),e.getUint8(5),e.getUint8(6),e.getUint8(7)]}var li={encode:vu};function vi(n){return n}function ne(n,e){return un([n],ke(e))}function ee(n){var e;switch(n){case 0:e="custom";break;case 1:e="type";break;case 2:e="import";break;case 3:e="function";break;case 4:e="table";break;case 5:e="memory";break;case 6:e="global";break;case 7:e="export";break;case 8:e="start";break;case 9:e="element";break;case 10:e="code";break;case 11:e="data";break}return"["+e+"]"}var di={id:vi,encode:ne,show:ee};function tt(n){switch(n){case 0:return 127;case 1:return 126;case 2:return 125;case 3:return 124}}function rt(n){switch(n){case 0:return"i32";case 1:return"i64";case 2:return"f32";case 3:return"f64"}}var Ti={encode:tt,show:rt};function du(n){return typeof n=="number"?[64]:n.TAG===0?[tt(n._0)]:_n(n._0)}function Gi(n){return typeof n=="number"?"void":n.TAG===0?rt(n._0):"type "+String(n._0)}var gi={encode:du,show:Gi};function _r(n){if(typeof n=="number")switch(n){case 0:return[[5],"else"];case 1:return[[11],"end"];case 2:return[[15],"return"];case 3:return[[26],"drop"];case 4:return[[106],"i32.add"];case 5:return[[107],"i32.sub"];case 6:return[[108],"i32.mul"];case 7:return[[110],"i32.div_s"];case 8:return[[109],"i32.div_u"];case 9:return[[69],"i32.eqz"];case 10:return[[70],"i32.eq"];case 11:return[[81],"i64.eq"];case 12:return[[91],"f32.eq"];case 13:return[[97],"f64.eq"];case 14:return[[71],"i32.ne"];case 15:return[[82],"i64.ne"];case 16:return[[92],"f32.ne"];case 17:return[[98],"f64.ne"];case 18:return[[76],"i32.le_s"];case 19:return[[77],"i32.le_u"];case 20:return[[87],"i64.le_s"];case 21:return[[88],"i64.le_u"];case 22:return[[95],"f32.le"];case 23:return[[101],"f64.le"];case 24:return[[78],"i32.ge_s"];case 25:return[[79],"i32.ge_u"];case 26:return[[89],"i64.ge_s"];case 27:return[[90],"i64.ge_u"];case 28:return[[96],"f32.ge"];case 29:return[[102],"f64.ge"];case 30:return[[72],"i32.lt_s"];case 31:return[[73],"i32.lt_u"];case 32:return[[83],"i64.lt_s"];case 33:return[[84],"i64.lt_u"];case 34:return[[93],"f32.lt"];case 35:return[[99],"f64.lt"];case 36:return[[74],"i32.gt_s"];case 37:return[[75],"i32.gt_u"];case 38:return[[85],"i64.gt_s"];case 39:return[[86],"i64.gt_u"];case 40:return[[94],"f32.gt"];case 41:return[[100],"f64.gt"];case 42:return[[111],"i32.rem_s"];case 43:return[[112],"i32.rem_u"];case 44:return[[113],"i32.and"];case 45:return[[114],"i32.or"];case 46:return[[116],"i32.shl"];case 47:return[[117],"i32.shr_s"];case 48:return[[118],"i32.shr_u"]}else switch(n.TAG|0){case 0:return[[65],"i32.const "+String(n._0)];case 1:return[[66],"i64.const "+String(n._0)];case 2:return[[67],"i64.const "+String(n._0)];case 3:return[[68],"i64.const "+String(n._0)];case 4:return[[4],"if"];case 5:return[[13],"br_if "+String(n._0)];case 6:return[[12],"br "+String(n._0)];case 7:return[[2],"block"];case 8:return[[3],"loop"];case 9:return[[35],"global.get "+String(n._0)];case 10:return[[36],"global.set "+String(n._0)];case 11:return[[32],"local.get "+String(n._0)];case 12:return[[33],"local.set "+String(n._0)];case 13:return[[34],"local.tee "+String(n._0)];case 14:return[[16],"call "+String(n._0)];case 15:return[[17],"call_indirect [typeIndex="+String(n._0)+", tableIndex="+String(n._1)+"]"];case 16:return[[40],"i32.load (alignment="+String(n._0)+", offset="+String(n._1)+")"];case 17:return[[54],"i32.store (alignment="+String(n._0)+", offset="+String(n._1)+")"];case 18:return[[252,8],"memory.init "+String(n._0)];case 19:return[[252,9],"data.drop "+String(n._0)]}}function te(n){return _r(n)[0]}function Tu(n){if(typeof n=="number")switch(n){case 0:case 1:return-1;default:return 0}else switch(n.TAG|0){case 4:case 7:case 8:return 1;default:return 0}}function Bt(n,e,r,u){var a=n!==void 0?n:{contents:0},t=_r(e),o=Tu(e),i=m(po(0,a.contents+(o<0?o:0)|0),"  ",function(v){return""});a.contents=a.contents+o|0,e===0&&(a.contents=a.contents+1|0);var c,_=0;if(typeof e=="number")c="";else switch(e.TAG|0){case 11:case 12:case 13:_=1;break;case 14:c="<"+Tn(Ve(r,e._0),"??",function(v){return v})+">";break;default:c=""}return _===1&&(c="<"+Tn(Ve(u,e._0),"??",function(v){return v})+">"),i+t[1]+" "+c}function ve(n){var e=0;if(typeof n=="number")return te(n);switch(n.TAG|0){case 0:case 1:return un(te(n),Vt(n._0));case 2:return un(te(n),lu(n._0));case 3:return un(te(n),vu(n._0));case 4:case 7:case 8:e=1;break;case 9:case 10:case 11:case 12:case 13:e=2;break;case 15:return cn([te(n),_n(n._0),_n(n._1)]);case 16:case 17:e=3;break;case 18:return cn([te(n),_n(n._0),[0]]);case 5:case 6:case 14:case 19:return un(te(n),_n(n._0))}switch(e){case 1:return un(te(n),du(n._0));case 2:return un(te(n),_n(n._0));case 3:return cn([te(n),_n(n._0),_n(n._1)])}}var hi={info:_r,opcode:te,identationDelta:Tu,show:Bt,encode:ve};function Ei(n,e){return{_0:n,_1:e}}var Ai=[],wi=[],mi={_0:Ai,_1:wi};function Gu(n){return cn([[96],ke(s(n._0,tt)),ke(s(n._1,tt))])}function gu(n){var e=n._1,r=n._0,u=m(r,", ",rt),a=m(e,", ",rt);if(r.length===1){var t=e.length;if(t===1)return u+" -> "+a;if(t===0)return u+" -> ()"}var o=e.length;return o!==1?o!==0?"("+u+") -> ("+a+")":"("+u+") -> ()":"("+u+") -> "+a}var Si={funcTypeCode:96,make:Ei,empty:mi,encode:Gu,show:gu};function pi(n){var e=function(u,a){for(;;){var t=a,o=u;if(!o)return t;var i=o.tl,c=o.hd,_=c[1],v=c[0];if(t){var T=t.tl,p=t.hd,W=p[1],R=p[0];if(Un(_,W)){a={hd:[{hd:v,tl:R},W],tl:T},u=i;continue}a={hd:[{hd:v,tl:0},_],tl:{hd:[R,W],tl:T}},u=i;continue}a={hd:[{hd:v,tl:0},_],tl:0},u=i}},r=Yr(e(ht(n),0));return et(bo(r,function(u){return[Qr(et(u[0])),u[1]]}))}function hu(n){return un(_n(n[0].length),[tt(n[1])])}function Eu(n){return"local ["+m(n[0],", ",function(e){return e})+"] "+rt(n[1])}var bi={fromTypes:pi,encode:hu,show:Eu};function ki(n,e){return[n,e]}function Au(n){var e=Bn(s(n[0],hu)),r=cn(s(n[1],ve));return cn([[e.length+r.length|0],e,r])}function wu(n,e,r){var u=n[0],a={contents:1},t=Hr(r._0,function(_,v){return"param["+String(_)+"]"}),o=un(t,cn(s(u,function(_){return _[0]}))),i=m(u,`
`,Eu),c=m(n[1],`
`,function(_){return Bt(a,_,e,o)});return u.length===0?c:i+`
`+c}var Di={make:ki,encode:Au,show:wu};function Ni(n,e,r){return[n,e,r]}var wt={Signature:Si,Local:bi,Body:Di,make:Ni};function Fi(n){return[]}function fr(n,e){var r=rr(n,function(u){return Un(u,e)});return r!==void 0?r:(n.push(e),n.length-1|0)}function mu(n){return ne(1,Bn(s(n,Gu)))}function Su(n){return ee(1)+`
`+m(n,`
`,gu)}var Ri={make:Fi,getOrAdd:fr,encode:mu,show:Su};function $i(n){return[]}function pu(n,e){return n.push(e),n.length-1|0}function bu(n){return ne(3,Bn(s(n,_n)))}function ku(n,e){return ee(3)+`
`+m(Be(n,e),`
`,function(r){return r[1]+": "+String(r[0])})}var Li={make:$i,addSignature:pu,encode:bu,show:ku};function Pt(n){return ke(s(n.split(""),function(e){return e.charCodeAt(0)|0}))}var Xi={encode:Pt};function Ci(n){return[n]}function Du(n){switch(n){case 0:return"func";case 1:return"table";case 2:return"memory";case 3:return"global"}}var Mi={encode:Ci,show:Du};function Ui(n,e,r){return{name:n,kind:e,index:r}}function Nu(n){return cn([Pt(n.name),[n.kind],_n(n.index)])}function Fu(n){return"export "+Du(n.kind)+" "+n.name+" (index: "+String(n.index)+")"}var Ru={ExternalKind:Mi,make:Ui,encode:Nu,show:Fu};function Oi(n){return[]}function zi(n,e){n.push(e)}function $u(n){return ne(7,Bn(s(n,Nu)))}function Lu(n){return ee(7)+`
`+m(n,`
`,Fu)}var Vi={make:Oi,add:zi,encode:$u,show:Lu};function Bi(n){return n?"externref":"funcref"}function Pi(n){return n?111:112}var qi={show:Bi,encode:Pi};function sr(n){return"{ min: "+String(n[0])+", max: "+Tn(n[1],"?",function(e){return String(e)})+" }"}function ji(n,e){return[n,e]}function Zi(n){return[n,n]}function qt(n){var e=n[1],r=n[0];return e!==void 0?cn([[1],_n(r),_n(e)]):un([0],_n(r))}var lr={show:sr,make:ji,makeExact:Zi,encode:qt};function Wi(n,e){return[n,e]}function Xu(n){return un([n[0]?111:112],qt(n[1]))}function Cu(n){return"table "+(n[0]?"externref":"funcref")+" "+sr(n[1])}var Mu={make:Wi,encode:Xu,show:Cu};function Ji(n){return[]}function Ki(n,e){n.push(e)}function Uu(n){return ee(4)+`
`+m(n,`
`,Cu)}function Ou(n){return ne(4,Bn(s(n,Xu)))}var Yi={make:Ji,add:Ki,show:Uu,encode:Ou};function Hi(n,e){var r=n!==void 0?n:0;return{offset:r,funcIndices:e}}function zu(n){return"elem funcref ("+m(n.funcIndices," ",function(e){return String(e)})+") (offset="+String(n.offset)+")"}function Vu(n){return cn([[0],ve({TAG:0,_0:n.offset}),ve(1),Bn(s(n.funcIndices,_n))])}var Bu={fromFuncRefs:Hi,show:zu,encode:Vu};function Qi(n){return[]}function Ii(n,e){n.push(e)}function Pu(n){return ee(9)+`
`+m(n,`
`,zu)}function qu(n){return ne(9,Bn(s(n,Vu)))}var yi={make:Qi,add:Ii,show:Pu,encode:qu};function xi(n){return n}function ju(n){return un(cn(s(n,ve)),ve(1))}function Zu(n){if(n.length!==1)return`
`+m(n,`
`,function(r){return"  "+Bt(void 0,r,[],[])})+`
end`;var e=n[0];return Bt(void 0,e,[],[])}var nc={fromInstructions:xi,encode:ju,show:Zu};function ec(n,e,r){return[e,n,r]}function Wu(n){return"global "+(n[1]?"mutable":"immutable")+" "+rt(n[0])+" = "+Zu(n[2])}function Ju(n){return un([tt(n[0]),n[1]?1:0],ju(n[2]))}var mt={Initializer:nc,make:ec,show:Wu,encode:Ju};function tc(n){return[]}function rc(n,e){n.push(e)}function Ku(n){return ee(6)+`
`+m(n,`
`,Wu)}function Yu(n){return ne(6,Bn(s(n,Ju)))}var uc={make:tc,add:rc,show:Ku,encode:Yu};function ac(n){return n}function Hu(n){return"memory "+sr(n)}var Qu={make:ac,show:Hu,encode:qt};function oc(n){return[]}function Iu(n,e){return n.push(e)-1|0}function yu(n){return ee(5)+`
`+m(n,`
`,Hu)}function xu(n){return ne(5,Bn(s(n,qt)))}var ic={make:oc,add:Iu,show:yu,encode:xu},cc={};function na(n){return cn([[0],_n(n._0)])}function ea(n){return"func (index: "+String(n._0)+")"}var _c={make:void 0,encode:na,show:ea};function ta(n){return cn([Pt(n.moduleName),Pt(n.entityName),na(n.desc)])}function fc(n,e,r){return{moduleName:n,entityName:e,desc:r}}function ra(n){return"import "+ea(n.desc)+" "+n.moduleName+"."+n.entityName}var ua={ImportDesc:_c,encode:ta,make:fc,show:ra};function sc(n){return[]}function aa(n,e){return n.push(e)-1|0}function oa(n){return ne(2,Bn(s(n,ta)))}function ia(n){return ee(2)+`
`+m(n,`
`,ra)}function lc(n){return n.length}var vc={make:sc,add:aa,encode:oa,show:ia,count:lc};function dc(n){return[]}function ca(n,e){return n.push(e),n.length-1|0}function _a(n){return ne(10,Bn(s(n,Au)))}function fa(n,e,r){var u=s(Xt(e,function(t){return!0}),function(t){return t.entityName}),a=un(u,s(r,function(t){return t[0]}));return ee(10)+`
`+m(Be(n,r),`

`,function(t){var o=t[1];return o[0]+`
`+wu(t[0],a,o[1])})}var Tc={make:dc,addFunc:ca,encode:_a,show:fa};function sa(n){return n?"active memIndex: "+String(n._0)+" offset: "+String(n._1):"passive"}var Gc={show:sa};function gc(n,e){return{init:n,mode:e}}function la(n){return"segment len: "+String(n.init.length)+" mode: "+sa(n.mode)}function va(n){var e=n.mode,r=n.init;if(!e)return un([1],ke(r));var u=e._0;return u!==0?cn([[2],_n(u),ve({TAG:0,_0:e._1}),ve(1),ke(r)]):cn([[0],ve({TAG:0,_0:e._1}),ve(1),ke(r)])}var hc={make:gc,show:la,encode:va};function Ec(n){return[]}function da(n,e){return n.push(e)-1|0}function Ta(n){return ee(11)+`
`+m(n,`

`,la)}function Ga(n){return ne(11,Bn(s(n,va)))}var Ac={make:Ec,add:da,show:Ta,encode:Ga},wc={Mode:Gc,Segment:hc,Section:Ac};function mc(n){return{typeSection:[],importSection:[],funcSection:[],tableSection:[],memorySection:[],globalSection:[],exportSection:[],elementSection:[],codeSection:[],dataSection:[],funcs:[]}}function Sc(n,e){return fr(n.typeSection,e)}function ga(n,e,r,u){var a=fr(n.typeSection,r);return pu(n.funcSection,a),n.funcs.push([e,r,u]),ca(n.codeSection,u)+n.importSection.length|0}function pc(n,e,r,u){var a=ga(n,e,r,u),t={name:e,kind:0,index:a};return n.exportSection.push(t),a}function bc(n,e){n.exportSection.push(e)}function kc(n,e){n.tableSection.push(e)}function Dc(n,e){n.elementSection.push(e)}function Nc(n,e){n.globalSection.push(e)}function Fc(n,e){return Iu(n.memorySection,e)}function Rc(n,e){return aa(n.importSection,e)}function $c(n,e){return da(n.dataSection,e)}function ha(n){return cn([[0,97,115,109,1,0,0,0],mu(n.typeSection),oa(n.importSection),bu(n.funcSection),Ou(n.tableSection),xu(n.memorySection),Yu(n.globalSection),$u(n.exportSection),qu(n.elementSection),_a(n.codeSection),Ga(n.dataSection)])}function Lc(n){return(e=>Uint8Array.from(e))(ha(n))}function Xc(n){return m([Su(n.typeSection),ia(n.importSection),ku(n.funcSection,s(n.funcs,function(e){return e[0]})),Uu(n.tableSection),yu(n.memorySection),Ku(n.globalSection),Lu(n.exportSection),Pu(n.elementSection),fa(n.codeSection,n.importSection,n.funcs),Ta(n.dataSection)],`

`,function(e){return e})}var Pn={make:mc,getOrAddSignature:Sc,addFunc:ga,addExportedFunc:pc,addExport:bc,addTable:kc,addElement:Dc,addGlobal:Nc,addMemory:Fc,addImport:Rc,addData:$c,encode:ha,encodeAsUint8Array:Lc,show:Xc},Cc=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",uleb128:_n,sleb128:Vt,Vec:oi,I32:ci,I64:fi,F32:si,F64:li,Section:di,ValueType:Ti,BlockReturnType:gi,Inst:hi,Func:wt,TypeSection:Ri,FuncSection:Li,Str:Xi,ExportEntry:Ru,ExportSection:Vi,ReferenceType:qi,Limits:lr,Table:Mu,TableSection:Yi,Elem:Bu,ElementSection:yi,Global:mt,GlobalSection:uc,Memory:Qu,MemorySection:ic,Import:cc,ImportEntry:ua,ImportSection:vc,CodeSection:Tc,Data:wc,Module:Pn});const vr={Else:0,End:1,Return:2,Drop:3,AddI32:4,SubI32:5,MulI32:6,DivI32Unsigned:7,DivI32Signed:8,EqzI32:9,EqI32:10,EqI64:11,EqF32:12,EqF64:13,NeI32:14,NeI64:15,NeF32:16,NeF64:17,LeI32Signed:18,LeI32Unsigned:19,LeI64Signed:20,LeI64Unsigned:21,LeF32:22,LeF64:23,GeI32Signed:24,GeI32Unsigned:25,GeI64Signed:26,GeI64Unsigned:27,GeF32:28,GeF64:29,LtI32Signed:30,LtI32Unsigned:31,LtI64Signed:32,LtI64Unsigned:33,LtF32:34,LtF64:35,GtI32Signed:36,GtI32Unsigned:37,GtI64Signed:38,GtI64Unsigned:39,GtF32:40,GtF64:41,RemI32Signed:42,RemI32Unsigned:43,AndI32:44,OrI32:45,ShlI32:46,ShrI32Signed:47,ShrI32Unsigned:48},Ea={"0":"I32","1":"I64","2":"F32","3":"F64"},L={I32:0,I64:1,F32:2,F64:3},Mc={FuncRef:0,ExternRef:1},Uc={Func:0,Table:1,Memory:2,Global:3},Ee={Void:0},Oc={Passive:0},j=Cc;j.uleb128;j.sleb128;j.Vec.encode;j.Vec.encodeMany;j.I32.encode;j.I64.encode;j.F32.encode;j.F64.encode;j.Func.Signature.funcTypeCode;j.Func.Signature.empty._0.map(function(e){return Ea[e]}),j.Func.Signature.empty._1.map(function(e){return Ea[e]});j.FuncSection.make;j.FuncSection.encode;j.Str.encode;j.Limits.makeExact;j.Elem.show;j.Elem.encode;j.ElementSection.make;j.ElementSection.show;j.ElementSection.encode;j.MemorySection.make;j.ImportEntry.ImportDesc.make;const zc=function(n){return j.Module.show({typeSection:n.typeSection.map(function(u){return{TAG:0,_0:u[0].map(function(t){return L[t]}),_1:u[1].map(function(t){return L[t]})}}),importSection:n.importSection.map(function(u){return{moduleName:u.moduleName,entityName:u.entityName,desc:{TAG:0,_0:u.desc.value}}}),funcSection:n.funcSection,tableSection:n.tableSection.map(function(u){return[Mc[u[0]],[u[1][0],u[1][1]==null?void 0:u[1][1]]]}),memorySection:n.memorySection.map(function(u){return[u[0],u[1]==null?void 0:u[1]]}),globalSection:n.globalSection.map(function(u){return[L[u[0]],u[1],u[2].map(function(t){return typeof t=="object"?t.tag==="ConstI32"?{TAG:0,_0:t.value}:t.tag==="ConstI64"?{TAG:1,_0:t.value}:t.tag==="ConstF32"?{TAG:2,_0:t.value}:t.tag==="ConstF64"?{TAG:3,_0:t.value}:t.tag==="If"?{TAG:4,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="BranchIf"?{TAG:5,_0:t.value}:t.tag==="Branch"?{TAG:6,_0:t.value}:t.tag==="Block"?{TAG:7,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="Loop"?{TAG:8,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="GetGlobal"?{TAG:9,_0:t.value}:t.tag==="SetGlobal"?{TAG:10,_0:t.value}:t.tag==="GetLocal"?{TAG:11,_0:t.value}:t.tag==="SetLocal"?{TAG:12,_0:t.value}:t.tag==="TeeLocal"?{TAG:13,_0:t.value}:t.tag==="Call"?{TAG:14,_0:t.value}:t.tag==="CallIndirect"?{TAG:15,_0:t.value[0],_1:t.value[1]}:t.tag==="LoadI32"?{TAG:16,_0:t.value[0],_1:t.value[1]}:t.tag==="StoreI32"?{TAG:17,_0:t.value[0],_1:t.value[1]}:t.tag==="InitMemory"?{TAG:18,_0:t.value}:{TAG:19,_0:t.value}:vr[t]})]}),exportSection:n.exportSection.map(function(u){return{name:u.name,kind:Uc[u.kind],index:u.index}}),elementSection:n.elementSection,codeSection:n.codeSection.map(function(u){return[u[0].map(function(t){return[t[0],L[t[1]]]}),u[1].map(function(t){return typeof t=="object"?t.tag==="ConstI32"?{TAG:0,_0:t.value}:t.tag==="ConstI64"?{TAG:1,_0:t.value}:t.tag==="ConstF32"?{TAG:2,_0:t.value}:t.tag==="ConstF64"?{TAG:3,_0:t.value}:t.tag==="If"?{TAG:4,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="BranchIf"?{TAG:5,_0:t.value}:t.tag==="Branch"?{TAG:6,_0:t.value}:t.tag==="Block"?{TAG:7,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="Loop"?{TAG:8,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="GetGlobal"?{TAG:9,_0:t.value}:t.tag==="SetGlobal"?{TAG:10,_0:t.value}:t.tag==="GetLocal"?{TAG:11,_0:t.value}:t.tag==="SetLocal"?{TAG:12,_0:t.value}:t.tag==="TeeLocal"?{TAG:13,_0:t.value}:t.tag==="Call"?{TAG:14,_0:t.value}:t.tag==="CallIndirect"?{TAG:15,_0:t.value[0],_1:t.value[1]}:t.tag==="LoadI32"?{TAG:16,_0:t.value[0],_1:t.value[1]}:t.tag==="StoreI32"?{TAG:17,_0:t.value[0],_1:t.value[1]}:t.tag==="InitMemory"?{TAG:18,_0:t.value}:{TAG:19,_0:t.value}:vr[t]})]}),dataSection:n.dataSection.map(function(u){return{init:u.init,mode:typeof u.mode=="object"?{TAG:0,_0:u.mode[0],_1:u.mode[1]}:Oc[u.mode]}}),funcs:n.funcs.map(function(u){return[u[0],{TAG:0,_0:u[1][0].map(function(t){return L[t]}),_1:u[1][1].map(function(t){return L[t]})},[u[2][0].map(function(t){return[t[0],L[t[1]]]}),u[2][1].map(function(t){return typeof t=="object"?t.tag==="ConstI32"?{TAG:0,_0:t.value}:t.tag==="ConstI64"?{TAG:1,_0:t.value}:t.tag==="ConstF32"?{TAG:2,_0:t.value}:t.tag==="ConstF64"?{TAG:3,_0:t.value}:t.tag==="If"?{TAG:4,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="BranchIf"?{TAG:5,_0:t.value}:t.tag==="Branch"?{TAG:6,_0:t.value}:t.tag==="Block"?{TAG:7,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="Loop"?{TAG:8,_0:typeof t.value=="object"?t.value.tag==="TypeValue"?{TAG:0,_0:L[t.value.value]}:{TAG:1,_0:t.value.value[0],_1:[t.value.value[1][0].map(function(i){return L[i]}),t.value.value[1][1].map(function(i){return L[i]})]}:Ee[t.value]}:t.tag==="GetGlobal"?{TAG:9,_0:t.value}:t.tag==="SetGlobal"?{TAG:10,_0:t.value}:t.tag==="GetLocal"?{TAG:11,_0:t.value}:t.tag==="SetLocal"?{TAG:12,_0:t.value}:t.tag==="TeeLocal"?{TAG:13,_0:t.value}:t.tag==="Call"?{TAG:14,_0:t.value}:t.tag==="CallIndirect"?{TAG:15,_0:t.value[0],_1:t.value[1]}:t.tag==="LoadI32"?{TAG:16,_0:t.value[0],_1:t.value[1]}:t.tag==="StoreI32"?{TAG:17,_0:t.value[0],_1:t.value[1]}:t.tag==="InitMemory"?{TAG:18,_0:t.value}:{TAG:19,_0:t.value}:vr[t]})]]})})};j.F32;j.F64;j.I32;j.I64;j.Vec;j.Str;function Vc(n,e,r){return d(e,d(n,r))}var Bc={compose:Vc};function Pc(n){var e=Math.log2(n);return e===Math.floor(e)}var Aa={isPowerOf2:Pc};function qc(n,e){for(var r,u=0;ge(r)&&u<n.length;){var a=d(e,he(n,u));a!==void 0&&(r=N(On(a))),u=u+1|0}return r}function jc(n,e){for(var r,u=n.length-1|0;ge(r)&&u>=0;)d(e,he(n,u))?r=u:u=u-1|0;return r}function Zc(n,e){for(var r,u=n.length-1|0;ge(r)&&u>=0;){var a=he(n,u);d(e,a)?r=N(a):u=u-1|0}return r}function Wc(n,e){for(var r=[],u=!1,a=0;u===!1&&a<n.length;){var t=he(n,a);t!==void 0?r.push(d(e,On(t))):u=!0,a=a+1|0}if(!u)return r}function Jc(n,e){for(var r=[],u,a=0;ge(u)&&a<n.length;){var t=he(n,a);t.TAG===0?r.push(d(e,t._0)):u=N(t._0),a=a+1|0}var o=u;return o!==void 0?{TAG:1,_0:On(o)}:{TAG:0,_0:r}}function Kc(n,e){return J(rr(n,e),function(r){return[he(n,r),r]})}var Ae={firstSomeBy:qc,getReverseIndexBy:jc,getReverseBy:Zc,mapOption:Wc,mapResult:Jc,getValueAndIndexBy:Kc};function ut(n){return[[],n]}var Yc=Ir;function Hc(n,e,r){return Ir(n,e,[[],r])}var Qc=ko,Ic=Do,yc=ur;function xc(n,e){var r=m(yr(xr(n,e)),`
`,function(u){return"  "+u[0]+": "+u[1]});return`{
`+r+`
}`}var zn={empty:void 0,add:Yc,addMono:Hc,remove:Qc,has:Ic,get:yc,show:xc},n_=[],dr={TAG:1,_0:"u8",_1:n_},e_=[],Wn={TAG:1,_0:"u32",_1:e_},t_=[],qn={TAG:1,_0:"bool",_1:t_},r_=[],De={TAG:1,_0:"()",_1:r_};function Ln(n,e){return{TAG:1,_0:"Fun",_1:un(n,[e])}}function u_(n){return{TAG:1,_0:"Tuple",_1:n}}function wa(n,e){return{TAG:1,_0:"Array",_1:[n,{TAG:1,_0:String(e),_1:[]}]}}function a_(n){return{TAG:1,_0:"Ptr",_1:[n]}}function Tr(n){switch(n.TAG|0){case 0:return!1;case 1:return n._0==="Array";case 2:return!0}}var re=En("Types.Size.UnkownTypeSize");function jt(n){for(;;){var e=n;switch(e.TAG|0){case 0:throw{RE_EXN_ID:re,_1:e,Error:new Error};case 1:switch(e._0){case"()":if(e._1.length===0)return 0;throw{RE_EXN_ID:re,_1:e,Error:new Error};case"Array":var r=e._1;if(r.length!==2)throw{RE_EXN_ID:re,_1:e,Error:new Error};var u=r[1];switch(u.TAG|0){case 1:if(u._1.length===0)return 4;throw{RE_EXN_ID:re,_1:e,Error:new Error};case 0:case 2:throw{RE_EXN_ID:re,_1:e,Error:new Error}}case"Mut":var a=e._1;if(a.length!==1)throw{RE_EXN_ID:re,_1:e,Error:new Error};n=a[0];continue;case"Fun":case"Ptr":return 4;case"Tuple":return hn(s(e._1,jt),0,function(t,o){return t+o|0});case"bool":case"u32":break;case"u64":if(e._1.length===0)return 8;throw{RE_EXN_ID:re,_1:e,Error:new Error};case"u8":if(e._1.length===0)return 1;throw{RE_EXN_ID:re,_1:e,Error:new Error};default:throw{RE_EXN_ID:re,_1:e,Error:new Error}}if(e._1.length===0)return 4;throw{RE_EXN_ID:re,_1:e,Error:new Error};case 2:return 4}}}function o_(n){return Math.ceil(Math.log2(jt(n)))|0}function i_(n){return jt(n)===0}var ue={UnkownTypeSize:re,size:jt,sizeLog2:o_,isZeroSizedType:i_};function c_(n){return{TAG:0,_0:n}}function Gr(n,e,r){if(n.TAG===0)return{TAG:1,_0:[e,r],_1:{TAG:0,_0:n._0}};var u=n._1,a=n._0,t=a[1],o=a[0];return e<o?{TAG:1,_0:[e,r],_1:{TAG:1,_0:[o,t],_1:u}}:{TAG:1,_0:[o,t],_1:Gr(u,e,r)}}function __(n){for(;;){var e=n;if(e.TAG===0)return e._0;n=e._1}}function f_(n,e){return hn(n,{TAG:0,_0:{TAG:0,_0:e}},function(r,u){return Gr(r,u[0],u[1])})}function gr(n){var e=function(r,u){for(;;){var a=u,t=r;if(t.TAG===0){var o=t._0;switch(o.TAG|0){case 0:case 1:return a;case 2:var i=o._0;if(i.TAG===0)return a;var c=i._0;if(c.TAG===0)return a;u={hd:c._0,tl:a},r=c._1;continue}}else{u={hd:t._0,tl:a},r=t._1;continue}}};return et(e(n,0))}function s_(n){return No(gr(n))}function ma(n,e){if(n.TAG===0){var r=d(e,n._0);switch(r.TAG|0){case 0:case 1:return{TAG:0,_0:r};case 2:var u=r._0;return u.TAG===0?{TAG:0,_0:r}:u._0}}else{var a=n._0;return{TAG:1,_0:[a[0],d(e,a[1])],_1:ma(n._1,e)}}}function Sa(n,e){var r=function(u,a){for(;;){var t=a,o=u;if(o.TAG===0)return Qr(et({hd:"..."+d(e,o._0),tl:t}));var i=o._0;a={hd:i[0]+": "+d(e,i[1]),tl:t},u=o._1}};return"{ "+m(r(n,0),", ",function(u){return u})+" }"}var jn={make:c_,insert:Gr,tail:__,fromArray:f_,toArray:gr,toMap:s_,map:ma,show:Sa};function Zt(n){switch(n.TAG|0){case 0:return $o(void 0,n._0);case 1:return hn(s(n._1,Zt),void 0,or);case 2:var e=n._0;return e.TAG===0?void 0:hn(s(gr(e._0),function(r){return Bc.compose(function(u){return u[1]},Zt,r)}),void 0,or)}}function l_(n){return nu(Zt(n[1]),Lo(n[0]))}function v_(n){return hn(s(Ro(n),l_),void 0,or)}function hr(n,e){var r=Fo(nu(Zt(e),v_(n)));return[r,e]}function d_(n){var e=String.fromCharCode(97+n%26|0),r=n/26|0;return r===0?e:e+String(r)}function b(n){switch(n.TAG|0){case 0:return d_(n._0);case 1:var e=n._0;if(n._1.length===0)return e;switch(e){case"Array":var r=n._1;if(r.length===2){var u=r[0],a=r[1];switch(a.TAG|0){case 1:if(a._1.length===0)return"["+b(u)+"; "+a._0+"]";break}}break;case"Fun":var t=n._1,o=ar(t,0,t.length-1|0),i=he(t,t.length-1|0);if(o.length!==1)return"("+m(o,", ",b)+") -> "+b(i);var c=o[0];return b(c)+" -> "+b(i);case"Tuple":return"("+m(n._1,", ",b)+")"}return e+"<"+m(n._1,", ",b)+">";case 2:var _=n._0;return _.TAG===0?_._0:Sa(_._0,b)}}function pa(n){switch(n){case 0:return"+";case 1:return"-";case 2:return"*";case 3:return"/";case 4:return"%";case 5:return"<";case 6:return"<=";case 7:return">";case 8:return">=";case 9:return"==";case 10:return"!=";case 11:return"&&";case 12:return"||";case 13:return"&";case 14:return"|";case 15:return"<<";case 16:return">>"}}var T_={show:pa};function ba(n){switch(n){case 0:return"-";case 1:return"!";case 2:return"*"}}var G_={show:ba};function ka(n){if(typeof n=="number")return"()";switch(n.TAG|0){case 0:case 1:return String(n._0);case 2:return n._0?"true":"false"}}var g_={show:ka};function B(n){switch(n.TAG|0){case 0:return ka(n._0);case 1:return ba(n._0)+B(n._1);case 2:return"("+B(n._0)+" "+pa(n._1)+" "+B(n._2)+")";case 3:return n._0;case 4:return B(n._0)+" = "+B(n._1);case 5:var e=n._1,r=n._0,u=r.length;if(u!==1)return u!==0?"("+m(r,", ",function(c){return c})+") -> "+B(e):"() -> "+B(e);var a=r[0];return a+" -> "+B(e);case 6:return"let "+n._0+" = "+B(n._1)+" in "+B(n._2);case 7:return"("+B(n._0)+")("+m(n._1,", ",B)+")";case 8:return(n._2===1?"unsafe ":"")+`{
`+m(un(s(n._0,Da),Tn(n._1,[],function(c){return[B(c)]})),`;
`,function(c){return"  "+c})+`
}`;case 9:var t=n._2,o="if "+B(n._0)+" "+B(n._1);return t!==void 0?o+" else "+B(t):o;case 10:return"while "+B(n._0)+" "+B(n._1);case 11:return"return "+Tn(n._0,"",B);case 12:return B(n._0)+" as "+b(n._1);case 13:return"("+m(n._0,", ",B)+")";case 14:return n._0+` {
`+m(n._1,", ",function(c){return c[0]+": "+B(c[1])})+`
}`;case 15:var i=n._0;return i.TAG===0?"["+B(i._0)+"; "+String(i._1)+"]":"["+m(i._0,", ",B)+"]";case 16:return B(n._0)+"."+n._1}}function Er(n){switch(n.TAG|0){case 0:return"fn "+n._0+"("+m(n._1,", ",function(e){return(e[1]?"mut ":"")+e[0]})+") "+B(n._2);case 1:return(n._1?"mut":"let")+" "+n._0+" = "+B(n._2);case 2:return"struct "+n._0+` {
`+m(n._1,`,
`,function(e){return(e[2]?"mut ":"")+e[0]+": "+b(e[1])})+`
}`;case 3:return"impl "+n._0+` {
`+m(n._1,`

`,Er)+`
}`;case 4:return"extern fn "+n.name+"("+m(n.args,", ",function(e){return(e[2]?"mut ":"")+e[0]+": "+b(e[1])})+") -> "+b(n.ret)}}function Da(n){return n.TAG===0?(n._1?"mut":"let")+" "+n._0+" = "+B(n._2):B(n._0)}var h_={showExpr:B,showDecl:Er,showStmt:Da},E_={show:Er};function A(n,e){for(;;){var r=e;switch(r.TAG|0){case 0:var u=r._0,a=eu(n,u);if(a===void 0)return{TAG:0,_0:u};e=a;continue;case 1:return{TAG:1,_0:r._0,_1:s(r._1,function(i){return A(n,i)})};case 2:var t=r._0,o;return o=t.TAG===0?{TAG:0,_0:t._0}:{TAG:1,_0:jn.map(t._0,function(i){return A(n,i)})},{TAG:2,_0:o}}}}function Na(n,e){var r=e[0];return[r,A(Uo(n,r),e[1])]}function U(n,e){return Xo(Co(e,function(r){return A(n,r)}),n,function(r,u,a){return Mo(a,u)})}function Gn(n,e){return xr(e,function(r){return Na(n,r)})}var Pe;function Ar(n,e){return{TAG:2,_0:{TAG:1,_0:jn.fromArray(s(n.attributes,function(r){return[r.name,r.ty]}),e)}}}function A_(n,e){var r={contents:0},u=[];return Fn(e,function(a){var t=a[1],o=ue.size(t);u.push({name:a[0],mut:a[2],offset:r.contents,ty:t,size:o,impl:void 0}),r.contents=r.contents+o|0}),{name:n,attributes:u,size:r.contents,staticFuncs:[]}}function w_(n,e,r){n.attributes.push({name:e.contents.name,mut:!1,offset:0,ty:e.contents.ty,size:0,impl:[e,r]})}function m_(n,e){n.staticFuncs.push({name:e})}var wr=En("Struct.UndeclaredStruct"),mr=En("Struct.StructTypeNotMatched"),Fa=En("Struct.AmibguousStruct"),Jn={tyVarIndex:0,identifiers:[],renaming:Oo(10),structs:tu(5)};function we(n){var e=Jn.tyVarIndex;return Jn.tyVarIndex=Jn.tyVarIndex+1|0,e}function St(n){return{TAG:0,_0:we()}}function Wt(n){var e=n[0],r=s(e,function(u){return{TAG:0,_0:we()}});return A(Po(Be(e,r)),n[1])}function ae(n,e){var r=n!==void 0?On(n):void 0,u=Jn.identifiers.length;Jn.identifiers.push(e);var a={contents:{name:e,newName:e,index:u,ty:r!==void 0?r:{TAG:0,_0:we()}}};return Vo(Jn.renaming,u,a),a}function S_(n){return xn(Ae.getReverseIndexBy(Jn.identifiers,function(e){return e===n}),function(e){return Bo(Jn.renaming,e)})}function Ra(n,e){e.contents.ty=A(n,e.contents.ty)}function $a(n){return Fn(zo(Jn.renaming),function(e){return Ra(n,e)})}function p_(n){return ir(Jn.structs,n.name,n)}function Kn(n){return ru(Jn.structs,n)}function Ne(n){switch(n.TAG|0){case 0:var e=n._0;if(typeof e=="number")return De;switch(e.TAG|0){case 0:return dr;case 1:return Wn;case 2:return qn}case 3:return n._0.contents.ty;case 4:case 11:return De;case 12:return Tn(n._0,De,Ne);case 13:return n._2;case 14:return u_(s(n._0,Ne));case 15:return{TAG:2,_0:{TAG:0,_0:n._0}};default:return n._0}}function b_(n){return n.TAG===0?n._1:n._0.length}var k_={len:b_};function D_(n){return Ne(n._0)}function K(n,e){var r=n!==void 0?On(n):void 0,u=function(T,p){return r!==void 0?"("+p+": "+b(A(On(r),T))+")":p},a=function(T){return K(N(r),T)};switch(e.TAG|0){case 0:return u(Ne(e),g_.show(e._0));case 1:return u(e._0,"("+K(N(r),e._1)+" "+T_.show(e._2)+" "+K(N(r),e._3)+")");case 2:return u(e._0,"("+G_.show(e._1)+K(N(r),e._2)+")");case 3:var t=e._0;return u(t.contents.ty,t.contents.name);case 4:var o=e._1;return u(Ne(o),K(N(r),e._0)+" = "+K(N(r),o));case 5:return u(e._0,"("+m(e._1,", ",function(T){return T.contents.name})+") -> "+K(N(r),e._2));case 6:return u(e._0,(e._1?"mut":"let")+" "+e._2.contents.name+" = "+K(N(r),e._3)+` in
`+K(N(r),e._4));case 7:return u(e._0,"let rec "+e._1.contents.name+" ("+m(e._2,", ",function(T){return T.contents.name})+") = "+K(N(r),e._3)+` in
`+K(N(r),e._4));case 8:return u(e._0,"("+K(N(r),e._1)+")("+m(e._2,", ",a)+")");case 9:var i=e._2,c=N(r);return u(e._0,(e._3===1?"unsafe ":"")+`{
`+m(un(s(e._1,function(T){return La(c,T)}),Tn(i,[],function(T){return[K(N(r),T)]})),`;
`,function(T){return"  "+T})+(ge(i)?"; ":"")+`
}`);case 10:return u(e._0,"if "+K(N(r),e._1)+" "+K(N(r),e._2)+" else "+K(N(r),e._3));case 11:return u(De,"while "+K(N(r),e._0)+" "+K(N(r),e._1));case 12:return"return "+u(Ne(e),Tn(e._0,"",a));case 13:return K(N(r),e._0)+" as "+b(e._2);case 14:return"("+m(e._0,", ",a)+")";case 15:return e._0+` {
`+m(e._1,`,
`,function(T){return T[0]+": "+K(N(r),T[1])})+`
}`;case 16:var _=e._1,v;return v=_.TAG===0?"["+K(N(r),_._0)+"; "+String(_._1)+"]":"["+m(_._0,", ",function(T){return K(N(r),T)})+"]",u(e._0,v);case 17:return u(e._0,K(N(r),e._1)+"."+e._2)}}function La(n,e){var r=n!==void 0?On(n):void 0;return K(N(r),e._0)}function Sr(n,e){var r=n!==void 0?On(n):void 0,u=function(_,v){return r!==void 0?"("+v+": "+b(A(On(r),_))+")":v};switch(e.TAG|0){case 0:var a=e._1,t=e._0,o;if(r!==void 0){var i=On(r);o=m(a,", ",function(_){var v=_[0];return(_[1]?"mut ":"")+(v.contents.name+": "+b(A(i,v.contents.ty)))})}else o=m(a,", ",function(_){return(_[1]?"mut ":"")+_[0].contents.name});return u(t.contents.ty,"fn "+t.contents.name+"("+o+") "+K(N(r),e._2));case 1:var c=e._0;return u(c.contents.ty,(e._1?"mut":"let")+" "+c.contents.name+" = "+K(N(r),e._2));case 2:return h_.showDecl({TAG:2,_0:e._0,_1:e._1});case 3:return"impl "+e._0+` {
`+m(e._1,`

`,function(_){return Sr(void 0,{TAG:0,_0:_[0],_1:_[1],_2:_[2]})})+`
}`;case 4:return"extern fn "+e.name.contents.name+"("+m(e.args,", ",function(_){var v=_[0];return(_[1]?"mut ":"")+v.contents.name+": "+b(v.contents.ty)})+") -> "+b(e.ret)}}var Xa=En("Core.CoreAst.UnexpectedDeclarationInImplBlock"),Ca=En("Core.CoreAst.UndeclaredIdentifer"),Ma=En("Core.CoreAst.UnreachableLetStmt");function pr(n,e,r,u,a){return r.TAG===5?{TAG:7,_0:r._0,_1:n,_2:r._1,_3:r._2,_4:u}:{TAG:6,_0:a,_1:e,_2:n,_3:r,_4:u}}function P(n){var e={LAZY_DONE:!1,VAL:function(){return St()}};switch(n.TAG|0){case 0:return{TAG:0,_0:n._0};case 1:return{TAG:2,_0:le(e),_1:n._0,_2:P(n._1)};case 2:return{TAG:1,_0:le(e),_1:P(n._0),_2:n._1,_3:P(n._2)};case 3:var r=n._0,u=S_(r);if(u!==void 0)return{TAG:3,_0:u};var a=Kn(r);if(a!==void 0)return{TAG:3,_0:ae(void 0,r)};throw{RE_EXN_ID:Ca,_1:r,Error:new Error};case 4:return{TAG:4,_0:P(n._0),_1:P(n._1)};case 5:var t=n._1,o=n._0;if(o.length===0)return{TAG:5,_0:le(e),_1:[ae(void 0,"__x")],_2:P(t)};var i=N(void 0);return{TAG:5,_0:le(e),_1:s(o,function(R){return ae(i,R)}),_2:P(t)};case 6:return pr(ae(void 0,n._0),!1,P(n._1),P(n._2),le(e));case 7:return{TAG:8,_0:le(e),_1:P(n._0),_2:s(n._1,P)};case 8:var c=n._2,_=n._1,v=function(R){if(!R)return J(_,P);var q=R.hd;if(q.TAG!==0)return{TAG:9,_0:le(e),_1:[Ua(q)],_2:v(R.tl),_3:c};var tn=q._3;return pr(ae(void 0,q._0),q._1,P(q._2),Tn(v(R.tl),{TAG:0,_0:0},function(dn){return dn}),tn!==void 0?tn:St())};return{TAG:9,_0:le(e),_1:[],_2:v(ht(n._0)),_3:c};case 9:return{TAG:10,_0:le(e),_1:P(n._0),_2:P(n._1),_3:Tn(n._2,{TAG:0,_0:0},P)};case 10:return{TAG:11,_0:P(n._0),_1:P(n._1)};case 11:return{TAG:12,_0:J(n._0,P)};case 12:return{TAG:13,_0:P(n._0),_1:le(e),_2:n._1};case 13:return{TAG:14,_0:s(n._0,P)};case 14:return{TAG:15,_0:n._0,_1:s(n._1,function(R){return[R[0],P(R[1])]})};case 15:var T=n._0,p=St(),W;return W=T.TAG===0?{TAG:0,_0:P(T._0),_1:T._1}:{TAG:1,_0:s(T._0,P)},{TAG:16,_0:p,_1:W};case 16:return{TAG:17,_0:St(),_1:P(n._0),_2:n._1}}}function Ua(n){if(n.TAG!==0)return{_0:P(n._0)};throw{RE_EXN_ID:Ma,Error:new Error}}function br(n){switch(n.TAG|0){case 0:var e=s(n._1,function(o){return[ae(N(void 0),o[0]),o[1]]});return{TAG:0,_0:ae(void 0,n._0),_1:e,_2:P(n._2)};case 1:return{TAG:1,_0:ae(void 0,n._0),_1:n._1,_2:P(n._2)};case 2:var r=n._1,u=n._0;return p_(A_(u,r)),{TAG:2,_0:u,_1:r};case 3:var a=s(s(n._1,br),function(o){if(o.TAG===0)return[o._0,o._1,o._2];throw{RE_EXN_ID:Xa,_1:o,Error:new Error}});return{TAG:3,_0:n._0,_1:a};case 4:var t=s(n.args,function(o){return[ae(N(o[1]),o[0]),o[2]]});return{TAG:4,name:ae(void 0,n.name),args:t,ret:n.ret}}}function I(n,e){var r=function(_){return I(n,_)};switch(e.TAG|0){case 0:return{TAG:0,_0:e._0};case 1:return{TAG:1,_0:A(n,e._0),_1:I(n,e._1),_2:e._2,_3:I(n,e._3)};case 2:return{TAG:2,_0:A(n,e._0),_1:e._1,_2:I(n,e._2)};case 3:return{TAG:3,_0:e._0};case 4:return{TAG:4,_0:I(n,e._0),_1:I(n,e._1)};case 5:return{TAG:5,_0:A(n,e._0),_1:e._1,_2:I(n,e._2)};case 6:return{TAG:6,_0:A(n,e._0),_1:e._1,_2:e._2,_3:I(n,e._3),_4:I(n,e._4)};case 7:return{TAG:7,_0:A(n,e._0),_1:e._1,_2:e._2,_3:I(n,e._3),_4:I(n,e._4)};case 8:return{TAG:8,_0:A(n,e._0),_1:I(n,e._1),_2:s(e._2,r)};case 9:return{TAG:9,_0:A(n,e._0),_1:s(e._1,function(_){return Oa(n,_)}),_2:J(e._2,r),_3:e._3};case 10:return{TAG:10,_0:A(n,e._0),_1:I(n,e._1),_2:I(n,e._2),_3:I(n,e._3)};case 11:return{TAG:11,_0:I(n,e._0),_1:I(n,e._1)};case 12:return{TAG:12,_0:J(e._0,r)};case 13:return{TAG:13,_0:I(n,e._0),_1:A(n,e._1),_2:A(n,e._2)};case 14:return{TAG:14,_0:s(e._0,r)};case 15:var u=e._1,a=e._0,t=Kn(a);if(t===void 0)return uu('unreachable: undeclared struct "'+a+"'");var o=Ae.mapOption(s(Xt(t.attributes,function(_){return ge(_.impl)}),function(_){var v=_.name;return Ct(u,function(T){return T[0]===v})}),function(_){return[_[0],I(n,_[1])]});return o!==void 0?{TAG:15,_0:a,_1:o}:uu('unreachable: missing attribute for struct "'+a+'"');case 16:var i=e._1,c;return c=i.TAG===0?{TAG:0,_0:I(n,i._0),_1:i._1}:{TAG:1,_0:s(i._0,r)},{TAG:16,_0:A(n,e._0),_1:c};case 17:return{TAG:17,_0:A(n,e._0),_1:I(n,e._1),_2:e._2}}}function Oa(n,e){return{_0:I(n,e._0)}}function za(n,e){switch(e.TAG|0){case 0:return{TAG:0,_0:e._0,_1:e._1,_2:I(n,e._2)};case 1:return{TAG:1,_0:e._0,_1:e._1,_2:I(n,e._2)};case 3:return{TAG:3,_0:e._0,_1:s(e._1,function(r){return[r[0],r[1],I(n,r[2])]})};case 2:case 4:return e}}function nn(n,e){var r=function(t){return nn(n,t)};switch(e.TAG|0){case 1:return d(n,{TAG:1,_0:e._0,_1:nn(n,e._1),_2:e._2,_3:nn(n,e._3)});case 2:return d(n,{TAG:2,_0:e._0,_1:e._1,_2:nn(n,e._2)});case 0:case 3:return d(n,e);case 4:return d(n,{TAG:4,_0:nn(n,e._0),_1:nn(n,e._1)});case 5:return d(n,{TAG:5,_0:e._0,_1:e._1,_2:nn(n,e._2)});case 6:return d(n,{TAG:6,_0:e._0,_1:e._1,_2:e._2,_3:nn(n,e._3),_4:nn(n,e._4)});case 7:return d(n,{TAG:7,_0:e._0,_1:e._1,_2:e._2,_3:nn(n,e._3),_4:nn(n,e._4)});case 8:return d(n,{TAG:8,_0:e._0,_1:nn(n,e._1),_2:s(e._2,r)});case 9:return d(n,{TAG:9,_0:e._0,_1:s(e._1,function(t){return{_0:nn(n,t._0)}}),_2:J(e._2,r),_3:e._3});case 10:return d(n,{TAG:10,_0:e._0,_1:nn(n,e._1),_2:nn(n,e._2),_3:nn(n,e._3)});case 11:return d(n,{TAG:11,_0:nn(n,e._0),_1:nn(n,e._1)});case 12:return d(n,{TAG:12,_0:J(e._0,r)});case 13:return d(n,{TAG:13,_0:nn(n,e._0),_1:e._1,_2:e._2});case 14:return d(n,{TAG:14,_0:s(e._0,r)});case 15:return d(n,{TAG:15,_0:e._0,_1:s(e._1,function(t){return[t[0],nn(n,t[1])]})});case 16:var u=e._1,a;return a=u.TAG===0?{TAG:0,_0:nn(n,u._0),_1:u._1}:{TAG:1,_0:s(u._0,r)},d(n,{TAG:16,_0:e._0,_1:a});case 17:return d(n,{TAG:17,_0:e._0,_1:nn(n,e._1),_2:e._2})}}function Va(n,e){switch(e.TAG|0){case 0:return{TAG:0,_0:e._0,_1:e._1,_2:nn(n,e._2)};case 1:return{TAG:1,_0:e._0,_1:e._1,_2:nn(n,e._2)};case 3:return{TAG:3,_0:e._0,_1:s(e._1,function(r){return[r[0],r[1],nn(n,r[2])]})};case 2:case 4:return e}}function Ba(n,e,r,u){var a=n!==void 0?On(n):void 0,t=e!==void 0?On(e):void 0;Va(function(o){return o.TAG===9?(J(a,function(i){return d(i,o)}),d(r,o),J(t,function(i){return d(i,o)})):d(r,o),o},u)}function N_(n,e,r,u){var a=n!==void 0?On(n):void 0,t=e!==void 0?On(e):void 0,o=N(t),i=N(a);return Fn(u,function(c){return Ba(i,o,r,c)})}var fn={typeOfExpr:Ne,ArrayInit:k_,typeOfStmt:D_,showExpr:K,showStmt:La,showDecl:Sr,UnexpectedDeclarationInImplBlock:Xa,UndeclaredIdentifer:Ca,UnreachableLetStmt:Ma,rewriteLetIn:pr,fromExpr:P,fromStmt:Ua,fromDecl:br,substExpr:I,substStmt:Oa,substDecl:za,rewriteExpr:nn,rewriteDecl:Va,visitDecl:Ba,visitProg:N_},Xn={show:K,from:P,subst:I,typeOf:Ne},Fe={show:Sr,from:br,subst:za};function Pa(n){return[n,0,n.length]}function F_(n){return Pa(Array.from(n,function(e){return au(e,0)}))}function qa(n,e){var r=e[2],u=n!==void 0?n:1;return[e[0],Math.min(e[1]+u|0,r),r]}function kr(n){return Ve(n[0],n[1])}function Dr(n){return qa(1,n)}function Nr(n){return n[1]===n[2]}function R_(n){return n[0].slice(n[1],n[2])}function at(n,e){var r=kr(e);if(r!==void 0&&d(n,r))return[r,qa(void 0,e)]}function y(n){return function(e){return at(function(r){return r===n},e)}}function ja(n){return n>=97?n<=122:!1}function $_(n){return n>=65?n<=90:!1}function L_(n){return ja(n)?!0:$_(n)}function Za(n){return n>=48?n<=57:!1}function X_(n){return L_(n)?!0:Za(n)}function C_(n){return at(ja,n)}function M_(n){return at(Za,n)}function Fr(n){return at(X_,n)}function U_(n){return n>13||n<9?n===32:!(n===12||n===11)}function O_(n){return at(U_,n)}function g(n,e,r){return J(d(n,r),function(u){return[d(e,u[0]),u[1]]})}function Jt(n,e,r){for(;;){var u=n,a=r,t=u!==void 0?u:[];if(Nr(a))return[t,a];var o=d(e,a);if(o===void 0)return[t,a];t.push(o[0]),r=o[1],n=t}}function Wa(n){return Jt(void 0,O_,n)}function qe(n,e,r){return xn(d(n,r),function(u){var a=u[0];return J(d(e,u[1]),function(t){return[[a,t[0]],t[1]]})})}function Ja(n){return function(e){return g(function(r){return qe(n,function(u){return Jt(void 0,n,u)},r)},function(r){return un([r[0]],r[1])},e)}}function z_(n,e,r,u){return xn(qe(n,e,u),function(a){var t=a[0],o=t[1],i=t[0];return J(d(r,a[1]),function(c){return[[i,o,c[0]],c[1]]})})}function Ka(n){if(!n)return function(a){return[0,a]};var e=n.hd,r=Ka(n.tl),u=function(a){return qe(e,r,a)};return function(a){return g(u,function(t){return{hd:t[0],tl:t[1]}},a)}}function Rr(n,e,r){var u=d(n,r);return u!==void 0?[u[0],u[1]]:d(e,r)}function ot(n,e){return Ae.firstSomeBy(n,function(r){return d(r,e)})}function Z(n){var e=Array.from(n,function(u){var a=au(u,0);return function(t){return at(function(o){return o===a},t)}}),r=Ka(ht(e));return function(u){return g(r,function(a){return n},u)}}function V_(n,e){var r=d(n,e);if(r===void 0)return[void 0,Dr(e)]}var B_=Ja(M_);function $r(n){return g(B_,function(e){return ou(iu(m(e,"",function(r){return Mt(1,r)})))},n)}var P_=Z("u8");function q_(n){return qe($r,P_,n)}function j_(n){return g(q_,function(e){return{TAG:0,_0:e[0],_1:8}},n)}var Z_=Z("u32");function W_(n){return qe($r,Z_,n)}function J_(n){return g(W_,function(e){return{TAG:0,_0:e[0],_1:32}},n)}function K_(n){return Rr(J_,function(e){return g($r,function(r){return{TAG:0,_0:r,_1:32}},e)},n)}var Y_=[j_,K_];function H_(n){return ot(Y_,n)}var Q_=Z("false");function I_(n){return g(Q_,function(e){return{TAG:1,_0:!1}},n)}var y_=Z("true");function x_(n){return g(y_,function(e){return{TAG:1,_0:!0}},n)}function n0(n){return Rr(x_,I_,n)}var e0=[Fr,y(95),y(39)];function t0(n){return ot(e0,n)}function r0(n){return Jt(void 0,t0,n)}var u0=y(95);function a0(n){return Rr(C_,u0,n)}function o0(n){return qe(a0,r0,n)}function i0(n){return g(o0,function(e){return{TAG:3,_0:Mt(1,e[0])+m(e[1],"",function(r){return Mt(1,r)})}},n)}var c0=[Fr,y(95)],_0=Ja(function(n){return ot(c0,n)});function f0(n){return g(_0,function(e){return{TAG:4,_0:m(e,"",function(r){return Mt(1,r)})}},n)}var s0=Z("let"),l0=Z("mut"),v0=Z("in"),d0=Z("if"),T0=Z("else"),G0=Z("fn"),g0=Z("while"),h0=Z("return"),E0=Z("as"),A0=Z("unsafe"),w0=Z("struct"),m0=Z("impl"),S0=Z("extern"),p0=[function(n){return g(s0,function(e){return{TAG:5,_0:0}},n)},function(n){return g(l0,function(e){return{TAG:5,_0:1}},n)},function(n){return g(v0,function(e){return{TAG:5,_0:2}},n)},function(n){return g(d0,function(e){return{TAG:5,_0:3}},n)},function(n){return g(T0,function(e){return{TAG:5,_0:4}},n)},function(n){return g(G0,function(e){return{TAG:5,_0:5}},n)},function(n){return g(g0,function(e){return{TAG:5,_0:6}},n)},function(n){return g(h0,function(e){return{TAG:5,_0:7}},n)},function(n){return g(E0,function(e){return{TAG:5,_0:8}},n)},function(n){return g(A0,function(e){return{TAG:5,_0:9}},n)},function(n){return g(w0,function(e){return{TAG:5,_0:10}},n)},function(n){return g(m0,function(e){return{TAG:5,_0:11}},n)},function(n){return g(S0,function(e){return{TAG:5,_0:12}},n)}];function b0(n){return ot(p0,n)}function k0(n){return qe(b0,function(e){return V_(Fr,e)},n)}function D0(n){return g(k0,function(e){return e[0]},n)}var N0=Z("->"),F0=Z("=="),R0=Z("!="),$0=Z("&&"),L0=Z("||"),X0=Z("+="),C0=Z("-="),M0=Z("*="),U0=Z("/="),O0=Z("%="),z0=y(43),V0=y(45),B0=y(42),P0=y(47),q0=y(37),j0=Z("<="),Z0=Z(">="),W0=y(60),J0=y(62),K0=y(40),Y0=y(41),H0=y(44),Q0=y(59),I0=y(61),y0=y(123),x0=y(125),nf=y(91),ef=y(93),tf=y(58),rf=y(33),uf=y(46),af=y(38),of=y(124),cf=y(39),_f=y(34),ff=[function(n){return g(N0,function(e){return{TAG:2,_0:5}},n)},function(n){return g(F0,function(e){return{TAG:2,_0:16}},n)},function(n){return g(R0,function(e){return{TAG:2,_0:17}},n)},function(n){return g($0,function(e){return{TAG:2,_0:25}},n)},function(n){return g(L0,function(e){return{TAG:2,_0:27}},n)},function(n){return g(X0,function(e){return{TAG:2,_0:28}},n)},function(n){return g(C0,function(e){return{TAG:2,_0:29}},n)},function(n){return g(M0,function(e){return{TAG:2,_0:30}},n)},function(n){return g(U0,function(e){return{TAG:2,_0:31}},n)},function(n){return g(O0,function(e){return{TAG:2,_0:32}},n)},function(n){return g(z0,function(e){return{TAG:2,_0:11}},n)},function(n){return g(V0,function(e){return{TAG:2,_0:12}},n)},function(n){return g(B0,function(e){return{TAG:2,_0:13}},n)},function(n){return g(P0,function(e){return{TAG:2,_0:14}},n)},function(n){return g(q0,function(e){return{TAG:2,_0:15}},n)},function(n){return g(j0,function(e){return{TAG:2,_0:19}},n)},function(n){return g(Z0,function(e){return{TAG:2,_0:21}},n)},function(n){return g(W0,function(e){return{TAG:2,_0:18}},n)},function(n){return g(J0,function(e){return{TAG:2,_0:20}},n)},function(n){return g(K0,function(e){return{TAG:2,_0:0}},n)},function(n){return g(Y0,function(e){return{TAG:2,_0:1}},n)},function(n){return g(H0,function(e){return{TAG:2,_0:2}},n)},function(n){return g(Q0,function(e){return{TAG:2,_0:3}},n)},function(n){return g(I0,function(e){return{TAG:2,_0:4}},n)},function(n){return g(y0,function(e){return{TAG:2,_0:6}},n)},function(n){return g(x0,function(e){return{TAG:2,_0:7}},n)},function(n){return g(nf,function(e){return{TAG:2,_0:8}},n)},function(n){return g(ef,function(e){return{TAG:2,_0:9}},n)},function(n){return g(tf,function(e){return{TAG:2,_0:10}},n)},function(n){return g(rf,function(e){return{TAG:2,_0:22}},n)},function(n){return g(uf,function(e){return{TAG:2,_0:23}},n)},function(n){return g(af,function(e){return{TAG:2,_0:24}},n)},function(n){return g(of,function(e){return{TAG:2,_0:26}},n)},function(n){return g(cf,function(e){return{TAG:2,_0:33}},n)},function(n){return g(_f,function(e){return{TAG:2,_0:34}},n)}];function sf(n){return ot(ff,n)}var lf=[H_,n0,D0,sf,i0,f0];function vf(n){return ot(lf,n)}function df(n){return Jt(void 0,function(e){return g(function(r){return z_(Wa,vf,Wa,r)},function(r){return r[1]},e)},n)}function Tf(n){switch(n){case 0:return"(";case 1:return")";case 2:return",";case 3:return";";case 4:return"=";case 5:return"->";case 6:return"{";case 7:return"}";case 8:return"[";case 9:return"]";case 10:return":";case 11:return"+";case 12:return"-";case 13:return"*";case 14:return"/";case 15:return"%";case 16:return"==";case 17:return"!=";case 18:return"<";case 19:return"<=";case 20:return">";case 21:return">=";case 22:return"!";case 23:return".";case 24:return"&";case 25:return"&&";case 26:return"|";case 27:return"||";case 28:return"+=";case 29:return"-=";case 30:return"*=";case 31:return"/=";case 32:return"%=";case 33:return"'";case 34:return'"'}}function Gf(n){switch(n){case 0:return"let";case 1:return"mut";case 2:return"in";case 3:return"if";case 4:return"else";case 5:return"fn";case 6:return"while";case 7:return"return";case 8:return"as";case 9:return"unsafe";case 10:return"struct";case 11:return"impl";case 12:return"extern"}}function gf(n){switch(n.TAG|0){case 0:return String(n._0);case 1:return n._0?"true":"false";case 2:return Tf(n._0);case 3:case 4:return n._0;case 5:return Gf(n._0)}}function it(n){return{contents:function(e){return xn(kr(e),function(r){if(d(n,r))return[r,Dr(e)]})}}}function ct(n){return{contents:function(e){return xn(kr(e),function(r){return J(d(n,r),function(u){return[u,Dr(e)]})})}}}function hf(n,e){return{contents:function(r){var u=d(n.contents,r);if(u!==void 0){var a=u[1];return J(d(e,u[0]),function(t){return[t,a]})}}}}function l(n){return it(function(e){return Un(e,n)})}function G(n,e){return{contents:function(r){return J(d(n.contents,r),function(u){return[d(e,u[0]),u[1]]})}}}function sn(n,e){return{contents:function(r){return xn(d(n.contents,r),function(u){var a=u[0];return J(d(e.contents,u[1]),function(t){return[[a,t[0]],t[1]]})})}}}function pt(n){var e=function(r){return{contents:function(u){if(Nr(u))return[0,u];var a=d(r.contents,u);if(a===void 0)return[0,u];var t=a[0];return J(d(e(r).contents,a[1]),function(o){return[{hd:t,tl:o[0]},o[1]]})}}};return G(e(n),et)}function Ef(n){return G(sn(n,pt(n)),function(e){return un([e[0]],e[1])})}function Yn(n,e,r){return{contents:function(u){return xn(d(sn(n,e).contents,u),function(a){var t=a[0],o=t[1],i=t[0];return J(d(r.contents,a[1]),function(c){return[[i,o,c[0]],c[1]]})})}}}function je(n,e,r,u){return{contents:function(a){return xn(d(Yn(n,e,r).contents,a),function(t){var o=t[0],i=o[2],c=o[1],_=o[0];return J(d(u.contents,t[1]),function(v){return[[_,c,i,v[0]],v[1]]})})}}}function bt(n,e,r,u,a){return{contents:function(t){return xn(d(je(n,e,r,u).contents,t),function(o){var i=o[0],c=i[3],_=i[2],v=i[1],T=i[0];return J(d(a.contents,o[1]),function(p){return[[T,v,_,c,p[0]],p[1]]})})}}}function Ya(n,e,r,u,a,t){return{contents:function(o){return xn(d(bt(n,e,r,u,a).contents,o),function(i){var c=i[0],_=c[4],v=c[3],T=c[2],p=c[1],W=c[0];return J(d(t.contents,i[1]),function(R){return[[W,p,T,v,_,R[0]],R[1]]})})}}}function Af(n,e,r,u,a,t,o){return{contents:function(i){return xn(d(Ya(n,e,r,u,a,t).contents,i),function(c){var _=c[0],v=_[5],T=_[4],p=_[3],W=_[2],R=_[1],q=_[0];return J(d(o.contents,c[1]),function(tn){return[[q,R,W,p,T,v,tn[0]],tn[1]]})})}}}function V(n,e){return{contents:function(r){var u=d(n.contents,r);return u!==void 0?[u[0],u[1]]:d(e.contents,r)}}}function Ze(n){return{contents:function(e){return Ae.firstSomeBy(n,function(r){return d(r.contents,e)})}}}function Ha(n,e,r){return G(sn(n,pt(e)),function(u){var a=u[1],t=u[0];return Un(a,[])?t:hn(a,t,r)})}function We(n,e,r){return Ha(n,sn(e,n),function(u,a){return qo(r,u,a[0],a[1])})}function Re(n){return G(Yn(it(function(e){return Un(e,{TAG:2,_0:0})}),n,it(function(e){return Un(e,{TAG:2,_0:1})})),function(e){return e[1]})}function Lr(n){return G(Yn(it(function(e){return Un(e,{TAG:2,_0:8})}),n,it(function(e){return Un(e,{TAG:2,_0:9})})),function(e){return e[1]})}function wf(n,e){var r=function(u,a){var t=d(n.contents,u);if(t===void 0)return[a,u];var o=t[1];return a.push(t[0]),Tn(d(e.contents,o),[a,o],function(i){return r(i[1],a)})};return{contents:function(u){return r(u,[])}}}function de(n){return wf(n,it(function(e){return Un(e,{TAG:2,_0:2})}))}function Te(n){return V(G(n,function(e){return N(e)}),{contents:function(e){return[void 0,e]}})}var Qa=sn,Ia={contents:function(n){}},ln={contents:function(n){}},_t={contents:function(n){}},ya={contents:function(n){}},oe={contents:function(n){}},Xr=ct(function(n){if(n.TAG===0){var e=n._0;return n._1===32?{TAG:0,_0:{TAG:1,_0:e}}:{TAG:0,_0:{TAG:0,_0:e}}}}),mf=ct(function(n){if(n.TAG===1)return{TAG:0,_0:{TAG:2,_0:n._0}}}),ie=ct(function(n){if(n.TAG===3)return n._0}),Kt=ct(function(n){if(n.TAG===4)return n._0}),Cr=ct(function(n){switch(n.TAG|0){case 3:case 4:return n._0;default:return}}),Sf=G(sn(l({TAG:2,_0:0}),l({TAG:2,_0:1})),function(n){return De}),pf=V(Sf,ct(function(n){switch(n.TAG|0){case 3:switch(n._0){case"bool":return qn;case"u32":return Wn;case"u8":return dr;default:return}case 4:return{TAG:2,_0:{TAG:0,_0:n._0}};default:return}})),xa=V(pf,Re(oe));function no(n){if(n.TAG!==0)return-1;var e=n._0;return typeof e=="number"||e.TAG!==1?-1:e._0}var bf=V(G(Lr(Yn(oe,l({TAG:2,_0:3}),Xr)),function(n){return wa(n[0],no(n[2]))}),xa),kf=V(G(Yn(V(Re(de(oe)),G(xa,function(n){return[n]})),l({TAG:2,_0:5}),oe),function(n){return Ln(n[0],n[2])}),bf),Df=V(G(je(Kt,l({TAG:2,_0:18}),de(oe),l({TAG:2,_0:20})),function(n){return{TAG:1,_0:n[0],_1:n[2]}}),kf);oe.contents=Df.contents;var Nf=G(sn(Cr,Te(sn(l({TAG:2,_0:10}),oe))),function(n){return[n[0],J(n[1],function(e){return e[1]})]}),Ff=G(V(ie,Cr),function(n){return{TAG:3,_0:n}}),Rf=G(sn(l({TAG:2,_0:0}),l({TAG:2,_0:1})),function(n){return{TAG:0,_0:0}}),$f=G(Re(je(ln,l({TAG:2,_0:2}),ln,Te(sn(l({TAG:2,_0:2}),de(ln))))),function(n){var e=un([n[0],n[2]],Tn(n[3],[],function(r){return r[1]}));return{TAG:13,_0:e}}),eo=Ze([Xr,mf,Rf,Ff,$f,Re(ln)]),to=V(Ha(eo,sn(l({TAG:2,_0:23}),ie),function(n,e){return{TAG:16,_0:n,_1:e[1]}}),eo),ro=V(G(sn(to,Ef(Re(de(ln)))),function(n){return hn(n[1],n[0],function(e,r){return{TAG:7,_0:e,_1:r}})}),to),Lf=Ze([G(l({TAG:2,_0:13}),function(n){return 2}),G(l({TAG:2,_0:12}),function(n){return 0}),G(l({TAG:2,_0:22}),function(n){return 1})]),Xf=V(G(l({TAG:2,_0:11}),function(n){return 0}),G(l({TAG:2,_0:12}),function(n){return 1})),Cf=Ze([G(l({TAG:2,_0:13}),function(n){return 2}),G(l({TAG:2,_0:14}),function(n){return 3}),G(l({TAG:2,_0:15}),function(n){return 4})]),Mf=Ze([G(l({TAG:2,_0:25}),function(n){return 11}),G(l({TAG:2,_0:27}),function(n){return 12})]),Uf=Ze([G(l({TAG:2,_0:24}),function(n){return 13}),G(l({TAG:2,_0:26}),function(n){return 14}),G(Qa(l({TAG:2,_0:18}),l({TAG:2,_0:18})),function(n){return 15}),G(Qa(l({TAG:2,_0:20}),l({TAG:2,_0:20})),function(n){return 16})]),Of=Ze([G(l({TAG:2,_0:18}),function(n){return 5}),G(l({TAG:2,_0:19}),function(n){return 6}),G(l({TAG:2,_0:20}),function(n){return 7}),G(l({TAG:2,_0:21}),function(n){return 8})]),zf=V(G(l({TAG:2,_0:16}),function(n){return 9}),G(l({TAG:2,_0:17}),function(n){return 10})),Vf=V(G(sn(Lf,ro),function(n){return{TAG:1,_0:n[0],_1:n[1]}}),ro),Bf=We(Vf,Cf,function(n,e,r){return{TAG:2,_0:n,_1:e,_2:r}}),Pf=We(Bf,Xf,function(n,e,r){return{TAG:2,_0:n,_1:e,_2:r}}),qf=We(Pf,Mf,function(n,e,r){return{TAG:2,_0:n,_1:e,_2:r}}),jf=We(qf,Uf,function(n,e,r){return{TAG:2,_0:n,_1:e,_2:r}}),Zf=We(jf,Of,function(n,e,r){return{TAG:2,_0:n,_1:e,_2:r}}),Wf=We(Zf,zf,function(n,e,r){return{TAG:2,_0:n,_1:e,_2:r}}),Jf=V(G(je(l({TAG:5,_0:3}),ln,_t,Te(sn(l({TAG:5,_0:4}),_t))),function(n){return{TAG:9,_0:n[1],_1:n[2],_2:J(n[3],function(e){return e[1]})}}),Wf),Kf=V(G(Yn(l({TAG:5,_0:6}),ln,_t),function(n){return{TAG:10,_0:n[1],_1:n[2]}}),Jf),Yf=V(G(Ya(l({TAG:5,_0:0}),ie,l({TAG:2,_0:4}),ln,l({TAG:5,_0:2}),ln),function(n){return{TAG:6,_0:n[1],_1:n[3],_2:n[5]}}),Kf),Hf=V(Re(de(ie)),G(ie,function(n){return[n]})),Qf=V(G(Yn(Hf,l({TAG:2,_0:5}),ln),function(n){return{TAG:5,_0:n[0],_1:n[2]}}),Yf),If=hf(ln,function(n){switch(n.TAG|0){case 9:case 10:return[!0,{TAG:1,_0:n}];default:return}});_t.contents=V(G(bt(Te(l({TAG:5,_0:9})),l({TAG:2,_0:6}),pt(V(G(ya,function(n){return[!1,n]}),If)),Te(ln),l({TAG:2,_0:7})),function(n){var e=n[3],r=n[2],u=s(r,function(i){return i[1]}),a=Tn(n[0],0,function(i){return 1}),t=Ve(r,r.length-1|0);if(t===void 0)return{TAG:8,_0:u,_1:e,_2:a};var o=t[1];return o.TAG===0||!(t[0]&&ge(e))?{TAG:8,_0:u,_1:e,_2:a}:{TAG:8,_0:ar(u,0,r.length-1|0),_1:o._0,_2:a}}),Qf).contents;var yf=G(Lr(Yn(ln,l({TAG:2,_0:3}),Xr)),function(n){return{TAG:15,_0:{TAG:0,_0:n[0],_1:no(n[2])}}}),xf=G(Lr(de(ln)),function(n){return{TAG:15,_0:{TAG:1,_0:n}}}),ns=V(V(yf,xf),_t),es=V(G(je(Kt,l({TAG:2,_0:6}),de(Yn(ie,l({TAG:2,_0:10}),ln)),l({TAG:2,_0:7})),function(n){return{TAG:14,_0:n[0],_1:s(n[2],function(e){return[e[0],e[2]]})}}),ns),ts=Ze([G(l({TAG:2,_0:4}),function(n){return"eq"}),G(l({TAG:2,_0:28}),function(n){return"plusEq"}),G(l({TAG:2,_0:29}),function(n){return"minusEq"}),G(l({TAG:2,_0:30}),function(n){return"starEq"}),G(l({TAG:2,_0:31}),function(n){return"divEq"}),G(l({TAG:2,_0:32}),function(n){return"modEq"})]),rs=We(es,ts,function(n,e,r){return e==="minusEq"?{TAG:4,_0:n,_1:{TAG:2,_0:n,_1:1,_2:r}}:e==="divEq"?{TAG:4,_0:n,_1:{TAG:2,_0:n,_1:3,_2:r}}:e==="eq"?{TAG:4,_0:n,_1:r}:e==="starEq"?{TAG:4,_0:n,_1:{TAG:2,_0:n,_1:2,_2:r}}:e==="modEq"?{TAG:4,_0:n,_1:{TAG:2,_0:n,_1:4,_2:r}}:{TAG:4,_0:n,_1:{TAG:2,_0:n,_1:0,_2:r}}}),us=V(G(sn(l({TAG:5,_0:7}),Te(ln)),function(n){return{TAG:11,_0:n[1]}}),rs),as=G(sn(us,Te(sn(l({TAG:5,_0:8}),oe))),function(n){var e=n[1],r=n[0];return e!==void 0?{TAG:12,_0:r,_1:e[1]}:r});ln.contents=as.contents;var os=G(sn(ln,l({TAG:2,_0:3})),function(n){return{TAG:1,_0:n[0]}}),is=V(G(bt(V(l({TAG:5,_0:0}),l({TAG:5,_0:1})),Nf,l({TAG:2,_0:4}),ln,l({TAG:2,_0:3})),function(n){var e=n[1];return{TAG:0,_0:e[0],_1:Un(n[0],{TAG:5,_0:1}),_2:n[3],_3:e[1]}}),os);ya.contents=is.contents;var cs=G(bt(V(l({TAG:5,_0:0}),l({TAG:5,_0:1})),Cr,l({TAG:2,_0:4}),ln,l({TAG:2,_0:3})),function(n){return{TAG:1,_0:n[1],_1:Un(n[0],{TAG:5,_0:1}),_2:n[3]}}),_s=V(G(bt(l({TAG:5,_0:10}),Kt,l({TAG:2,_0:6}),de(Yn(sn(Te(l({TAG:5,_0:1})),ie),l({TAG:2,_0:10}),oe)),l({TAG:2,_0:7})),function(n){var e=s(n[3],function(r){var u=r[0];return[u[1],r[2],Ut(u[0])]});return{TAG:2,_0:n[1],_1:e}}),cs),uo=V(G(je(l({TAG:5,_0:5}),ie,G(Re(de(sn(Te(l({TAG:5,_0:1})),ie))),function(n){return s(n,function(e){return[e[1],Ut(e[0])]})}),_t),function(n){return{TAG:0,_0:n[1],_1:n[2],_2:n[3]}}),_s),fs=V(G(Af(l({TAG:5,_0:12}),l({TAG:5,_0:5}),ie,Re(G(de(je(Te(l({TAG:5,_0:1})),ie,l({TAG:2,_0:10}),oe)),function(n){return s(n,function(e){return[e[1],e[3],Ut(e[0])]})})),l({TAG:2,_0:5}),oe,l({TAG:2,_0:3})),function(n){return{TAG:4,name:n[2],args:n[3],ret:n[5]}}),uo),ss=V(G(Yn(l({TAG:5,_0:11}),Kt,G(Yn(l({TAG:2,_0:6}),pt(uo),l({TAG:2,_0:7})),function(n){return n[1]})),function(n){return{TAG:3,_0:n[1],_1:n[2]}}),fs);Ia.contents=ss.contents;var ls=pt(Ia);function Yt(n){var e=n.replace(/(\/\/[^\n]*)/g,""),r=df(F_(e));if(r===void 0)return{TAG:1,_0:"could not tokenize"};var u=d(ls.contents,Pa(r[0]));if(u===void 0)return{TAG:1,_0:"could not parse"};var a=u[1];if(Nr(a))return{TAG:0,_0:u[0]};var t=m(ar(R_(a),0,5)," ",gf);return{TAG:1,_0:"could not parse near "+t}}function vs(n,e){var r=n!==void 0?n:100,u={contents:e.length},a=function(t,o,i){for(;;){var c=i,_=o,v=t;if(v){var T=v.hd,p=0;if(typeof T=="number")switch(T){case 2:var W=v.tl;if(W&&W.hd===3){t={hd:2,tl:W.tl};continue}break;case 9:var R=v.tl;if(R&&R.hd===9){t=R.tl;continue}break;case 10:var q=v.tl;if(q&&q.hd===9){t={hd:14,tl:q.tl};continue}break;case 14:var tn=v.tl;if(tn&&tn.hd===9){t={hd:10,tl:tn.tl};continue}break;case 18:var dn=v.tl;if(dn&&dn.hd===9){t={hd:36,tl:dn.tl};continue}break;case 19:var Rn=v.tl;if(Rn&&Rn.hd===9){t={hd:37,tl:Rn.tl};continue}break;case 24:var wn=v.tl;if(wn&&wn.hd===9){t={hd:30,tl:wn.tl};continue}break;case 25:var pn=v.tl;if(pn&&pn.hd===9){t={hd:31,tl:pn.tl};continue}break;case 30:var bn=v.tl;if(bn&&bn.hd===9){t={hd:24,tl:bn.tl};continue}break;case 31:var mn=v.tl;if(mn&&mn.hd===9){t={hd:25,tl:mn.tl};continue}break;case 36:var gn=v.tl;if(gn&&gn.hd===9){t={hd:18,tl:gn.tl};continue}break;case 37:var on=v.tl;if(on&&on.hd===9){t={hd:19,tl:on.tl};continue}break}else switch(T.TAG|0){case 0:var C=T._0,Vn=0,Sn=v.tl;if(Sn){var kn=Sn.hd;if(typeof kn=="number")switch(kn){case 3:t=Sn.tl;continue;case 6:if(Aa.isPowerOf2(C)){t={hd:{TAG:0,_0:Math.log2(C)|0},tl:{hd:46,tl:Sn.tl}};continue}break;case 7:if(Aa.isPowerOf2(C)){t={hd:{TAG:0,_0:Math.log2(C)|0},tl:{hd:48,tl:Sn.tl}};continue}break;default:Vn=3}else switch(kn.TAG|0){case 0:var rn=Sn.tl;if(rn){var Dn=rn.hd;if(typeof Dn=="number"){var $n=kn._0;if(Dn>=15){if(Dn>=43)switch(Dn){case 43:t={hd:{TAG:0,_0:jo(C,$n)},tl:rn.tl};continue;case 46:t={hd:{TAG:0,_0:C<<$n},tl:rn.tl};continue;case 44:case 45:case 47:break;case 48:t={hd:{TAG:0,_0:C>>>$n|0},tl:rn.tl};continue}}else switch(Dn){case 4:t={hd:{TAG:0,_0:C+$n|0},tl:rn.tl};continue;case 5:t={hd:{TAG:0,_0:C-$n|0},tl:rn.tl};continue;case 6:t={hd:{TAG:0,_0:Math.imul(C,$n)},tl:rn.tl};continue;case 7:t={hd:{TAG:0,_0:Zo(C,$n)},tl:rn.tl};continue;case 10:t={hd:{TAG:0,_0:C===$n?1:0},tl:rn.tl};continue;case 0:case 1:case 2:case 3:case 8:case 9:case 11:case 12:case 13:break;case 14:t={hd:{TAG:0,_0:C===$n?0:1},tl:rn.tl};continue}}}break;case 15:t={hd:{TAG:14,_0:C},tl:Sn.tl};continue;default:Vn=3}}if(Vn===3&&C===0){var _e=v.tl,Hn=_e.hd;if(typeof Hn=="number"){if(Hn>=46){if(Hn!==47){t=_e.tl;continue}}else if(Hn===10){t={hd:9,tl:_e.tl};continue}}}break;case 1:case 2:case 3:case 9:case 11:p=2;break;case 12:var Qn=v.tl;if(Qn){var Le=Qn.hd;if(typeof Le!="number"&&Le.TAG===11){var fe=T._0;if(fe===Le._0){t={hd:{TAG:13,_0:fe},tl:Qn.tl};continue}}}break;case 13:var se=v.tl;if(se&&se.hd===3){t={hd:{TAG:12,_0:T._0},tl:se.tl};continue}break}if(p===2){var Ge=v.tl;if(Ge&&Ge.hd===3){t=Ge.tl;continue}}o={hd:T,tl:_},t=v.tl;continue}var In=Yr(_),yn=Wo(In);if(!(c>1&&yn<u.contents))return In;u.contents=yn,i=c-1|0,o=0,t=In}};return r>0?et(a(ht(e),0,r)):e}function Mr(n,e){switch(e.TAG|0){case 0:return n===e._0;case 1:return cr(e._1,function(u){return Mr(n,u)});case 2:var r=e._0;return r.TAG===0?!1:cr(jn.toArray(r._0),function(u){return Mr(n,u[1])})}}function ao(n,e,r){if(Mr(n,e))return{TAG:1,_0:b({TAG:0,_0:n})+" occurs in "+b(e)};var u=eu(r,n);return u!==void 0?Un(u,e)?{TAG:0,_0:r}:{TAG:1,_0:b(e)+" is not unifiable with "+b(u)}:{TAG:0,_0:cu(r,n,e)}}function ft(n,e){for(;;){var r=n;if(!r)return{TAG:0,_0:e};var u=r.tl,a=r.hd,t=a[1],o=a[0],i=0;switch(o.TAG|0){case 0:var c=o._0,_=0;switch(t.TAG|0){case 0:if(c===t._0){n=u;continue}_=3;break;case 1:case 2:_=3;break}if(_===3)return F(ao(c,t,e),function(on){return function(C){return ft(on,C)}}(u));break;case 1:var v=o._1;switch(t.TAG|0){case 0:i=1;break;case 1:var T=t._1;if(o._0===t._0&&v.length===T.length){var p=hn(Be(v,T),u,function(on,C){return{hd:[A(e,C[0]),A(e,C[1])],tl:on}});n=p;continue}i=2;break;case 2:i=2;break}break;case 2:var W=o._0;switch(t.TAG|0){case 0:i=1;break;case 1:i=2;break;case 2:var R=t._0;if(W.TAG===0){var q=W._0;if(R.TAG===0){if(q!==R._0)return{TAG:1,_0:"cannot unify "+b(o)+" with "+b(t)};n=u;continue}var tn=Kn(q);if(tn===void 0)return{TAG:1,_0:'undeclared struct "'+q+'"'};var dn=ft({hd:[{TAG:2,_0:{TAG:1,_0:R._0}},Ar(tn,we())],tl:u},e);return dn.TAG===0?{TAG:0,_0:dn._0}:{TAG:1,_0:"struct type "+b(t)+" does not match "+q+": "+dn._0}}var Rn=W._0;if(R.TAG===0){var wn=R._0,pn=Kn(wn);if(pn===void 0)return{TAG:1,_0:'undeclared struct "'+wn+'"'};var bn=ft({hd:[{TAG:2,_0:{TAG:1,_0:Rn}},Ar(pn,we())],tl:u},e);return bn.TAG===0?{TAG:0,_0:bn._0}:{TAG:1,_0:"struct type "+b(o)+" does not match "+wn+": "+bn._0}}var mn=jn.toMap(R._0),gn=jn.toArray(Rn);return F(Ae.mapResult(s(gn,function(on,C,Vn){return function(Sn){var kn=Sn[0],rn=ur(Vn,kn);return rn!==void 0?{TAG:0,_0:[Sn[1],rn]}:{TAG:1,_0:"struct type "+b(C)+' is missing attribute "'+kn+'" from type "'+b(on)+'"'}}}(o,t,mn)),function(on){return on}),function(on,C,Vn,Sn){return function(kn){var rn={TAG:2,_0:{TAG:1,_0:jn.fromArray(yr(Jo(Vn,s(Sn,function(Dn){return Dn[0]}))),we())}};return ft(Ko(ht(kn),{hd:[jn.tail(C),rn],tl:on}),e)}}(u,Rn,mn,gn))}break}switch(i){case 1:return F(ao(t._0,o,e),function(on){return function(C){return ft(on,C)}}(u));case 2:return{TAG:1,_0:b(o)+" is not unifiable with "+b(t)}}}}function an(n,e){return ft({hd:[n,e],tl:0},void 0)}function ds(n,e){return Yo(an(n,e))}function Ts(n,e){return"cannot infer struct type: inferred type "+jn.show(n,b)+" matches "+m(e,", ",function(r){return r.name})}function Ur(n){var e=Ho(_u(Jn.structs),function(a){return Qo(an({TAG:2,_0:{TAG:1,_0:n}},Ar(a,we())),void 0,function(t){return a})}),r=e.length;if(r!==1)return r!==0?{TAG:1,_0:e}:0;var u=e[0];return{TAG:0,_0:u}}function Gs(n){var e;if(typeof n=="number")e=De;else switch(n.TAG|0){case 0:e=dr;break;case 1:e=Wn;break;case 2:e=qn;break}return ut(e)}function gs(n){var e=0;if(n>=5)switch(n){case 5:case 6:case 7:case 8:e=2;break;case 9:case 10:e=3;break;case 11:case 12:return ut(Ln([qn,qn],qn));case 13:case 14:case 15:case 16:e=1;break}else e=1;switch(e){case 1:return ut(Ln([Wn,Wn],Wn));case 2:return ut(Ln([Wn,Wn],qn));case 3:return[[0],Ln([{TAG:0,_0:0},{TAG:0,_0:0}],qn)]}}function hs(n){switch(n){case 0:return ut(Ln([Wn],Wn));case 1:return ut(Ln([qn],qn));case 2:return[[0],Ln([a_({TAG:0,_0:0})],{TAG:0,_0:0})]}}var st=Ot();function oo(n,e,r,u,a){var t=Xn.typeOf(r);pe(st,t);var o=hn(e,n,function(_,v){return zn.addMono(_,v.contents.name,v.contents.ty)}),i=Ln(s(e,function(_){return _.contents.ty}),t),c=a!==void 0?zn.addMono(o,a,i):o;return F(An(c,r,t),function(_){var v=A(_,i),T=A(_,u),p=Gn(_,n),W=hr(p,v);return Q(an(T,v),function(R){Et(st);var q=U(R,_);return[q,A(R,T),Na(R,W)]})})}function An(n,e,r){return F(ce(n,e),function(u){return Q(an(A(u,r),A(u,Xn.typeOf(e))),function(a){return U(a,u)})})}function ce(n,e){switch(e.TAG|0){case 0:var r=Wt(Gs(e._0));return an(Xn.typeOf(e),r);case 1:var u=e._3,a=e._2,t=e._1,o=e._0;return F(ce(n,t),function(f){var w=Gn(f,n);return F(ce(w,u),function(S){var k=U(S,f),M=A(k,Ln([Xn.typeOf(t),Xn.typeOf(u)],o)),z=Wt(gs(a));return Q(an(M,z),function(H){return U(H,k)})})});case 2:var i=e._2,c=e._1,_=e._0,v=Xn.typeOf(i);return F(ce(n,i),function(f){var w=A(f,Ln([v],_)),S=Wt(hs(c));return Q(an(w,S),function(k){return U(k,f)})});case 3:var T=e._0.contents,p=zn.get(n,T.name);if(p!==void 0)return an(T.ty,Wt(p));var W=Kn(T.name);if(W===void 0)return{TAG:1,_0:'unbound variable: "'+T.name+'"'};var R={TAG:2,_0:{TAG:1,_0:jn.fromArray(s(W.staticFuncs,function(f){var w=f.name;return[w.contents.name,w.contents.ty]}),we())}};return an(T.ty,R);case 4:var q=e._1,tn=e._0,dn=fn.typeOfExpr(tn),Rn=fn.typeOfExpr(q);return F(ce(n,q),function(f){var w=Gn(f,n),S=A(f,dn);return F(An(w,tn,S),function(k){var M=U(k,f),z=A(k,S),H=A(M,Rn);return Q(an(z,H),function(x){return U(x,M)})})});case 5:return Q(oo(n,e._1,e._2,e._0,void 0),function(f){return f[0]});case 6:var wn=e._4,pn=e._3,bn=e._0,mn=e._2.contents,gn=Xn.typeOf(pn);return F(ce(n,pn),function(f){var w=Gn(f,n),S=A(f,gn),k=A(f,bn),M=hr(zn.remove(w,mn.name),S),z=zn.add(w,mn.name,M);return F(An(z,wn,k),function(H){var x=U(H,f);return Q(an(A(x,gn),A(x,mn.ty)),function(Nn){return U(Nn,x)})})});case 7:var on=e._4,C=e._3,Vn=e._2,Sn=e._0,kn=e._1.contents,rn=Xn.typeOf(C);pe(st,rn);var Dn=Ln(s(Vn,function(f){return f.contents.ty}),rn),$n=hn(Vn,n,function(f,w){return zn.addMono(f,w.contents.name,w.contents.ty)}),_e=zn.addMono($n,kn.name,Dn);return F(An(_e,C,rn),function(f){var w=Gn(f,_e),S=A(f,Dn),k=A(f,Sn),M=zn.add(w,kn.name,hr(w,S));return F(An(M,on,k),function(z){var H=U(z,f);return Q(an(kn.ty,A(z,S)),function(x){return Et(st),U(x,H)})})});case 8:var Hn=e._2,Qn=s(Hn,Xn.typeOf),Le=Ln(Qn,e._0);return Q(F(An(n,e._1,Le),function(f){return hn(Be(Hn,Qn),{TAG:0,_0:[f,Gn(f,n)]},function(w,S){var k=S[1],M=S[0];return F(w,function(z){var H=z[1],x=z[0],Nn=A(x,k);return Q(An(H,M,Nn),function(Zn){return[U(Zn,x),Gn(Zn,H)]})})})}),function(f){return f[0]});case 9:var fe=e._2,se=e._0;return F(hn(e._1,{TAG:0,_0:[void 0,n]},function(f,w){return F(f,function(S){var k=S[1],M=S[0];return Q(Es(k,w),function(z){return[U(z,M),Gn(z,k)]})})}),function(f){var w=f[0];return fe!==void 0?F(ce(Gn(w,n),fe),function(S){var k=Xn.typeOf(fe),M=U(S,w);return Q(an(A(M,se),A(M,k)),function(z){return U(z,M)})}):Q(an(A(w,se),De),function(S){return U(S,w)})});case 10:var Ge=e._3,In=e._2,yn=e._0;return F(An(n,e._1,qn),function(f){var w=Gn(f,n),S=A(f,yn);return F(An(w,In,S),function(k){var M=Gn(k,w),z=A(k,S),H=U(k,f);return Q(An(M,Ge,z),function(x){return U(x,H)})})});case 11:var Ye=e._1,nr=Xn.typeOf(Ye);return F(ce(n,e._0),function(f){var w=A(f,nr),S=Gn(f,n);return Q(An(S,Ye,w),function(k){return U(k,f)})});case 12:var He=be(st);return He!==void 0?An(n,Tn(e._0,{TAG:0,_0:0},function(f){return f}),He):{TAG:1,_0:"'return' used outside of a function"};case 13:return An(n,e._0,e._1);case 14:var Dt=hn(e._0,{TAG:0,_0:[Pe,n]},function(f,w){return F(f,function(S){var k=S[1],M=S[0];return F(ce(k,w),function(z){var H=U(z,M),x=Gn(z,k);return{TAG:0,_0:[H,x]}})})});return Q(Dt,function(f){return f[0]});case 15:var lt=e._1,Xe=e._0,Qe=Kn(Xe);if(Qe===void 0)return{TAG:1,_0:'undeclared struct "'+Xe+'"'};var Ie=Qe.attributes,Nt=hn(Xt(Ie,function(f){return ge(f.impl)}),{TAG:0,_0:[n,Pe]},function(f,w){var S=w.ty,k=w.name;return F(f,function(M){var z=M[1],H=M[0],x=Ct(lt,function(Nn){return Nn[0]===k});return x!==void 0?F(An(H,x[1],S),function(Nn){var Zn=Gn(Nn,H),xe=U(Nn,z);return{TAG:0,_0:[Zn,xe]}}):{TAG:1,_0:'missing attribute "'+k+'" for struct "'+Xe+'"'}})}),vt=Ae.firstSomeBy(lt,function(f){var w=f[0];if(!cr(Ie,function(S){return S.name===w}))return w});return vt!==void 0?{TAG:1,_0:'extraneous attribute: "'+vt+'" for struct "'+Xe+'"'}:Q(Nt,function(f){return f[1]});case 16:var Ce=e._1,er=e._0,ye=St(),$;if(Ce.TAG===0)$=An(n,Ce._0,ye);else{var Y=hn(Ce._0,{TAG:0,_0:[Pe,n]},function(f,w){return F(f,function(S){var k=S[1],M=S[0],z=A(M,ye);return F(An(k,w,z),function(H){var x=U(H,M),Nn=Gn(H,k);return{TAG:0,_0:[x,Nn]}})})});$=Q(Y,function(f){return f[0]})}var Ft=d(fn.ArrayInit.len,Ce);return F($,function(f){return Q(an(er,wa(ye,Ft)),function(w){return U(w,f)})});case 17:var Me=e._2,dt=e._1,Ue=e._0;return F(ce(n,dt),function(f){var w=fn.typeOfExpr(dt),S=A(f,w),k=function(D){return fu(S,A(D,w))?An(Gn(D,n),e,A(D,Ue)):{TAG:0,_0:D}};switch(S.TAG|0){case 0:case 1:break;case 2:var M=S._0;if(M.TAG===0){var z=M._0,H=Kn(z);if(H===void 0)return{TAG:1,_0:'undeclared struct: "'+z+'"'};var x=Ct(H.attributes,function(D){return D.name===Me});if(x===void 0)return{TAG:1,_0:'attribute "'+Me+'" does not exist on struct "'+z+'"'};var Nn=Tn(x.impl,x.ty,function(D){return D[0].contents.ty});return Q(an(A(f,Ue),A(f,Nn)),function(D){return U(D,f)})}var Zn=M._0,xe=ur(jn.toMap(Zn),Me);if(xe!==void 0)return Q(an(A(f,Ue),A(f,xe)),function(D){return U(D,f)});var Rt=jn.insert(Zn,Me,Ue),Oe=A(f,{TAG:2,_0:{TAG:1,_0:Rt}}),ze=Ur(Rt);if(typeof ze!="number")return ze.TAG===0?F(an(S,{TAG:2,_0:{TAG:0,_0:ze._0.name}}),function(D){return k(U(D,f))}):F(an(S,Oe),function(D){return k(U(D,f))});var nt=0;switch(w.TAG|0){case 0:return{TAG:0,_0:U(cu(Pe,w._0,Oe),f)};case 1:case 2:nt=2;break}if(nt===2)return Q(an(w,Oe),function(D){return U(D,f)});break}var $t=we(),Tt=jn.insert(jn.make({TAG:0,_0:$t}),Me,Ue),Gt=A(f,{TAG:2,_0:{TAG:1,_0:Tt}}),O=Ur(Tt);return typeof O=="number"?{TAG:1,_0:"no struct declaration matches type "+b(Gt)}:O.TAG===0?F(an(S,{TAG:2,_0:{TAG:0,_0:O._0.name}}),function(D){return k(U(D,f))}):F(an(S,Gt),function(D){return k(U(D,f))})})}}function Es(n,e){return ce(n,e._0)}function Or(n,e){return n+"_"+e}function io(n,e){switch(e.TAG|0){case 0:var r=e._0.contents;return Q(oo(n,s(e._1,function(c){return c[0]}),e._2,r.ty,r.newName),function(c){var _=c[0];return[Gn(_,zn.addMono(n,r.name,r.ty)),_]});case 1:var u=e._0;return Q(An(n,e._2,u.contents.ty),function(c){return[Gn(c,zn.addMono(n,u.contents.name,u.contents.ty)),c]});case 2:return{TAG:0,_0:[n,Pe]};case 3:var a=e._0,t=Kn(a);return t!==void 0?hn(e._1,{TAG:0,_0:[n,Pe]},function(c,_){var v=_[2],T=_[1],p=_[0];return F(c,function(W){var R=W[1],q=W[0];p.contents.newName=Or(a,p.contents.name);var tn=Tn(Ve(T,0),[!1,!1],function(gn){return gn[0].contents.name==="self"?[!0,gn[1]]:[!1,!1]}),dn;if(tn[0]){w_(t,p,tn[1]);var Rn=Un(T,[])?[]:yo(T,1),wn={TAG:2,_0:{TAG:0,_0:a}},pn=Ve(T,0),bn;if(pn!==void 0){var mn=pn[0];mn.contents.ty=wn,bn=zn.addMono(q,mn.contents.name,wn)}else bn=q;dn=[bn,Rn]}else m_(t,p),dn=[n,T];return F(io(dn[0],{TAG:0,_0:p,_1:dn[1],_2:v}),function(gn){var on=U(gn[1],R);Ra(on,p);var C=zn.remove(gn[0],p.contents.name);return{TAG:0,_0:[C,on]}})})}):{TAG:1,_0:'cannot implement for unknown type "'+a+'"'};case 4:var o=e.name,i=Ln(s(e.args,function(c){return c[0].contents.ty}),e.ret);return Q(an(o.contents.ty,i),function(c){return[Gn(c,zn.addMono(n,o.contents.name,o.contents.ty)),c]})}}function co(n){return Io(st),hn(n,{TAG:0,_0:[zn.empty,Pe]},function(e,r){return F(e,function(u){var a=u[1];return Q(io(u[0],r),function(t){return[t[0],U(t[1],a)]})})})}var me=En("CompilerExn.InvalidTypeConversion"),zr=En("CompilerExn.InvalidFunctionSignature"),Ht=En("CompilerExn.VariableNotFound"),_o=En("CompilerExn.EmptyFunctionStack"),Je=En("CompilerExn.CannotReassignImmutableValue"),fo=En("CompilerExn.FunctionNotFound"),$e=En("CompilerExn.Unimplemented"),As=En("CompilerExn.UnsupportedGlobalInitializer"),vn=En("CompilerExn.InvalidTypeAssertion"),so=En("CompilerExn.DerefUsedOutsideOfUnsafeBlock"),Qt=En("CompilerExn.InvalidAttributeAccess");function kt(n){return n.RE_EXN_ID===me?"unsupported type: "+b(n._1):n.RE_EXN_ID===zr?"invalid function signature: "+b(n._1):n.RE_EXN_ID===Ht?'variable "'+n._1+'" not found':n.RE_EXN_ID===_o?"Function stack is empty":n.RE_EXN_ID===Je?'cannot mutate "'+n._1+'" as it is behind an immutable binding':n.RE_EXN_ID===fo?'no function named "'+n._1+'" found':n.RE_EXN_ID===$e?"unimplemented: "+n._1:n.RE_EXN_ID===As?"unsupported global initializer: "+Xn.show(void 0,n._1):n.RE_EXN_ID===vn?"invalid type assertion from "+b(n._1)+" to "+b(n._2):n.RE_EXN_ID===so?"the deref operator can only be used in an unsafe block":n.RE_EXN_ID===ue.UnkownTypeSize?"unknown type size: "+b(n._1):n.RE_EXN_ID===wr?'undeclared struct "'+n._1+'"':n.RE_EXN_ID===Qt?n._1+' does not exist for type "'+b(n._2)+'"':n.RE_EXN_ID===mr?"No struct declaration matches type "+b(n._1):n.RE_EXN_ID===Fa?Ts(n._1,n._2):n.RE_EXN_ID===fn.UndeclaredIdentifer?'identifier "'+n._1+'" not found':n.RE_EXN_ID===fn.UnexpectedDeclarationInImplBlock?"unexpected declaration in impl block: "+Fe.show(void 0,n._1):n.RE_EXN_ID===fn.UnreachableLetStmt?"unreachable: let statement found in Core.fromStmt":(console.log(n),"unexpected compiler exception")}function ws(n,e,r,u){return{name:n,depth:e,ty:r,isMutable:u}}function Vr(n){if(n.TAG===0){var e=n._0,r=Kn(e);if(r!==void 0)return r;throw{RE_EXN_ID:wr,_1:e,Error:new Error}}var u=n._0,a=Ur(u);if(typeof a=="number")throw{RE_EXN_ID:mr,_1:{TAG:2,_0:n},Error:new Error};if(a.TAG===0)return a._0;throw{RE_EXN_ID:Fa,_1:u,_2:a._0,Error:new Error}}function Ke(n){switch(n.TAG|0){case 0:throw{RE_EXN_ID:me,_1:n,Error:new Error};case 1:switch(n._0){case"()":if(n._1.length!==0)throw{RE_EXN_ID:me,_1:n,Error:new Error};return[];case"Array":var e=n._1;if(e.length!==2)throw{RE_EXN_ID:me,_1:n,Error:new Error};var r=e[1];switch(r.TAG|0){case 1:if(r._1.length!==0)throw{RE_EXN_ID:me,_1:n,Error:new Error};return[0];case 0:case 2:throw{RE_EXN_ID:me,_1:n,Error:new Error}}case"Fun":case"Ptr":return[0];case"Tuple":return cn(s(n._1,Ke));case"u64":if(n._1.length!==0)throw{RE_EXN_ID:me,_1:n,Error:new Error};return[1];case"bool":case"u32":case"u8":break;default:throw{RE_EXN_ID:me,_1:n,Error:new Error}}if(n._1.length!==0)throw{RE_EXN_ID:me,_1:n,Error:new Error};return[0];case 2:var u=Vr(n._0);return u.size===0?[]:[0]}}function ms(n,e){switch(e.TAG|0){case 1:if(e._0==="Tuple"){var r=cn(s(e._1,Ke)),u=[],a={_0:u,_1:r},t=Pn.getOrAddSignature(n,a);return{TAG:1,_0:t,_1:[[],r]}}break}var o=Ke(e),i=o.length;if(i!==1){if(i===0)return 0;throw{RE_EXN_ID:$e,_1:"wasmBlockReturnTypeOf for "+b(e),Error:new Error}}var c=o[0];return{TAG:0,_0:c}}function Br(n){switch(n.TAG|0){case 1:if(n._0==="Fun"){var e=n._1,r=e.slice(0,e.length-1|0),u=Ve(e,e.length-1|0);return su(wt.Signature.make,cn(s(r,Ke)),Tn(u,[],Ke))}throw{RE_EXN_ID:zr,_1:n,Error:new Error};case 0:case 2:throw{RE_EXN_ID:zr,_1:n,Error:new Error}}}function Pr(n,e,r){return{name:n,locals:[],params:Xt(e,function(u){return!ue.isZeroSizedType(u[1])}),ret:r,instructions:[]}}function E(n,e){n.instructions.push(e)}function Ss(n,e,r,u,a){return n.locals.push(ws(e,u,r,a)),(n.params.length+n.locals.length|0)-1|0}function ps(n,e){var r=rr(n.params,function(t){return t[0]===e});if(r!==void 0){var u=he(n.params,r);return[r,u[2]]}var a=Ae.getReverseIndexBy(n.locals,function(t){return t.name===e});if(a!==void 0)return[n.params.length+a|0,he(n.locals,a).isMutable]}function bs(n){var e=Br(Ln(s(n.params,function(a){return a[1]}),n.ret)),r=d(wt.Local.fromTypes,cn(s(n.locals,function(a){return s(Ke(a.ty),function(t){return[a.name,t]})}))),u=su(wt.Body.make,r,vs(void 0,n.instructions));return wt.make(n.name,e,u)}function lo(n,e,r,u,a){return{name:n,mutability:e,ty:r,index:u,init:a}}function ks(n){var e=n.init,r=n.mutability;return J(n.ty,function(u){return mt.make(r!==2,u,e)})}function h(n){var e=be(n.funcStack);if(e!==void 0)return e;throw{RE_EXN_ID:_o,Error:new Error}}function qr(n,e){return J(Ae.getValueAndIndexBy(n.funcs,function(r){return r.name===e}),function(r){var u=n.externFuncs.length;return[r[0],u+r[1]|0]})}function Ds(n,e){return Ae.getValueAndIndexBy(n.externFuncs,function(r){return r.name===e})}function jr(n){switch(n.TAG|0){case 0:return 0;case 1:switch(n._0){case"Array":var e=n._1;if(e.length!==2)return 0;var r=e[0],u=e[1];switch(u.TAG|0){case 1:return u._1.length!==0?0:Math.imul(iu(u._0),ue.size(r));case 0:case 2:return 0}case"Tuple":return hn(s(n._1,jr),0,function(i,c){return i+c|0});default:return 0}case 2:var a=n._0;if(a.TAG===0){var t=a._0,o=Kn(t);if(o!==void 0)return o.size;throw{RE_EXN_ID:wr,_1:t,Error:new Error}}throw{RE_EXN_ID:mr,_1:n,Error:new Error}}}function vo(n,e){var r=be(n.blockStack);if(r!==void 0&&!(e<=0)){var u=r.shadowStackDelta;return u.contents=u.contents+e|0,E(h(n),{TAG:9,_0:n.stackTop.index}),E(h(n),{TAG:0,_0:e}),E(h(n),5),E(h(n),{TAG:10,_0:n.stackTop.index})}}function Ns(n,e){var r=be(n.blockStack);if(r!==void 0&&!(e<=0)){var u=r.shadowStackDelta;return u.contents=u.contents-e|0,E(h(n),{TAG:9,_0:n.stackTop.index}),E(h(n),{TAG:0,_0:e}),E(h(n),4),E(h(n),{TAG:10,_0:n.stackTop.index})}}function To(n){var e=be(n.blockStack);return e!==void 0?e.isUnsafe:!1}function Go(n,e){return n.scopeDepth=n.scopeDepth+1|0,pe(n.blockStack,{isUnsafe:e||To(n),shadowStackDelta:{contents:0}})}function Fs(n){n.scopeDepth=n.scopeDepth-1|0,Ns(n,Tn(be(n.blockStack),0,function(e){return e.shadowStackDelta.contents})),Et(n.blockStack)}function Zr(n,e,r,u){var a=h(n),t=Ss(a,e,r,n.scopeDepth,u);return E(h(n),{TAG:12,_0:t}),t}function go(n,e,r,u,a){var t=ti(n.globals),o=lo(e,r,u,t,a);return ir(n.globals,e,o),t}function Rs(n,e){var r=h(n);return J(ps(r,e),function(u){return{index:u[0],isMutable:u[1]}})}function It(n,e){var r=Rs(n,e);return r!==void 0?{TAG:0,_0:r.index,_1:r.isMutable}:J(ru(n.globals,e),function(u){return{TAG:1,_0:u.index,_1:u.mutability===1}})}function $s(n){if(typeof n!="number")switch(n.TAG|0){case 0:return{TAG:0,_0:n._0&255};case 1:return{TAG:0,_0:n._0&-1};case 2:return{TAG:0,_0:n._0?1:0}}}function ho(n){if(!To(n))throw{RE_EXN_ID:so,Error:new Error}}function yt(n,e,r){switch(e.TAG|0){case 0:case 1:return{TAG:1,_0:{RE_EXN_ID:Qt,_1:r,_2:e}};case 2:var u=Vr(e._0),a=Ct(u.attributes,function(i){return i.name===r});if(a===void 0)return{TAG:1,_0:{RE_EXN_ID:Qt,_1:r,_2:e}};var t=a.impl;if(t===void 0)return{TAG:0,_0:{TAG:0,_0:{offset:a.offset,ty:a.ty,size:a.size,mut:a.mut}}};var o=qr(n,Or(u.name,t[0].contents.name));return o!==void 0?{TAG:0,_0:{TAG:1,_0:[o[0],o[1],t[1]]}}:{TAG:1,_0:{RE_EXN_ID:Qt,_1:r,_2:e}}}}function Eo(n){return ae(void 0,"$lambda"+String(n.funcs.length))}function Ao(n,e){var r=n!==void 0?n:"",u=h(e);return"$"+r+"_local"+String(u.locals.length)}function xt(n,e){for(;;){var r=e;switch(r.TAG|0){case 3:var u=r._0,a=It(n,u.contents.newName);if(a!==void 0)return a._1?void 0:u.contents.name;throw{RE_EXN_ID:Ht,_1:u.contents.name,Error:new Error};case 17:var t=r._2,o=r._1,i=yt(n,fn.typeOfExpr(o),t);if(i.TAG===0){var c=i._0;if(c.TAG!==0)return;if(!c._0.mut)return t;e=o;continue}throw i._0;default:return}}}function en(n,e){for(;;){var r=e;switch(r.TAG|0){case 0:var u=$s(r._0);return u!==void 0?E(h(n),u):void 0;case 1:var a=r._3,t=r._2,o=r._1;if(ue.isZeroSizedType(fn.typeOfExpr(o))){e={TAG:0,_0:{TAG:2,_0:t===9}};continue}var i=function(O,D){return function(Mn){return en(n,O),en(n,D),E(h(n),Mn)}}(o,a);switch(t){case 0:return i(4);case 1:return i(5);case 2:return i(6);case 3:return i(7);case 4:return i(43);case 5:return i(31);case 6:return i(19);case 7:return i(37);case 8:return i(25);case 9:return i(10);case 10:return i(14);case 11:e={TAG:10,_0:qn,_1:o,_2:a,_3:{TAG:0,_0:{TAG:2,_0:!1}}};continue;case 12:e={TAG:10,_0:qn,_1:o,_2:{TAG:0,_0:{TAG:2,_0:!0}},_3:a};continue;case 13:return i(44);case 14:return i(45);case 15:return i(46);case 16:return i(48)}case 2:var c;switch(r._1){case 0:throw{RE_EXN_ID:$e,_1:"u32 negation is not handled",Error:new Error};case 1:c=9;break;case 2:ho(n),c={TAG:16,_0:0,_1:0};break}return en(n,r._2),E(h(n),c);case 3:var _=r._0;if(ue.isZeroSizedType(_.contents.ty))return;var v=It(n,_.contents.newName);if(v!==void 0)return v.TAG===0?E(h(n),{TAG:11,_0:v._0}):E(h(n),{TAG:9,_0:v._0});throw{RE_EXN_ID:Ht,_1:_.contents.name,Error:new Error};case 4:var T=r._1,p=r._0;if(ue.isZeroSizedType(fn.typeOfExpr(T)))return;switch(p.TAG|0){case 2:if(p._1>=2){ho(n),en(n,p._2),en(n,T);var W=ue.sizeLog2(fn.typeOfExpr(T)),R={TAG:17,_0:W,_1:0};return E(h(n),R)}throw{RE_EXN_ID:$e,_1:"[unreachable]: assignement to an invalid lhs expression",Error:new Error};case 3:var q=p._0,tn=It(n,q.contents.newName);if(tn!==void 0){if(tn._1){var dn;return dn=tn.TAG===0?{TAG:12,_0:tn._0}:{TAG:10,_0:tn._0},en(n,T),E(h(n),dn)}throw{RE_EXN_ID:Je,_1:q.contents.name,Error:new Error}}throw{RE_EXN_ID:Ht,_1:q.contents.name,Error:new Error};case 17:var Rn=p._2,wn=p._1,pn=yt(n,fn.typeOfExpr(wn),Rn);if(pn.TAG===0){var bn=pn._0;if(bn.TAG===0){var mn=bn._0;if(!mn.mut)throw{RE_EXN_ID:Je,_1:Rn,Error:new Error};var gn=xt(n,wn);if(gn!==void 0)throw{RE_EXN_ID:Je,_1:gn,Error:new Error};return mn.size>0?(en(n,wn),en(n,T),E(h(n),{TAG:17,_0:0,_1:mn.offset})):void 0}throw{RE_EXN_ID:$e,_1:"cannot reassign "+Rn+" for type "+b(fn.typeOfExpr(wn)),Error:new Error}}throw pn._0;default:throw{RE_EXN_ID:$e,_1:"[unreachable]: assignement to an invalid lhs expression",Error:new Error}}case 5:var on=Eo(n),C=Wr(n,on,s(r._1,function(O){return[O,!1]}),r._2);return E(h(n),{TAG:0,_0:C});case 6:var Vn=r._3,Sn=r._2.contents;ue.isZeroSizedType(fn.typeOfExpr(Vn))||(en(n,Vn),Zr(n,Sn.name,Sn.ty,r._1)),e=r._4;continue;case 7:var kn=Eo(n);r._1.contents.newName=kn.contents.name,Wr(n,kn,s(r._2,function(O){return[O,!1]}),r._3),e=r._4;continue;case 8:var rn=r._2,Dn=r._1,$n=function(O){return function(Cn){return Fn(O,function(Mn){return en(n,Mn)}),E(h(n),{TAG:14,_0:Cn})}}(rn),_e=function(O,D){return function(Mn){Fn(D,function(So){return en(n,So)});var tr=fn.typeOfExpr(O),Lt=Br(tr),gt=Pn.getOrAddSignature(n.mod,Lt);return en(n,O),E(h(n),{TAG:15,_0:gt,_1:0})}}(Dn,rn),Hn=function(O){return function(Cn,Mn){var tr=Mn!==void 0?un([Mn],O):O;return Fn(Be(tr,Cn),function(Lt){var gt=Lt[1];if(!!(gt[2]&&Tr(gt[1])&&Ut(xt(n,Lt[0]))))throw{RE_EXN_ID:Je,_1:gt[0],Error:new Error}})}}(rn);switch(Dn.TAG|0){case 3:var Qn=Dn._0,Le=It(n,Qn.contents.newName);if(Le!==void 0)return _e(void 0);var fe=qr(n,Qn.contents.newName);if(fe!==void 0)return Hn(fe[0].params,void 0),$n(fe[1]);var se=Ds(n,Qn.contents.newName);if(se!==void 0)return Hn(se[0].args,void 0),$n(se[1]);throw{RE_EXN_ID:fo,_1:Qn.contents.name,Error:new Error};case 17:var Ge=Dn._2,In=Dn._1,yn;if(In.TAG===3){var Ye=In._0.contents.name,nr=Kn(Ye);if(nr!==void 0){var He=qr(n,Or(Ye,Ge));if(He!==void 0)yn=[!1,He[0],He[1]];else throw{RE_EXN_ID:$e,_1:'static function "'+Ge+'" does not exists on struct '+Ye,Error:new Error}}else yn=[!0,void 0,void 0]}else yn=[!0,void 0,void 0];var Dt=yn[2],lt=yn[1],Xe=yn[0],Qe;if(lt!==void 0)Qe=lt;else{var Ie=yt(n,fn.typeOfExpr(In),Ge);if(Ie.TAG===0){var Nt=Ie._0;Qe=Nt.TAG===0?void 0:Nt._0[0]}else throw Ie._0}return Tn(Qe,void 0,function(O,D){return function(Cn){var Mn=D?O:void 0;return Hn(Cn.params,Mn)}}(In,Xe)),Xe&&en(n,In),Dt!==void 0?$n(Dt):_e(void 0);default:return _e(void 0)}case 9:var vt=r._2;return Go(n,r._3===1),Fn(r._1,function(O){return Ls(n,O)}),vt!==void 0&&en(n,vt),Fs(n);case 10:var Ce=r._3,er=ms(n.mod,r._0);return en(n,r._1),E(h(n),{TAG:4,_0:er}),en(n,r._2),fu(Ce,{TAG:0,_0:0})&&(E(h(n),0),en(n,Ce)),E(h(n),1);case 11:return E(h(n),{TAG:7,_0:0}),E(h(n),{TAG:8,_0:0}),en(n,r._0),E(h(n),9),E(h(n),{TAG:5,_0:1}),en(n,r._1),E(h(n),{TAG:6,_0:0}),E(h(n),1),E(h(n),1);case 12:var ye=r._0;return ye!==void 0&&en(n,ye),E(h(n),2);case 13:var $=r._2,Y=r._1;if(!Un(Y,$))switch(Y.TAG|0){case 1:switch(Y._0){case"Array":var Ft=Y._1;if(Ft.length!==2)throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};var Me=Ft[0];switch($.TAG|0){case 1:if($._0==="Ptr"){var dt=$._1;if(dt.length!==1)throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};var Ue=dt[0];if(!ds(Me,Ue))throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}else throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};break;case 0:case 2:throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}break;case"Ptr":var f=Y._1;if(f.length!==1)throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};var w=f[0];switch(w.TAG|0){case 1:if(w._0==="u32"){if(w._1.length!==0)throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};switch($.TAG|0){case 1:if($._0==="u32"){if($._1.length!==0)throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}else throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};break;case 0:case 2:throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}}else throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};break;case 0:case 2:throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}break;case"u32":if(Y._1.length!==0)throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};switch($.TAG|0){case 1:switch($._0){case"Ptr":if($._1.length!==1)throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};break;case"u8":if($._1.length!==0)throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error};break;default:throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}break;case 0:case 2:throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}break;default:throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}break;case 0:case 2:throw{RE_EXN_ID:vn,_1:Y,_2:$,Error:new Error}}e=r._0;continue;case 14:return Fn(r._0,function(O){return en(n,O)});case 15:var S=r._1,k=ou(Kn(r._0)),M=k.size;vo(n,M),Fn(Be(k.attributes,S),function(O){var D=O[0],Cn=D.ty;if(D.mut&&Tr(Cn)){var Mn=xt(n,O[1][1]);if(Mn!==void 0)throw{RE_EXN_ID:Je,_1:Mn,Error:new Error}}if(ge(D.impl)&&ue.size(Cn)>0)return E(h(n),{TAG:9,_0:n.stackTop.index})}),M>0&&E(h(n),{TAG:9,_0:n.stackTop.index});var z={contents:0};return Fn(S,function(O){return function(D){var Cn=Jr(n,D[1],O.contents);O.contents=O.contents+Cn|0}}(z));case 16:var H=r._1,x=jr(r._0);vo(n,x),E(h(n),{TAG:9,_0:n.stackTop.index});var Nn=Zr(n,Ao("arrayAddr",n),Wn,!0);if(H.TAG===0){E(h(n),{TAG:0,_0:0});var Zn=Zr(n,Ao("addr",n),Wn,!0);E(h(n),{TAG:7,_0:0}),E(h(n),{TAG:8,_0:0}),E(h(n),{TAG:11,_0:Zn}),E(h(n),{TAG:0,_0:x}),E(h(n),10),E(h(n),{TAG:5,_0:1}),E(h(n),{TAG:11,_0:Nn}),E(h(n),{TAG:11,_0:Zn}),E(h(n),4);var xe=Jr(n,H._0,0);E(h(n),{TAG:11,_0:Zn}),E(h(n),{TAG:0,_0:xe}),E(h(n),4),E(h(n),{TAG:12,_0:Zn}),E(h(n),{TAG:6,_0:0}),E(h(n),1),E(h(n),1)}else{var Rt={contents:0};Fn(H._0,function(O,D){return function(Cn){E(h(n),{TAG:11,_0:O});var Mn=Jr(n,Cn,D.contents);D.contents=D.contents+Mn|0}}(Nn,Rt))}return E(h(n),{TAG:11,_0:Nn});case 17:var Oe=r._1,ze=yt(n,fn.typeOfExpr(Oe),r._2);if(ze.TAG===0){var nt=ze._0;if(nt.TAG===0){var $t=nt._0;return ue.isZeroSizedType($t.ty)?void 0:(en(n,Oe),E(h(n),{TAG:16,_0:0,_1:$t.offset}))}var Tt=nt._0;if(Tt[2]){var Gt=xt(n,Oe);if(Gt!==void 0)throw{RE_EXN_ID:Je,_1:Gt,Error:new Error}}return E(h(n),{TAG:0,_0:Tt[1]})}throw ze._0}}}function Ls(n,e){var r=e._0;return en(n,r),Fn(Ke(Xn.typeOf(r)),function(u){return E(h(n),3)})}function Wr(n,e,r,u){var a=s(r,function(i){var c=i[0];return[c.contents.name,c.contents.ty,i[1]||!Tr(c.contents.ty)]}),t=Pr(e.contents.newName,a,Xn.typeOf(u)),o=n.funcs.push(t)-1|0;return pe(n.funcStack,t),en(n,u),E(h(n),1),Et(n.funcStack),o}function Xs(n,e){var r=Pr("__isolated__",[],fn.typeOfExpr(e));return pe(n.funcStack,r),en(n,e),Et(n.funcStack),r}function wo(n,e){switch(e.TAG|0){case 0:Wr(n,e._0,e._1,e._2);return;case 1:var r=e._1,u=e._0;Go(n,!1);var a=Xs(n,e._2),t=a.instructions;if(t.length===1){var o=t[0];if(typeof o!="number"&&o.TAG===0){go(n,u.contents.name,r?1:2,0,d(mt.Initializer.fromInstructions,[{TAG:0,_0:o._0}]));return}}ni(n.globalsInitializer.instructions,"push",[t]);var i=go(n,u.contents.name,r?1:0,0,d(mt.Initializer.fromInstructions,[{TAG:0,_0:0}]));n.globalsInitializer.instructions.push({TAG:10,_0:i});return;case 2:return;case 3:return Fn(e._1,function(T){return wo(n,{TAG:0,_0:T[0],_1:T[1],_2:T[2]})});case 4:var c=e.name,_=Br(c.contents.ty),v=Pn.getOrAddSignature(n.mod,_);Pn.addImport(n.mod,ua.make("index",c.contents.name,{_0:v})),n.externFuncs.push({name:c.contents.name,args:s(e.args,function(T){var p=T[0];return[p.contents.name,p.contents.ty,T[1]]}),ret:e.ret});return}}function Jr(n,e,r){var u=function(o){return en(n,e),E(h(n),{TAG:17,_0:0,_1:r}),o},a=Xn.typeOf(e);switch(a.TAG|0){case 0:break;case 1:var t=0;switch(a._0){case"()":if(a._1.length===0)return 0;break;case"Fun":return u(4);case"Ptr":if(a._1.length===1)return u(4);break;case"bool":case"u32":t=2;break;case"u8":if(a._1.length===0)return u(1);break}if(t===2&&a._1.length===0)return u(4);break;case 2:return Vr(a._0),u(4)}throw{RE_EXN_ID:$e,_1:"cannot store "+b(a)+" in the shadow stack",Error:new Error}}function Cs(n){var e=Ot(),r=function(i){return pe(e,{contents:0})},u=function(i){switch(i.TAG|0){case 15:case 16:break;default:return}var c=jr(fn.typeOfExpr(i)),_=be(e);if(_!==void 0){_.contents=_.contents+c|0;return}else return pe(e,{contents:c})},a=function(i){var c=be(e);if(c!==void 0)return pe(e,{contents:-c.contents|0})};fn.visitProg(N(r),N(a),u,n);var t={contents:0},o={contents:0};return ei(e,function(i){var c=i.contents;o.contents=o.contents+c|0,t.contents=t.contents>o.contents?t.contents:o.contents}),t.contents}function Ms(n){var e=Cs(n),r={mod:Pn.make(void 0),funcs:[],scopeDepth:0,funcStack:Ot(),globals:tu(1),globalsInitializer:Pr("__initGlobals__",[],De),stackTop:lo("__STACK_TOP__",1,0,0,d(mt.Initializer.fromInstructions,[{TAG:0,_0:e}])),blockStack:Ot(),externFuncs:[],options:{useBulkMemoryInstructions:!1}};ir(r.globals,r.stackTop.name,r.stackTop);try{Fn(n,function(c){return wo(r,c)});var u=(Math.ceil(e/65536)|0)+16|0;Pn.addMemory(r.mod,Qu.make(lr.make(u,void 0))),Pn.addExport(r.mod,Ru.make("memory",2,0)),Fn(xo(_u(r.globals),function(c,_){return c.index-_.index|0}),function(c){var _=ks(c);if(_!==void 0)return Pn.addGlobal(r.mod,_)});var a=Bu.fromFuncRefs(0,Hr(r.funcs,function(c,_){return c}));Pn.addElement(r.mod,a),Pn.addTable(r.mod,Mu.make(0,lr.makeExact(r.funcs.length)));var t=r.funcs.length,o=r.globalsInitializer.instructions.length===0;return o||(r.globalsInitializer.instructions.push(1),r.funcs.push(r.globalsInitializer)),Fn(r.funcs,function(c){c.name==="main"&&!o&&c.instructions.unshift({TAG:14,_0:t});var _=bs(c);Pn.addExportedFunc(r.mod,c.name,_[1],_[2])}),{TAG:0,_0:r.mod}}catch(c){var i=At(c);return{TAG:1,_0:kt(i)}}}function Us(n){try{return F(Yt(n),function(r){var u=s(r,Fe.from);return F(co(u),function(a){var t=a[1];$a(t);var o=s(u,function(i){return Fe.subst(t,i)});return Q(Ms(o),function(i){var c=Pn.encodeAsUint8Array(i);return[i,c]})})})}catch(r){var e=At(r);return{TAG:1,_0:kt(e)}}}function Os(n){try{var e=Yt(n);return e.TAG===0?{TAG:0,_0:m(e._0,`

`,function(u){return E_.show(u)})}:{TAG:1,_0:e._0}}catch(u){var r=At(u);return{TAG:1,_0:kt(r)}}}function zs(n){try{var e=Yt(n);if(e.TAG!==0)return{TAG:1,_0:e._0};var r=s(e._0,Fe.from);return{TAG:0,_0:m(r,`

`,function(a){return Fe.show(void 0,a)})}}catch(a){var u=At(a);return{TAG:1,_0:kt(u)}}}function Vs(n){try{var e=Yt(n);if(e.TAG!==0)return{TAG:1,_0:e._0};var r=s(e._0,Fe.from),u=co(r);if(u.TAG!==0)return{TAG:1,_0:u._0};var a=u._0[1];$a(a);var t=s(r,function(i){return Fe.subst(a,i)});return{TAG:0,_0:m(t,`

`,function(i){return Fe.show(N(N(a)),i)})}}catch(i){var o=At(i);return{TAG:1,_0:kt(o)}}}var Bs={debugAst:Os,debugCoreAst:zs,debugTypes:Vs},Ps=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",compile:Us,Debug:Bs});const Kr={"0":"Else","1":"End","2":"Return","3":"Drop","4":"AddI32","5":"SubI32","6":"MulI32","7":"DivI32Unsigned","8":"DivI32Signed","9":"EqzI32","10":"EqI32","11":"EqI64","12":"EqF32","13":"EqF64","14":"NeI32","15":"NeI64","16":"NeF32","17":"NeF64","18":"LeI32Signed","19":"LeI32Unsigned","20":"LeI64Signed","21":"LeI64Unsigned","22":"LeF32","23":"LeF64","24":"GeI32Signed","25":"GeI32Unsigned","26":"GeI64Signed","27":"GeI64Unsigned","28":"GeF32","29":"GeF64","30":"LtI32Signed","31":"LtI32Unsigned","32":"LtI64Signed","33":"LtI64Unsigned","34":"LtF32","35":"LtF64","36":"GtI32Signed","37":"GtI32Unsigned","38":"GtI64Signed","39":"GtI64Unsigned","40":"GtF32","41":"GtF64","42":"RemI32Signed","43":"RemI32Unsigned","44":"AndI32","45":"OrI32","46":"ShlI32","47":"ShrI32Signed","48":"ShrI32Unsigned"},X={"0":"I32","1":"I64","2":"F32","3":"F64"},qs={"0":"FuncRef","1":"ExternRef"},js={"0":"Func","1":"Table","2":"Memory","3":"Global"},Se={"0":"Void"},Zs={"0":"Passive"},Ws=Ps,mo=function(n){const e=Ws.compile(n);return e.TAG===0?{tag:"Ok",value:[{typeSection:e._0[0].typeSection.map(function(u){return[u._0.map(function(t){return X[t]}),u._1.map(function(t){return X[t]})]}),importSection:e._0[0].importSection.map(function(u){return{moduleName:u.moduleName,entityName:u.entityName,desc:{tag:"Func",value:u.desc._0}}}),funcSection:e._0[0].funcSection,tableSection:e._0[0].tableSection.map(function(u){return[qs[u[0]],u[1]]}),memorySection:e._0[0].memorySection,globalSection:e._0[0].globalSection.map(function(u){return[X[u[0]],u[1],u[2].map(function(t){return typeof t=="object"?t.TAG===0?{tag:"ConstI32",value:t._0}:t.TAG===1?{tag:"ConstI64",value:t._0}:t.TAG===2?{tag:"ConstF32",value:t._0}:t.TAG===3?{tag:"ConstF64",value:t._0}:t.TAG===4?{tag:"If",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===5?{tag:"BranchIf",value:t._0}:t.TAG===6?{tag:"Branch",value:t._0}:t.TAG===7?{tag:"Block",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===8?{tag:"Loop",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===9?{tag:"GetGlobal",value:t._0}:t.TAG===10?{tag:"SetGlobal",value:t._0}:t.TAG===11?{tag:"GetLocal",value:t._0}:t.TAG===12?{tag:"SetLocal",value:t._0}:t.TAG===13?{tag:"TeeLocal",value:t._0}:t.TAG===14?{tag:"Call",value:t._0}:t.TAG===15?{tag:"CallIndirect",value:[t._0,t._1]}:t.TAG===16?{tag:"LoadI32",value:[t._0,t._1]}:t.TAG===17?{tag:"StoreI32",value:[t._0,t._1]}:t.TAG===18?{tag:"InitMemory",value:t._0}:{tag:"DropData",value:t._0}:Kr[t]})]}),exportSection:e._0[0].exportSection.map(function(u){return{name:u.name,kind:js[u.kind],index:u.index}}),elementSection:e._0[0].elementSection,codeSection:e._0[0].codeSection.map(function(u){return[u[0].map(function(t){return[t[0],X[t[1]]]}),u[1].map(function(t){return typeof t=="object"?t.TAG===0?{tag:"ConstI32",value:t._0}:t.TAG===1?{tag:"ConstI64",value:t._0}:t.TAG===2?{tag:"ConstF32",value:t._0}:t.TAG===3?{tag:"ConstF64",value:t._0}:t.TAG===4?{tag:"If",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===5?{tag:"BranchIf",value:t._0}:t.TAG===6?{tag:"Branch",value:t._0}:t.TAG===7?{tag:"Block",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===8?{tag:"Loop",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===9?{tag:"GetGlobal",value:t._0}:t.TAG===10?{tag:"SetGlobal",value:t._0}:t.TAG===11?{tag:"GetLocal",value:t._0}:t.TAG===12?{tag:"SetLocal",value:t._0}:t.TAG===13?{tag:"TeeLocal",value:t._0}:t.TAG===14?{tag:"Call",value:t._0}:t.TAG===15?{tag:"CallIndirect",value:[t._0,t._1]}:t.TAG===16?{tag:"LoadI32",value:[t._0,t._1]}:t.TAG===17?{tag:"StoreI32",value:[t._0,t._1]}:t.TAG===18?{tag:"InitMemory",value:t._0}:{tag:"DropData",value:t._0}:Kr[t]})]}),dataSection:e._0[0].dataSection.map(function(u){return{init:u.init,mode:typeof u.mode=="object"?[u.mode._0,u.mode._1]:Zs[u.mode]}}),funcs:e._0[0].funcs.map(function(u){return[u[0],[u[1]._0.map(function(t){return X[t]}),u[1]._1.map(function(t){return X[t]})],[u[2][0].map(function(t){return[t[0],X[t[1]]]}),u[2][1].map(function(t){return typeof t=="object"?t.TAG===0?{tag:"ConstI32",value:t._0}:t.TAG===1?{tag:"ConstI64",value:t._0}:t.TAG===2?{tag:"ConstF32",value:t._0}:t.TAG===3?{tag:"ConstF64",value:t._0}:t.TAG===4?{tag:"If",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===5?{tag:"BranchIf",value:t._0}:t.TAG===6?{tag:"Branch",value:t._0}:t.TAG===7?{tag:"Block",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===8?{tag:"Loop",value:typeof t._0=="object"?t._0.TAG===0?{tag:"TypeValue",value:X[t._0._0]}:{tag:"TypeIndex",value:[t._0._0,[t._0._1[0].map(function(i){return X[i]}),t._0._1[1].map(function(i){return X[i]})]]}:Se[t._0]}:t.TAG===9?{tag:"GetGlobal",value:t._0}:t.TAG===10?{tag:"SetGlobal",value:t._0}:t.TAG===11?{tag:"GetLocal",value:t._0}:t.TAG===12?{tag:"SetLocal",value:t._0}:t.TAG===13?{tag:"TeeLocal",value:t._0}:t.TAG===14?{tag:"Call",value:t._0}:t.TAG===15?{tag:"CallIndirect",value:[t._0,t._1]}:t.TAG===16?{tag:"LoadI32",value:[t._0,t._1]}:t.TAG===17?{tag:"StoreI32",value:[t._0,t._1]}:t.TAG===18?{tag:"InitMemory",value:t._0}:{tag:"DropData",value:t._0}:Kr[t]})]]})},e._0[1]]}:{tag:"Error",value:e._0}};var Js=`
let SIZEOF_U32 = 4;

struct Array {
  start: Ptr<u32>,
  mut length: u32,
}

impl Array {
  fn read(self, n) unsafe {
    *(((self.start as u32) + n * SIZEOF_U32) as Ptr<u32>)
  }

  fn write(mut self, n, val) unsafe {
    *(((self.start as u32) + n * SIZEOF_U32) as Ptr<u32>) = val;
  }

  fn push(mut self, val) {
    self.write(self.length, val);
    self.length += 1;
  }
}

struct Sieve {
  mut primes: Array,
  mut current: u32
}

impl Sieve {
  fn clear(mut self) {
    self.primes.length = 0;
    // 2 is the first prime
    self.primes.push(2);
    self.current = 1;
  }

  fn isPrime(mut self, n) {
    mut i = 0;
    mut p = self.primes.read(i);

    while p * p <= n {
      if n % p == 0 { return false; }
      i += 1;
      p = self.primes.read(i);
    }

    // n is prime
    // add it to the sieve
    self.primes.push(n);

    true
  }

  fn nextPrime(mut self) {
    self.current += 2;

    while !self.isPrime(self.current) {
      self.current += 2;
    }

    self.current
  }

  // count the prime numbers <= m
  fn countUpTo(mut self, m) {
    self.clear();

    while self.current <= m {
      self.nextPrime();
    }

    self.primes.length - 1
  }
}

fn main() {
  mut sieve = Sieve {
    primes: Array {
      start: [0; 10000] as Ptr<u32>,
      length: 0
    },
    current: 0
  };

  sieve.countUpTo(100000)
}
`,Ks=`
fn fact(n) {
  if n == 0 { 1 } else { n * fact(n - 1) }
}

fn main() {
  fact(11)
}`,Ys=`
fn fib(n) {
  let fib_aux = (n, a, b) -> {
    if n == 0 {
      a
    } else {
      fib_aux(n - 1, b, a + b)
    }
  };

  fib_aux(n, 0, 1)
}

fn main() {
  fib(83)
}`,Hs=`
let SIZEOF_U32 = 4;

fn read_u32(addr) unsafe {
  *((addr * SIZEOF_U32) as Ptr<u32>)
}

fn write_u32(addr, val) unsafe {
  *((addr * SIZEOF_U32) as Ptr<u32>) = val;
}

fn main() {
  let square = n -> n * n;

  mut i = 0;
  while i < 100 {
    write_u32(i, square(i));
    i += 1;
  }

  read_u32(42) // 1764
}`,Qs=`
fn isEven(n) {
  n & 1 == 0
}

fn isPrime(n) {
  if n < 2 { return false; }
  if n == 2 { return true; }
  if isEven(n) { return false; }

  mut i = 3;

  while i * i <= n {
    if n % i == 0 { return false; }
    i += 2;
  }

  true
}

fn countPrimesLessThan(m) {
  mut i = m;
  mut count = 0;

  while i > 1 {
    if isPrime(i) {
      count += 1;
    }

    i -= 1;
  }

  count
}

fn main() {
  countPrimesLessThan(1000000)
}`,Is=`
struct MinMax {
  mut min: u32,
  mut max: u32
}

impl MinMax {
  fn reset(mut self) {
    self.min = 0;
    self.max = 0;
  }

  fn resetStatic(mut m) {
    m.reset();
  }
}

fn main() {
  mut m = MinMax {
    min: 17,
    max: 22
  };

  MinMax.resetStatic(m);
  
  m.min + m.max == 0
}`,ys=`
fn main() {
  let twice = (f, x) -> f(f(x));
  
  twice(n -> n * n, 7)
}`,xs=`
struct BumpAllocator {
  mut head: u32
}

impl BumpAllocator {
  fn allocate(mut self, bytes) {
    let addr = self.head as Ptr<u32>;
    self.head = self.head + bytes;
    addr
  }
  
  // do nothing!
  fn free(mut self, addr) { }
}

mut allocator = BumpAllocator { head: 64 * 1024 };

let SIZEOF_U32 = 4;

struct Vec {
  mut start: Ptr<u32>,
  mut length: u32,
  mut capacity: u32 
}

impl Vec {
  fn read(self, index) unsafe {
    *(((self.start as u32) + (index * SIZEOF_U32)) as Ptr<u32>)
  }

  fn write(mut self, index, value) unsafe {
    *(((self.start as u32) + (index * SIZEOF_U32)) as Ptr<u32>) = value;
  }

  fn grow(mut self) unsafe {
    let newCap = if self.capacity == 0 { 8 } else { self.capacity * 2 };
    let newStart = allocator.allocate(newCap * SIZEOF_U32);

    // copy the data from the old array to the new one
    mut i = 0;
    while i < self.length {
      *(((newStart as u32) + (i * SIZEOF_U32)) as Ptr<u32>) = self.read(i);
      i += 1;
    }

    allocator.free(self.start);
    self.start = newStart;
    self.capacity = newCap;
  }

  fn push(mut self, val) {
    if self.length + 1 > self.capacity {
      self.grow();
    }

    self.write(self.length, val);
    self.length += 1;
  }

  fn pop(mut self) {
    if self.length > 0 {
      self.length -= 1;
      self.read(self.length)
    } else {
      // until we have Option<T>
      4294967295 // -1
    }
  }
}

fn main() {
  mut vec = Vec {
    start: 0 as Ptr<u32>,
    length: 0,
    capacity: 0
  };

  mut i = 0;
  while i < 1000 {
    vec.push(i);
    i += 1;
  }

  (vec.length, vec.capacity, vec.read(723))
}`,n1=`
fn isEven(n) {
  n & 1 == 0
}

fn nextCollatz(n) {
  if isEven(n) { n / 2 } else { 3 * n + 1 }
}

fn collatzLen(n) {
  mut len = 1;
  
  while n != 1 {
    n = nextCollatz(n); 
    len += 1;
  }
  
  len
}

fn pb14() {
  mut longest = 0;
  mut longestIndex = 0;

  mut i = 1;
  while i <= 1000000 {
    let len = collatzLen(i);
    if len > longest {
      longest = len;
      longestIndex = i;
    }

    i += 1;
  }
  
  (longest, longestIndex)
}

fn main() {
  pb14()
}`,e1=`
fn digitsSquareSum(n) {
  let square = n -> n * n;
  mut sum = 0;

  while n > 0 {
    sum += square(n % 10);
    n /= 10;
  }

  sum
}

fn reaches89(n) {
  while n != 1 {
    if n == 89 { return true; }
    n = digitsSquareSum(n);
  }

  false
}

fn main() {
  mut i = 1;
  mut count = 0;
  while i < 10000000 {
    if reaches89(i) {
      count += 1;
    }

    i += 1;
  }

  count
}`,t1=`
extern fn log(n: u32) -> ();
extern fn expectEqual(value: u32, expected: u32) -> ();

fn main() {
  mut i = 0;
  
  while i <= 10 {
    expectEqual(i, i);
    i += 1;
  }
}`;const r1={"Prime sieve":Js,Factorial:Ks,Fibonacci:Ys,Pointers:Hs,Primes:Qs,Structs:Is,"Lambda (kind of)":ys,Vector:xs,"External functions":t1,"Project Euler 14":n1,"Project Euler 92":e1},u1=async n=>{const e=await WebAssembly.compile(n),r=new TextDecoder,u=await WebAssembly.instantiate(e,{index:{log:console.log,expectEqual(a,t){if(a!==t)throw new Error(`[expectEqual] expected ${a}, got: ${t}`)},printString(a,t){const o=u.exports.memory,i=new Uint8Array(o.buffer),c=r.decode(i.subarray(a,a+t));console.log(c)}}});if(console.log(u.exports),"main"in u.exports){console.time("run");const a=u.exports.main();return console.timeEnd("run"),a}else return"Error: main function not found, exported functions are: "+Object.keys(u.exports).join(", ")},a1={Run:async(n,e)=>{e("running...");try{const r=mo(n);if(r.tag==="Ok"){const u=await u1(r.value[1]);e(`${u}`)}else e(r.value)}catch(r){e(`${r}`)}},Disassemble:(n,e)=>{try{const r=mo(n);if(r.tag==="Ok"){const[u]=r.value;e(zc(u))}else e(r.value)}catch(r){e(`${r}`)}}},o1=()=>zt.createElement(ri,{actions:a1,samples:r1,aceMode:"rust"});ui.render(zt.createElement(zt.StrictMode,null,zt.createElement(o1,null)),document.getElementById("root"));
